<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ã¨ãã•ã‚“ã¶ã¤ãƒãƒƒãƒãƒ³ã‚°</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&family=Zen+Maru+Gothic:wght@700;900&display=swap');
:root{--bg-dark:#0a0a1a;--bg-mid:#151528;--accent-gold:#FFD700;--accent-pink:#FF6B9D;--accent-blue:#4FC3F7;--alt-green:#4ADE80;--miss-red:#FF5252;--perfect:#69F0AE}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'M PLUS Rounded 1c','Zen Maru Gothic',sans-serif;background:var(--bg-dark);overflow-x:hidden;min-height:100vh;min-height:100dvh;width:100vw;user-select:none;-webkit-user-select:none;color:#fff}

/* SCREENS */
.screen{position:fixed;inset:0;display:none;flex-direction:column;align-items:center;z-index:100;overflow-y:auto}
.screen.active{display:flex}

/* TITLE */
#title-screen{justify-content:flex-start;background:linear-gradient(135deg,#0a0a1a 0%,#151528 40%,#0d1025 100%);padding:20px 16px 40px}
#title-screen::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 30% 20%,rgba(74,222,128,0.08) 0%,transparent 50%),radial-gradient(ellipse at 70% 80%,rgba(79,195,247,0.06) 0%,transparent 50%);pointer-events:none;z-index:0}
.alt-badge{position:fixed;top:16px;right:16px;background:rgba(74,222,128,0.12);border:1.5px solid rgba(74,222,128,0.3);border-radius:50px;padding:8px 18px;color:var(--alt-green);font-size:17px;font-weight:900;z-index:200;backdrop-filter:blur(8px)}
.title-emoji{font-size:64px;animation:titleBounce 2s ease-in-out infinite;position:relative;z-index:1;margin-top:50px}
@keyframes titleBounce{0%,100%{transform:translateY(0) rotate(-5deg)}50%{transform:translateY(-12px) rotate(5deg)}}
.title-text{font-family:'Zen Maru Gothic',sans-serif;font-size:clamp(26px,6.5vw,44px);font-weight:900;background:linear-gradient(135deg,var(--alt-green),var(--accent-blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center;position:relative;z-index:1;letter-spacing:2px;margin-top:16px}
.title-sub{color:rgba(255,255,255,0.5);font-size:clamp(13px,3.2vw,16px);text-align:center;position:relative;z-index:1;margin-top:8px}
.level-select{display:flex;flex-direction:column;gap:10px;margin-top:20px;position:relative;z-index:1;width:min(320px,90vw)}
.level-btn{padding:14px 20px;border:2px solid rgba(255,255,255,0.1);border-radius:14px;background:rgba(255,255,255,0.04);color:#fff;font-family:inherit;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:12px;backdrop-filter:blur(8px)}
.level-btn:hover,.level-btn:active{background:rgba(255,255,255,0.1);border-color:var(--alt-green);transform:scale(1.02)}
.level-btn .emoji{font-size:26px}.level-btn .info{text-align:left}
.level-btn .info small{display:block;color:rgba(255,255,255,0.4);font-weight:400;font-size:12px;margin-top:2px}

/* TITLE BUTTONS (ranking, line) */
.title-actions{display:flex;flex-direction:column;gap:10px;width:min(320px,90vw);position:relative;z-index:1;margin-top:20px}
.title-action-btn{padding:14px 20px;border:2px solid rgba(255,255,255,0.1);border-radius:14px;background:rgba(255,255,255,0.04);color:#fff;font-family:inherit;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s;text-align:center;backdrop-filter:blur(8px)}
.title-action-btn:hover,.title-action-btn:active{background:rgba(255,255,255,0.1);border-color:var(--accent-gold);transform:scale(1.02)}

/* LINE SECTION */
.line-section{position:relative;z-index:1;width:min(320px,90vw);margin-top:20px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:20px}
.line-section h3{font-size:15px;color:var(--alt-green);margin-bottom:12px;font-weight:900}
.line-input{width:100%;padding:10px 14px;border:1.5px solid rgba(255,255,255,0.15);border-radius:10px;background:rgba(255,255,255,0.05);color:#fff;font-family:inherit;font-size:15px;font-weight:700;outline:none;transition:border-color .2s;margin-bottom:10px}
.line-input:focus{border-color:var(--alt-green)}
.line-input::placeholder{color:rgba(255,255,255,0.25)}
.line-btn{width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#06C755,#04A847);color:#fff;font-family:inherit;font-size:16px;font-weight:900;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px}
.line-btn:hover{transform:scale(1.02)}.line-btn:disabled{opacity:0.3;cursor:not-allowed;transform:none}

/* CONFIRM MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:300;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.modal-overlay.show{display:flex}
.modal-box{background:#1a1a2e;border:1.5px solid rgba(255,255,255,0.12);border-radius:20px;padding:28px 24px;max-width:320px;width:90%;text-align:center}
.modal-box .warn{font-size:15px;color:rgba(255,255,255,0.8);margin:12px 0 20px;line-height:1.6}
.modal-box .warn strong{color:var(--alt-green);font-size:20px}
.modal-btns{display:flex;gap:10px}
.modal-btns button{flex:1;padding:12px;border:none;border-radius:10px;font-family:inherit;font-size:15px;font-weight:900;cursor:pointer}
.btn-cancel{background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.6)}
.btn-ok{background:linear-gradient(135deg,#06C755,#04A847);color:#fff}
.btn-gold{background:linear-gradient(135deg,#FFD700,#FFA000);color:#1a1a2e}

/* NAME INPUT MODAL */
.modal-input{width:100%;padding:12px 14px;border:2px solid rgba(255,255,255,0.15);border-radius:12px;background:rgba(255,255,255,0.06);color:#fff;font-family:inherit;font-size:18px;font-weight:900;outline:none;text-align:center;margin:12px 0;transition:border-color .2s}
.modal-input:focus{border-color:var(--accent-gold)}
.modal-input::placeholder{color:rgba(255,255,255,0.2);font-weight:400}

/* GAME */
#game-screen{background:linear-gradient(180deg,#0a0a1a 0%,#060612 100%);height:100vh;height:100dvh;z-index:90;align-items:stretch;overflow:hidden}
.hud{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:rgba(0,0,0,0.4);z-index:10}
.hud-back{width:34px;height:34px;border:2px solid rgba(255,255,255,0.25);border-radius:50%;background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.6);font-size:16px;font-family:inherit;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}
.hud-back:hover,.hud-back:active{background:rgba(255,255,255,0.12);color:#fff}
.hud-score{color:var(--accent-gold);font-size:20px;font-weight:900}
.hud-level{color:rgba(255,255,255,0.5);font-size:13px}
.hud-combo{color:var(--accent-pink);font-size:15px;font-weight:700;min-width:70px;text-align:center;transition:transform .15s}
.hud-combo.pop{transform:scale(1.3)}
.hud-lives{font-size:20px;text-align:right}
.play-area{flex:1;position:relative;overflow:hidden;touch-action:none}
.falling-card{position:absolute;width:105px;height:125px;border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px;cursor:grab;z-index:20;transition:opacity .2s;touch-action:none;box-shadow:0 4px 18px rgba(0,0,0,0.4)}
.falling-card .card-emoji{font-size:44px;filter:drop-shadow(0 2px 3px rgba(0,0,0,0.3))}
.falling-card .card-name{font-size:14px;font-weight:900;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,0.4);text-align:center;line-height:1.2;display:none}
.falling-card.touched .card-name{display:block;animation:namePopIn .25s ease forwards}
.card-name-popup{position:absolute;top:-32px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.85);color:#fff;font-size:13px;font-weight:900;padding:4px 12px;border-radius:8px;white-space:nowrap;pointer-events:none;z-index:35;animation:namePopIn .25s ease forwards;backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.15)}
@keyframes namePopIn{0%{opacity:0;transform:translateX(-50%) scale(0.6)}100%{opacity:1;transform:translateX(-50%) scale(1)}}
.region-zones{display:flex;gap:6px;padding:6px 10px 14px;z-index:10}
.region-zone{flex:1;padding:16px 6px;border-radius:18px;text-align:center;font-weight:900;font-size:clamp(14px,3.8vw,20px);color:#fff;position:relative;transition:all .3s;border:3px solid transparent;min-height:80px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px}
.region-zone .zone-emoji{font-size:24px}
.region-zone.highlight{transform:scale(1.05);border-color:#fff;box-shadow:0 0 25px rgba(255,255,255,0.25)}
.region-zone.correct-flash{animation:correctPulse .5s ease}
.region-zone.wrong-flash{animation:wrongShake .5s ease}
@keyframes correctPulse{0%{box-shadow:0 0 0 0 rgba(74,222,128,0.6)}50%{box-shadow:0 0 35px 8px rgba(74,222,128,0.3);transform:scale(1.06)}100%{box-shadow:none}}
@keyframes wrongShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-7px)}40%{transform:translateX(7px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}

/* FEEDBACK */
.feedback{position:fixed;top:35%;left:50%;transform:translate(-50%,-50%);font-size:34px;font-weight:900;pointer-events:none;z-index:50;animation:feedbackPop .8s ease forwards;text-shadow:0 2px 8px rgba(0,0,0,0.5)}
@keyframes feedbackPop{0%{opacity:0;transform:translate(-50%,-50%) scale(0.3)}30%{opacity:1;transform:translate(-50%,-50%) scale(1.3)}60%{transform:translate(-50%,-50%) scale(1)}100%{opacity:0;transform:translate(-50%,-80%) scale(0.8)}}
.trivia-popup{position:fixed;bottom:130px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.85);backdrop-filter:blur(12px);color:#fff;padding:10px 18px;border-radius:12px;font-size:14px;font-weight:700;z-index:40;animation:triviaSlide 2s ease forwards;white-space:nowrap;border:1px solid rgba(255,255,255,0.12);max-width:92vw;text-align:center}
@keyframes triviaSlide{0%{opacity:0;transform:translateX(-50%) translateY(20px)}15%{opacity:1;transform:translateX(-50%) translateY(0)}75%{opacity:1}100%{opacity:0;transform:translateX(-50%) translateY(-10px)}}
.combo-burst{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:48px;font-weight:900;color:var(--accent-gold);pointer-events:none;z-index:55;animation:comboBurst 1s ease forwards;text-shadow:0 0 25px rgba(255,215,0,0.5)}
@keyframes comboBurst{0%{opacity:0;transform:translate(-50%,-50%) scale(0.2) rotate(-10deg)}40%{opacity:1;transform:translate(-50%,-50%) scale(1.3) rotate(3deg)}70%{transform:translate(-50%,-50%) scale(1) rotate(0)}100%{opacity:0;transform:translate(-50%,-70%) scale(0.7)}}
.fever-overlay{position:fixed;inset:0;pointer-events:none;z-index:5;background:radial-gradient(ellipse at center,rgba(255,215,0,0.06) 0%,transparent 70%);animation:feverPulse .8s ease-in-out infinite alternate}
@keyframes feverPulse{0%{opacity:0.5}100%{opacity:1}}
.particle{position:fixed;width:7px;height:7px;border-radius:50%;pointer-events:none;z-index:45;animation:particleFly .7s ease-out forwards}
@keyframes particleFly{0%{opacity:1;transform:translate(0,0) scale(1)}100%{opacity:0;transform:translate(var(--px),var(--py)) scale(0)}}

/* FEVER COMBO COUNTER */
.fever-counter{position:fixed;top:12%;left:50%;transform:translateX(-50%);pointer-events:none;z-index:48;text-align:center;opacity:0.85}
.fever-counter .fc-num{font-size:48px;font-weight:900;text-shadow:0 2px 16px rgba(0,0,0,0.5);transition:color .2s;animation:fcBounce .25s ease}
.fever-counter .fc-label{font-size:13px;font-weight:700;color:rgba(255,255,255,0.5);letter-spacing:2px;margin-top:-4px}
@keyframes fcBounce{0%{transform:scale(1.5)}50%{transform:scale(0.9)}100%{transform:scale(1)}}
.edge-flash{position:fixed;inset:0;pointer-events:none;z-index:6;border:3px solid transparent;animation:edgeFlash .3s ease forwards}
@keyframes edgeFlash{0%{border-color:rgba(255,215,0,0.6)}100%{border-color:transparent}}

/* RESULT */
#result-screen{justify-content:center;background:linear-gradient(135deg,#0a0a1a,#151528);gap:14px;padding:24px}
.result-title{font-size:32px;font-weight:900;color:var(--accent-gold)}
.result-stars{font-size:40px;letter-spacing:8px}
.result-stats{display:flex;gap:20px;color:rgba(255,255,255,0.6);font-size:14px}
.result-stats span{text-align:center}
.result-stats .num{display:block;font-size:24px;font-weight:900;color:#fff}
.result-alt-box{background:rgba(74,222,128,0.08);border:2px solid rgba(74,222,128,0.25);border-radius:20px;padding:20px 36px;text-align:center;margin:4px 0;opacity:0;transform:scale(0.5);animation:altBoxIn .6s ease .5s forwards}
@keyframes altBoxIn{0%{opacity:0;transform:scale(0.5)}60%{opacity:1;transform:scale(1.1)}100%{opacity:1;transform:scale(1)}}
.result-alt-num{font-size:36px;font-weight:900;color:var(--alt-green)}
.result-alt-first{font-size:15px;font-weight:700;color:var(--accent-gold);margin-top:6px;opacity:0}
.result-alt-first.show{animation:firstIn .5s ease .9s forwards}
@keyframes firstIn{0%{opacity:0;transform:translateY(8px)}100%{opacity:1;transform:translateY(0)}}
.result-alt-total{font-size:14px;color:rgba(74,222,128,0.45);font-weight:700}
.result-items{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;max-width:340px}
.result-item{padding:5px 10px;border-radius:8px;font-size:13px;font-weight:700;color:#fff}
.result-item.correct{background:rgba(74,222,128,0.15);border:1px solid rgba(74,222,128,0.3)}
.result-item.wrong{background:rgba(255,82,82,0.15);border:1px solid rgba(255,82,82,0.3)}

/* RESULT RANKING AREA */
.result-rank-area{margin-top:4px;text-align:center;min-height:60px}
.btn-register{padding:12px 28px;border:2px solid var(--accent-gold);border-radius:50px;background:rgba(255,215,0,0.08);color:var(--accent-gold);font-family:inherit;font-size:16px;font-weight:900;cursor:pointer;transition:all .2s}
.btn-register:hover{background:rgba(255,215,0,0.15);transform:scale(1.03)}
.btn-register:disabled{opacity:0.3;cursor:not-allowed;transform:none}
.rank-result{font-size:14px;color:rgba(255,255,255,0.6);line-height:2}
.rank-result strong{color:var(--accent-gold);font-size:18px}
.rank-result .new-best{color:var(--alt-green);font-weight:900}
.rank-link{color:var(--accent-blue);font-size:13px;cursor:pointer;text-decoration:underline;margin-top:4px;display:inline-block}

.btn-restart{padding:14px 44px;border:none;border-radius:50px;background:linear-gradient(135deg,var(--accent-pink),#FF8A65);color:#fff;font-family:inherit;font-size:18px;font-weight:900;cursor:pointer;transition:transform .2s}
.btn-restart:hover{transform:scale(1.05)}

/* RANKING SCREEN */
#ranking-screen{justify-content:flex-start;background:linear-gradient(135deg,#0a0a1a,#151528);padding:24px 16px 40px}
.rank-header{display:flex;align-items:center;width:min(360px,90vw);margin-bottom:16px;position:relative}
.rank-back{width:36px;height:36px;border:2px solid rgba(255,255,255,0.2);border-radius:50%;background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.6);font-size:16px;font-family:inherit;cursor:pointer;display:flex;align-items:center;justify-content:center}
.rank-title{flex:1;text-align:center;font-size:22px;font-weight:900;color:var(--accent-gold)}
.rank-tabs{display:flex;gap:8px;margin-bottom:16px}
.rank-tab{flex:1;padding:10px;border:2px solid rgba(255,255,255,0.1);border-radius:12px;background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.5);font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;text-align:center;transition:all .2s}
.rank-tab.active{border-color:var(--accent-gold);color:var(--accent-gold);background:rgba(255,215,0,0.08)}
.rank-period{font-size:12px;color:rgba(255,255,255,0.3);text-align:center;margin-bottom:12px}
.rank-list{width:min(360px,90vw);display:flex;flex-direction:column;gap:6px}
.rank-row{display:flex;align-items:center;padding:12px 16px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);gap:12px;transition:background .2s}
.rank-row.me{background:rgba(74,222,128,0.08);border-color:rgba(74,222,128,0.2)}
.rank-row.top3{background:rgba(255,215,0,0.06);border-color:rgba(255,215,0,0.15)}
.rank-pos{font-size:18px;font-weight:900;width:36px;text-align:center;color:rgba(255,255,255,0.5)}
.rank-row.top3 .rank-pos{color:var(--accent-gold)}
.rank-name{flex:1;font-size:15px;font-weight:700;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.rank-score{font-size:16px;font-weight:900;color:var(--accent-gold)}
.rank-divider{width:100%;border:none;border-top:1px dashed rgba(255,255,255,0.1);margin:6px 0}
.rank-empty{text-align:center;color:rgba(255,255,255,0.3);font-size:14px;padding:24px 0}

/* STARS */
.stars{position:fixed;inset:0;pointer-events:none;z-index:0}
.star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;animation:twinkle 3s ease-in-out infinite}
@keyframes twinkle{0%,100%{opacity:0.15}50%{opacity:0.6}}

/* TABLET 600 */
@media(min-width:600px){
  .title-emoji{font-size:90px;margin-top:60px}.title-text{font-size:52px;margin-top:20px}.title-sub{font-size:18px}
  .level-select,.title-actions{width:420px;gap:14px}.level-btn,.title-action-btn{padding:18px 28px;font-size:19px;border-radius:18px}
  .level-btn .emoji{font-size:34px}.alt-badge{font-size:20px;padding:10px 24px}
  .line-section{width:420px;padding:28px}.line-input{padding:14px 18px;font-size:17px}.line-btn{padding:16px;font-size:18px}
  .modal-box{max-width:400px;padding:36px 32px}.modal-input{font-size:20px;padding:14px 18px}
  .hud{padding:14px 20px}.hud-back{width:42px;height:42px;font-size:20px}.hud-score{font-size:26px}.hud-level{font-size:15px}
  .hud-combo{font-size:19px;min-width:100px}.hud-lives{font-size:26px}
  .falling-card{width:140px;height:165px;border-radius:20px;gap:8px}.falling-card .card-emoji{font-size:60px}.falling-card .card-name{font-size:18px}.card-name-popup{font-size:16px;top:-36px;padding:5px 14px}
  .region-zones{gap:10px;padding:10px 16px 20px}.region-zone{padding:22px 10px;border-radius:22px;font-size:22px;min-height:100px;gap:6px;border-width:4px}.region-zone .zone-emoji{font-size:32px}
  .feedback{font-size:46px}.trivia-popup{font-size:18px;padding:14px 24px;bottom:160px}.combo-burst{font-size:60px}
  .result-title{font-size:42px}.result-stars{font-size:52px;letter-spacing:12px}
  .result-alt-box{padding:24px 48px}.result-alt-num{font-size:44px}
  .result-stats{gap:32px;font-size:16px}.result-stats .num{font-size:32px}
  .result-items{max-width:500px;gap:8px}.result-item{padding:8px 14px;font-size:15px}
  .btn-restart{padding:18px 56px;font-size:22px}.btn-register{padding:14px 36px;font-size:18px}
  .rank-header{width:420px}.rank-title{font-size:26px}.rank-list{width:420px}
  .rank-row{padding:14px 20px}.rank-pos{font-size:20px}.rank-name{font-size:17px}.rank-score{font-size:18px}
  .fever-counter{top:10%}.fever-counter .fc-num{font-size:64px}
}
/* TABLET 900 */
@media(min-width:900px){
  .title-emoji{font-size:100px;margin-top:50px}.title-text{font-size:60px}
  .level-select,.title-actions{width:480px}.level-btn{padding:22px 32px;font-size:21px}.level-btn .emoji{font-size:38px}
  .line-section{width:480px}
  .falling-card{width:160px;height:185px;border-radius:24px}.falling-card .card-emoji{font-size:68px}.falling-card .card-name{font-size:20px}.card-name-popup{font-size:18px;top:-40px;padding:6px 16px}
  .region-zones{gap:14px;padding:12px 24px 24px}.region-zone{padding:28px 14px;border-radius:26px;font-size:24px;min-height:115px}.region-zone .zone-emoji{font-size:38px}
  .hud{padding:16px 28px}.hud-score{font-size:30px}.hud-combo{font-size:22px}.hud-lives{font-size:30px}
  .feedback{font-size:56px}.combo-burst{font-size:72px}
  .result-title{font-size:48px}.result-stars{font-size:60px}.result-alt-box{padding:28px 56px}.result-alt-num{font-size:52px}
  .result-items{max-width:600px}.btn-restart{padding:20px 64px;font-size:24px}
  .rank-header,.rank-list{width:480px}
}
/* LANDSCAPE */
@media(min-width:600px)and(max-height:500px){
  .title-emoji{font-size:50px;margin-top:10px}.title-text{font-size:32px;margin-top:8px}.title-sub{margin-top:4px}
  .level-select{margin-top:10px;gap:6px}.level-btn{padding:10px 20px}
  .hud{padding:6px 16px}.falling-card{width:120px;height:140px}.falling-card .card-emoji{font-size:48px}.falling-card .card-name{font-size:16px}
  .region-zones{padding:4px 12px 8px}.region-zone{padding:10px 6px;min-height:64px;font-size:16px}.region-zone .zone-emoji{font-size:22px}
  .feedback{font-size:36px;top:40%}.result-title{font-size:28px}.result-stars{font-size:36px}
  .result-alt-box{padding:14px 28px}.result-alt-num{font-size:28px}
  .result-stats{gap:16px;font-size:13px}.result-stats .num{font-size:22px}
  .fever-counter{top:8%}.fever-counter .fc-num{font-size:40px}
}
</style>
</head>
<body>
<div class="stars" id="stars"></div>
<div class="alt-badge" id="alt-badge" style="display:none">ğŸª™ <span id="alt-display">0</span> ALT</div>

<!-- TITLE -->
<div id="title-screen" class="screen active">
  <div style="height:20px"></div>
  <div class="title-emoji">ğŸğŸŸğŸŠ</div>
  <div class="title-text">ã¨ãã•ã‚“ã¶ã¤<br>ãƒãƒƒãƒãƒ³ã‚°</div>
  <div class="title-sub">ãŸã ã—ã„ã¡ã„ãã«ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã‚ˆã†ï¼</div>
  <div class="level-select">
    <button class="level-btn" onclick="startGame(0)"><span class="emoji">ğŸŒ±</span><span class="info">ãƒ¬ãƒ™ãƒ«1<small>2ã¡ã„ã ãƒ» ã‚†ã£ãã‚Š</small></span></button>
    <button class="level-btn" onclick="startGame(1)"><span class="emoji">ğŸŒ¿</span><span class="info">ãƒ¬ãƒ™ãƒ«2<small>3ã¡ã„ã ãƒ» ãµã¤ã†</small></span></button>
    <button class="level-btn" onclick="startGame(2)"><span class="emoji">ğŸ”¥</span><span class="info">ãƒ¬ãƒ™ãƒ«3<small>4ã¡ã„ã ãƒ» ã¯ã‚„ã„</small></span></button>
    <button class="level-btn" onclick="startGame(3)"><span class="emoji">âš¡</span><span class="info">ãƒ¬ãƒ™ãƒ«4<small>5ã¡ã„ã ãƒ» ã‚¹ãƒ”ãƒ¼ãƒ‰</small></span></button>
  </div>
  <div class="title-actions">
    <button class="title-action-btn" onclick="showScreen('ranking-screen');renderRanking()">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
  </div>
  <div class="line-section">
    <h3>ğŸ’° ALTã‚’TRAILã«ã»ã†ã“ãã™ã‚‹</h3>
    <input class="line-input" id="line-name" type="text" placeholder="ãªã¾ãˆã‚’ã«ã‚…ã†ã‚Šã‚‡ã" maxlength="20" oninput="updateLineBtn()">
    <button class="line-btn" id="line-btn" disabled onclick="showLineConfirm()">ğŸ’¬ LINEã§ã»ã†ã“ãã™ã‚‹</button>
  </div>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">
  <div class="hud">
    <button class="hud-back" onclick="goTitle()">âœ•</button>
    <div><div class="hud-score" id="score">0</div><div class="hud-level" id="level-label"></div></div>
    <div class="hud-combo" id="combo"></div>
    <div class="hud-lives" id="lives"></div>
  </div>
  <div class="play-area" id="play-area"></div>
  <div class="region-zones" id="region-zones"></div>
</div>

<!-- RESULT -->
<div id="result-screen" class="screen">
  <div class="result-title" id="result-title"></div>
  <div class="result-stars" id="result-stars"></div>
  <div class="result-stats">
    <span><span class="num" id="result-score-val">0</span>ã‚¹ã‚³ã‚¢</span>
    <span><span class="num" id="result-correct">0</span>ã›ã„ã‹ã„</span>
    <span><span class="num" id="result-combo">0</span>ã•ã„ã ã„ã‚³ãƒ³ãƒœ</span>
  </div>
  <div class="result-alt-box" id="result-alt-box">
    <div class="result-alt-num" id="result-alt-num">ğŸª™ 0 ALT</div>
    <div class="result-alt-first" id="result-alt-first"></div>
  </div>
  <div class="result-alt-total" id="result-alt-total"></div>
  <div class="result-rank-area" id="result-rank-area">
    <button class="btn-register" id="btn-register" onclick="showNameModal()">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ã¨ã†ã‚ãã™ã‚‹</button>
  </div>
  <div class="result-items" id="result-items"></div>
  <button class="btn-restart" onclick="goTitle()">ã‚‚ã©ã‚‹</button>
</div>

<!-- RANKING SCREEN -->
<div id="ranking-screen" class="screen">
  <div class="rank-header">
    <button class="rank-back" onclick="goBackFromRanking()">â†</button>
    <div class="rank-title">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</div>
    <div style="width:36px"></div>
  </div>
  <div class="rank-tabs">
    <button class="rank-tab active" id="tab-weekly" onclick="switchRankTab('weekly')">ã—ã‚…ã†ã‹ã‚“</button>
    <button class="rank-tab" id="tab-alltime" onclick="switchRankTab('alltime')">ã‚Œãã ã„</button>
  </div>
  <div class="rank-period" id="rank-period"></div>
  <div class="rank-list" id="rank-list"></div>
</div>

<!-- NAME MODAL -->
<div class="modal-overlay" id="name-modal">
  <div class="modal-box">
    <div style="font-size:28px">ğŸ†</div>
    <div class="warn">ãªã¾ãˆã‚’ã„ã‚Œã¦ã¨ã†ã‚ãï¼</div>
    <input class="modal-input" id="rank-name-input" type="text" placeholder="ãªã¾ãˆ" maxlength="10">
    <div class="modal-btns">
      <button class="btn-cancel" onclick="hideModal('name-modal')">ã‚„ã‚ã‚‹</button>
      <button class="btn-gold" id="btn-do-register" onclick="doRegister()">ã¨ã†ã‚ãï¼</button>
    </div>
  </div>
</div>

<!-- LINE CONFIRM MODAL -->
<div class="modal-overlay" id="line-confirm-modal">
  <div class="modal-box">
    <div style="font-size:28px">âš ï¸</div>
    <div class="warn" id="line-confirm-msg"></div>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="hideModal('line-confirm-modal')">ã‚„ã‚ã‚‹</button>
      <button class="btn-ok" onclick="doLineReport()">OKï¼ãŠãã‚‹</button>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ TRAIL ALTãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°é€£æº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const GAS_URL     = 'https://script.google.com/macros/s/AKfycbzKUyiUHIMp9JRFX0LEa88plEoavkbrjTQ5oHf9T-FDd6b4fhqfTCBVBy5rWUZPUQbY/exec';
const GAME_ID     = 7;
const GAME_NAME   = 'ç‰¹ç”£å“ãƒãƒƒãƒãƒ³ã‚°';
const SCORE_LABEL = 'ç‚¹';
const ALT_AMOUNT  = 10;
const TRAIL_PLAYER = new URLSearchParams(location.search).get('player') || null;

async function sendResult(score) {
  if (!TRAIL_PLAYER) return;
  const opt = { method:'POST', redirect:'follow', headers:{'Content-Type':'text/plain'} };
  await fetch(GAS_URL, { ...opt, body: JSON.stringify({
    action: 'saveRanking',
    gameId: GAME_ID, gameName: GAME_NAME,
    player: TRAIL_PLAYER, score: score, scoreLabel: SCORE_LABEL
  })});
  await fetch(GAS_URL, { ...opt, body: JSON.stringify({
    action: 'addCoin',
    player: TRAIL_PLAYER, gameId: GAME_ID,
    gameName: GAME_NAME, amount: ALT_AMOUNT
  })});
}
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

const PREFECTURES = [
  { id:'hokkaido', name:'ã»ã£ã‹ã„ã©ã†', emoji:'â„ï¸', bg:'linear-gradient(135deg,#0D47A1,#1976D2)', items:[
    { name:'ã˜ã‚ƒãŒã„ã‚‚', emoji:'ğŸ¥”', trivia:'ã˜ã‚ƒãŒã„ã‚‚ â†’ ã»ã£ã‹ã„ã©ã†ï¼ã«ã»ã‚“ã®ã‚„ã8ã‚ã‚Š' },
    { name:'ãƒ¡ãƒ­ãƒ³', emoji:'ğŸˆ', trivia:'ãƒ¡ãƒ­ãƒ³ â†’ ã»ã£ã‹ã„ã©ã†ï¼ã‚†ã†ã°ã‚Šãƒ¡ãƒ­ãƒ³ãŒã‚†ã†ã‚ã„ğŸˆ' },
    { name:'ã‚«ãƒ‹', emoji:'ğŸ¦€', trivia:'ã‚«ãƒ‹ â†’ ã»ã£ã‹ã„ã©ã†ï¼ãŸã‚‰ã°ãŒã«ãŒã‚†ã†ã‚ã„ğŸ¦€' },
    { name:'ã¨ã†ã‚‚ã‚ã“ã—', emoji:'ğŸŒ½', trivia:'ã¨ã†ã‚‚ã‚ã“ã— â†’ ã»ã£ã‹ã„ã©ã†ï¼ã²ã‚ã„ã ã„ã¡ã§ãã ã¤ğŸŒ½' },
    { name:'ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼', emoji:'ğŸ’œ', trivia:'ãƒ©ãƒ™ãƒ³ãƒ€ãƒ¼ â†’ ã»ã£ã‹ã„ã©ã†ï¼ãµã‚‰ã®ãŒã‚†ã†ã‚ã„ğŸ’œ' },
  ]},
  { id:'aomori', name:'ã‚ãŠã‚‚ã‚Š', emoji:'ğŸ”ï¸', bg:'linear-gradient(135deg,#1B5E20,#388E3C)', items:[
    { name:'ã‚Šã‚“ã”', emoji:'ğŸ', trivia:'ã‚Šã‚“ã” â†’ ã‚ãŠã‚‚ã‚Šã‘ã‚“ï¼ã—ã‚…ã†ã‹ãã‚Šã‚‡ã†æ—¥æœ¬ä¸€ğŸ' },
    { name:'ã«ã‚“ã«ã', emoji:'ğŸ§„', trivia:'ã«ã‚“ã«ã â†’ ã‚ãŠã‚‚ã‚Šã‘ã‚“ï¼æ—¥æœ¬ä¸€ã®ã•ã‚“ã¡ğŸ§„' },
    { name:'ãªãŒã„ã‚‚', emoji:'ğŸ¥”', trivia:'ãªãŒã„ã‚‚ â†’ ã‚ãŠã‚‚ã‚Šã‘ã‚“ï¼ã™ãªã®ã¤ã¡ã§ã‚ˆããã ã¤' },
    { name:'ã”ã¼ã†', emoji:'ğŸŒ¿', trivia:'ã”ã¼ã† â†’ ã‚ãŠã‚‚ã‚Šã‘ã‚“ï¼ã›ã„ã•ã‚“ã‚Šã‚‡ã†æ—¥æœ¬ä¸€' },
  ]},
  { id:'iwate', name:'ã„ã‚ã¦', emoji:'â›°ï¸', bg:'linear-gradient(135deg,#2E7D32,#4CAF50)', items:[
    { name:'ã‚ã‚“ã“ãã°', emoji:'ğŸœ', trivia:'ã‚ã‚“ã“ãã° â†’ ã„ã‚ã¦ã‘ã‚“ï¼ãªã‚“ã°ã„ãŸã¹ã‚‰ã‚Œã‚‹ã‹ãªğŸœ' },
    { name:'ã¦ã¤ã³ã‚“', emoji:'ğŸ«–', trivia:'ã¦ã¤ã³ã‚“ â†’ ã„ã‚ã¦ã‘ã‚“ï¼ãªã‚“ã¶ã¦ã¤ããŒã‚†ã†ã‚ã„ğŸ«–' },
    { name:'ã‚Šã‚“ã©ã†', emoji:'ğŸ’', trivia:'ã‚Šã‚“ã©ã† â†’ ã„ã‚ã¦ã‘ã‚“ï¼ã‘ã‚“ã®ã¯ãªğŸ’' },
  ]},
  { id:'miyagi', name:'ã¿ã‚„ã', emoji:'ğŸŒŠ', bg:'linear-gradient(135deg,#00695C,#00897B)', items:[
    { name:'ãã‚…ã†ãŸã‚“', emoji:'ğŸ¥©', trivia:'ãã‚…ã†ãŸã‚“ â†’ ã¿ã‚„ãã‘ã‚“ï¼ã›ã‚“ã ã„ã‚ã„ã¶ã¤ğŸ¥©' },
    { name:'ã•ã•ã‹ã¾ã¼ã“', emoji:'ğŸ¥', trivia:'ã•ã•ã‹ã¾ã¼ã“ â†’ ã¿ã‚„ãã‘ã‚“ï¼ãŠã•ã‹ãªã®ã­ã‚Šã‚‚ã®ğŸ¥' },
    { name:'ãšã‚“ã ã‚‚ã¡', emoji:'ğŸŸ¢', trivia:'ãšã‚“ã ã‚‚ã¡ â†’ ã¿ã‚„ãã‘ã‚“ï¼ãˆã ã¾ã‚ã®ãŠã‚‚ã¡ğŸŸ¢' },
  ]},
  { id:'akita', name:'ã‚ããŸ', emoji:'ğŸŒ¾', bg:'linear-gradient(135deg,#33691E,#558B2F)', items:[
    { name:'ã‚ããŸã“ã¾ã¡', emoji:'ğŸš', trivia:'ã‚ããŸã“ã¾ã¡ â†’ ã‚ããŸã‘ã‚“ï¼ãŠã„ã—ã„ãŠã‚³ãƒ¡ğŸš' },
    { name:'ãã‚ŠãŸã‚“ã½', emoji:'ğŸ¡', trivia:'ãã‚ŠãŸã‚“ã½ â†’ ã‚ããŸã‘ã‚“ï¼ãŠã‚³ãƒ¡ã®ã¼ã†ğŸ¡' },
    { name:'ãªã¾ã¯ã’', emoji:'ğŸ‘¹', trivia:'ãªã¾ã¯ã’ â†’ ã‚ããŸã‘ã‚“ï¼ã§ã‚“ã¨ã†ã¦ããªãŠã¾ã¤ã‚ŠğŸ‘¹' },
  ]},
  { id:'yamagata', name:'ã‚„ã¾ãŒãŸ', emoji:'ğŸ’', bg:'linear-gradient(135deg,#880E4F,#AD1457)', items:[
    { name:'ã•ãã‚‰ã‚“ã¼', emoji:'ğŸ’', trivia:'ã•ãã‚‰ã‚“ã¼ â†’ ã‚„ã¾ãŒãŸã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã•ã‚“ã¡ğŸ’' },
    { name:'ãƒ©ãƒ»ãƒ•ãƒ©ãƒ³ã‚¹', emoji:'ğŸ', trivia:'ãƒ©ãƒ»ãƒ•ãƒ©ãƒ³ã‚¹ â†’ ã‚„ã¾ãŒãŸã‘ã‚“ï¼ã‚ã¾ã„ã‚ˆã†ãªã—ğŸ' },
    { name:'ã„ã‚‚ã«', emoji:'ğŸ²', trivia:'ã„ã‚‚ã« â†’ ã‚„ã¾ãŒãŸã‘ã‚“ï¼ã‚ãã®ã„ã‚‚ã«ã‹ã„ãŒã‚†ã†ã‚ã„ğŸ²' },
  ]},
  { id:'fukushima', name:'ãµãã—ã¾', emoji:'ğŸ‘', bg:'linear-gradient(135deg,#E65100,#F57C00)', items:[
    { name:'ã‚‚ã‚‚', emoji:'ğŸ‘', trivia:'ã‚‚ã‚‚ â†’ ãµãã—ã¾ã‘ã‚“ï¼ã‚ã¾ãã¦ã‚¸ãƒ¥ãƒ¼ã‚·ãƒ¼ğŸ‘' },
    { name:'ã‚ã‹ã¹ã“', emoji:'ğŸ„', trivia:'ã‚ã‹ã¹ã“ â†’ ãµãã—ã¾ã‘ã‚“ï¼ã‚ã‹ã„ã†ã—ã®ãŠãã‚ãŒã‚Šã“ã¼ã—ğŸ„' },
    { name:'ãã‚…ã†ã‚Š', emoji:'ğŸ¥’', trivia:'ãã‚…ã†ã‚Š â†’ ãµãã—ã¾ã‘ã‚“ï¼ã—ã‚…ã†ã‹ãã‚Šã‚‡ã†æ—¥æœ¬ä¸€ğŸ¥’' },
  ]},
  { id:'ibaraki', name:'ã„ã°ã‚‰ã', emoji:'ğŸŒ¸', bg:'linear-gradient(135deg,#4A148C,#6A1B9A)', items:[
    { name:'ãªã£ã¨ã†', emoji:'ğŸ«˜', trivia:'ãªã£ã¨ã† â†’ ã„ã°ã‚‰ãã‘ã‚“ï¼ã¿ã¨ãªã£ã¨ã†ãŒã‚†ã†ã‚ã„ğŸ«˜' },
    { name:'ãƒ¡ãƒ­ãƒ³', emoji:'ğŸˆ', trivia:'ãƒ¡ãƒ­ãƒ³ â†’ ã„ã°ã‚‰ãã‘ã‚“ï¼ã›ã„ã•ã‚“ã‚Šã‚‡ã†æ—¥æœ¬ä¸€ğŸˆ' },
    { name:'ã»ã—ã„ã‚‚', emoji:'ğŸ ', trivia:'ã»ã—ã„ã‚‚ â†’ ã„ã°ã‚‰ãã‘ã‚“ï¼ã«ã»ã‚“ã®ã»ã¨ã‚“ã©ãŒã“ã“ğŸ ' },
  ]},
  { id:'tochigi', name:'ã¨ã¡ã', emoji:'ğŸ“', bg:'linear-gradient(135deg,#B71C1C,#D32F2F)', items:[
    { name:'ã„ã¡ã”', emoji:'ğŸ“', trivia:'ã„ã¡ã” â†’ ã¨ã¡ãã‘ã‚“ï¼ã¨ã¡ãŠã¨ã‚ãŒã‚†ã†ã‚ã„ğŸ“' },
    { name:'ãã‚‡ã†ã–', emoji:'ğŸ¥Ÿ', trivia:'ãã‚‡ã†ã– â†’ ã¨ã¡ãã‘ã‚“ï¼ã†ã¤ã®ã¿ã‚„ãã‚‡ã†ã–ğŸ¥Ÿ' },
    { name:'ã‹ã‚“ã´ã‚‡ã†', emoji:'ğŸ¥’', trivia:'ã‹ã‚“ã´ã‚‡ã† â†’ ã¨ã¡ãã‘ã‚“ï¼ã«ã»ã‚“ã®ã»ã¼ãœã‚“ã¶ãŒã“ã“' },
  ]},
  { id:'gunma', name:'ãã‚“ã¾', emoji:'â™¨ï¸', bg:'linear-gradient(135deg,#4E342E,#6D4C41)', items:[
    { name:'ã“ã‚“ã«ã‚ƒã', emoji:'ğŸŸ«', trivia:'ã“ã‚“ã«ã‚ƒã â†’ ãã‚“ã¾ã‘ã‚“ï¼æ—¥æœ¬ä¸€ã®ã›ã„ã•ã‚“ã‚Šã‚‡ã†' },
    { name:'ã‚„ãã¾ã‚“ã˜ã‚…ã†', emoji:'ğŸ¡', trivia:'ã‚„ãã¾ã‚“ã˜ã‚…ã† â†’ ãã‚“ã¾ã‘ã‚“ï¼ã¿ãã ã‚ŒãŒãŠã„ã—ã„ğŸ¡' },
    { name:'ã‚­ãƒ£ãƒ™ãƒ„', emoji:'ğŸ¥¬', trivia:'ã‚­ãƒ£ãƒ™ãƒ„ â†’ ãã‚“ã¾ã‘ã‚“ï¼ã¤ã¾ã”ã„ã‚€ã‚‰ãŒã‚†ã†ã‚ã„ğŸ¥¬' },
  ]},
  { id:'saitama', name:'ã•ã„ãŸã¾', emoji:'ğŸ™ï¸', bg:'linear-gradient(135deg,#1565C0,#1E88E5)', items:[
    { name:'ãã†ã‹ã›ã‚“ã¹ã„', emoji:'ğŸ˜', trivia:'ãã†ã‹ã›ã‚“ã¹ã„ â†’ ã•ã„ãŸã¾ã‘ã‚“ï¼ãŠã—ã‚‡ã†ã‚†ã‚ã˜ğŸ˜' },
    { name:'ã•ã¨ã„ã‚‚', emoji:'ğŸ¥”', trivia:'ã•ã¨ã„ã‚‚ â†’ ã•ã„ãŸã¾ã‘ã‚“ï¼ã›ã„ã•ã‚“ã‚Šã‚‡ã†ãŒå¤šã„ğŸ¥”' },
    { name:'ã²ãªã«ã‚“ãã‚‡ã†', emoji:'ğŸ', trivia:'ã²ãªã«ã‚“ãã‚‡ã† â†’ ã•ã„ãŸã¾ã‘ã‚“ï¼ã„ã‚ã¤ããŒã‚†ã†ã‚ã„ğŸ' },
  ]},
  { id:'chiba', name:'ã¡ã°', emoji:'ğŸ¥œ', bg:'linear-gradient(135deg,#F57F17,#FBC02D)', items:[
    { name:'ã‚‰ã£ã‹ã›ã„', emoji:'ğŸ¥œ', trivia:'ã‚‰ã£ã‹ã›ã„ â†’ ã¡ã°ã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã•ã‚“ã¡ğŸ¥œ' },
    { name:'ã—ã‚‡ã†ã‚†', emoji:'ğŸ«™', trivia:'ã—ã‚‡ã†ã‚† â†’ ã¡ã°ã‘ã‚“ï¼ã®ã ã¨ã¡ã‚‡ã†ã—ãŒã‚†ã†ã‚ã„ğŸ«™' },
    { name:'ãªã—', emoji:'ğŸ', trivia:'ãªã— â†’ ã¡ã°ã‘ã‚“ï¼ãµãªã°ã—ã®ãªã—ãŒã‚†ã†ã‚ã„ğŸ' },
  ]},
  { id:'tokyo', name:'ã¨ã†ãã‚‡ã†', emoji:'ğŸ—¼', bg:'linear-gradient(135deg,#263238,#455A64)', items:[
    { name:'ã‚‚ã‚“ã˜ã‚ƒã‚„ã', emoji:'ğŸ¥', trivia:'ã‚‚ã‚“ã˜ã‚ƒã‚„ã â†’ ã¨ã†ãã‚‡ã†ï¼ã¤ãã—ã¾ãŒã‚†ã†ã‚ã„' },
    { name:'ã¹ã£ã“ã†ãšã—', emoji:'ğŸ£', trivia:'ã¹ã£ã“ã†ãšã— â†’ ã¨ã†ãã‚‡ã†ï¼ãŠãŒã•ã‚ã‚‰ã®ã‚ã„ã¶ã¤ğŸ£' },
    { name:'ã‚ã—ãŸã°', emoji:'ğŸŒ¿', trivia:'ã‚ã—ãŸã° â†’ ã¨ã†ãã‚‡ã†ï¼ã¯ã¡ã˜ã‚‡ã†ã˜ã¾ã§ãã ã¤ğŸŒ¿' },
  ]},
  { id:'kanagawa', name:'ã‹ãªãŒã‚', emoji:'ğŸš¢', bg:'linear-gradient(135deg,#0D47A1,#1565C0)', items:[
    { name:'ã‚·ãƒ¥ã‚¦ãƒã‚¤', emoji:'ğŸ¥Ÿ', trivia:'ã‚·ãƒ¥ã‚¦ãƒã‚¤ â†’ ã‹ãªãŒã‚ã‘ã‚“ï¼ã‚ˆã“ã¯ã¾ã‚ã„ã¶ã¤ğŸ¥Ÿ' },
    { name:'ã‹ã¾ã¼ã“', emoji:'ğŸ¥', trivia:'ã‹ã¾ã¼ã“ â†’ ã‹ãªãŒã‚ã‘ã‚“ï¼ãŠã ã‚ã‚‰ã‹ã¾ã¼ã“ğŸ¥' },
    { name:'ã¿ã‹ã‚“', emoji:'ğŸŠ', trivia:'ã¿ã‹ã‚“ â†’ ã‹ãªãŒã‚ã‘ã‚“ï¼ã‚†ãŒã‚ã‚‰ã¿ã‹ã‚“ğŸŠ' },
  ]},
  { id:'niigata', name:'ã«ã„ãŒãŸ', emoji:'ğŸŒ¾', bg:'linear-gradient(135deg,#1B5E20,#558B2F)', items:[
    { name:'ã‚³ã‚·ãƒ’ã‚«ãƒª', emoji:'ğŸš', trivia:'ã‚³ã‚·ãƒ’ã‚«ãƒª â†’ ã«ã„ãŒãŸã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ãŠã‚³ãƒ¡ğŸš' },
    { name:'ãˆã ã¾ã‚', emoji:'ğŸ«›', trivia:'ãˆã ã¾ã‚ â†’ ã«ã„ãŒãŸã‘ã‚“ï¼ã—ã‚…ã†ã‹ãã‚Šã‚‡ã†æ—¥æœ¬ä¸€ğŸ«›' },
    { name:'ãƒãƒ¥ãƒ¼ãƒªãƒƒãƒ—', emoji:'ğŸŒ·', trivia:'ãƒãƒ¥ãƒ¼ãƒªãƒƒãƒ— â†’ ã«ã„ãŒãŸã‘ã‚“ï¼ãã‚Œã„ãªã¯ãŸã‘ğŸŒ·' },
  ]},
  { id:'toyama', name:'ã¨ã‚„ã¾', emoji:'ğŸ”ï¸', bg:'linear-gradient(135deg,#01579B,#0277BD)', items:[
    { name:'ã¾ã™ãšã—', emoji:'ğŸ£', trivia:'ã¾ã™ãšã— â†’ ã¨ã‚„ã¾ã‘ã‚“ï¼ãˆãã¹ã‚“ã§ã‚†ã†ã‚ã„ğŸ£' },
    { name:'ãƒ›ã‚¿ãƒ«ã‚¤ã‚«', emoji:'ğŸ¦‘', trivia:'ãƒ›ã‚¿ãƒ«ã‚¤ã‚« â†’ ã¨ã‚„ã¾ã‘ã‚“ï¼ã²ã‹ã‚‹ã‚¤ã‚«ğŸ¦‘' },
    { name:'ãã™ã‚Š', emoji:'ğŸ’Š', trivia:'ãã™ã‚Š â†’ ã¨ã‚„ã¾ã‘ã‚“ï¼ã‚€ã‹ã—ã‹ã‚‰ãã™ã‚Šã®ã¾ã¡ğŸ’Š' },
  ]},
  { id:'ishikawa', name:'ã„ã—ã‹ã‚', emoji:'ğŸ¯', bg:'linear-gradient(135deg,#827717,#9E9D24)', items:[
    { name:'ãã‚“ã±ã', emoji:'âœ¨', trivia:'ãã‚“ã±ã â†’ ã„ã—ã‹ã‚ã‘ã‚“ï¼ã«ã»ã‚“ã®ã»ã¨ã‚“ã©ãŒã“ã“âœ¨' },
    { name:'ã‹ãŒã‚„ã•ã„', emoji:'ğŸ¥•', trivia:'ã‹ãŒã‚„ã•ã„ â†’ ã„ã—ã‹ã‚ã‘ã‚“ï¼ã§ã‚“ã¨ã†ã‚„ã•ã„ğŸ¥•' },
    { name:'ã‚ã˜ã¾ã¬ã‚Š', emoji:'ğŸ²', trivia:'ã‚ã˜ã¾ã¬ã‚Š â†’ ã„ã—ã‹ã‚ã‘ã‚“ï¼ã†ã¤ãã—ã„ã†ã‚‹ã—ã¬ã‚Š' },
  ]},
  { id:'fukui', name:'ãµãã„', emoji:'ğŸ‘“', bg:'linear-gradient(135deg,#311B92,#5E35B1)', items:[
    { name:'ã‚ãŒã­', emoji:'ğŸ‘“', trivia:'ã‚ãŒã­ â†’ ãµãã„ã‘ã‚“ï¼ã«ã»ã‚“ã®9ã‚ã‚Šã‚’ã›ã„ã•ã‚“ğŸ‘“' },
    { name:'ãˆã¡ãœã‚“ãŒã«', emoji:'ğŸ¦€', trivia:'ãˆã¡ãœã‚“ãŒã« â†’ ãµãã„ã‘ã‚“ï¼ãµã‚†ã®ã”ã¡ãã†ğŸ¦€' },
    { name:'ã¸ã—ã“', emoji:'ğŸŸ', trivia:'ã¸ã—ã“ â†’ ãµãã„ã‘ã‚“ï¼ã•ã°ã®ã¤ã‘ã‚‚ã®ğŸŸ' },
  ]},
  { id:'yamanashi', name:'ã‚„ã¾ãªã—', emoji:'ğŸ‡', bg:'linear-gradient(135deg,#4A148C,#7B1FA2)', items:[
    { name:'ã¶ã©ã†', emoji:'ğŸ‡', trivia:'ã¶ã©ã† â†’ ã‚„ã¾ãªã—ã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã•ã‚“ã¡ğŸ‡' },
    { name:'ã‚‚ã‚‚', emoji:'ğŸ‘', trivia:'ã‚‚ã‚‚ â†’ ã‚„ã¾ãªã—ã‘ã‚“ï¼ã›ã„ã•ã‚“ã‚Šã‚‡ã†æ—¥æœ¬ä¸€ğŸ‘' },
    { name:'ã»ã†ã¨ã†', emoji:'ğŸ²', trivia:'ã»ã†ã¨ã† â†’ ã‚„ã¾ãªã—ã‘ã‚“ï¼ãµã¨ã‚ã‚“ã®ãªã¹ğŸ²' },
  ]},
  { id:'nagano', name:'ãªãŒã®', emoji:'ğŸ', bg:'linear-gradient(135deg,#1B5E20,#2E7D32)', items:[
    { name:'ã‚Šã‚“ã”', emoji:'ğŸ', trivia:'ã‚Šã‚“ã” â†’ ãªãŒã®ã‘ã‚“ï¼æ—¥æœ¬2ã„ã®ã•ã‚“ã¡ğŸ' },
    { name:'ãã°', emoji:'ğŸœ', trivia:'ãã° â†’ ãªãŒã®ã‘ã‚“ï¼ã—ã‚“ã—ã‚…ã†ãã°ãŒã‚†ã†ã‚ã„ğŸœ' },
    { name:'ã‚ã•ã³', emoji:'ğŸŸ¢', trivia:'ã‚ã•ã³ â†’ ãªãŒã®ã‘ã‚“ï¼ã‚ãšã¿ã®ãŒã•ã‚“ã¡ğŸŸ¢' },
  ]},
  { id:'gifu', name:'ããµ', emoji:'ğŸ®', bg:'linear-gradient(135deg,#BF360C,#E64A19)', items:[
    { name:'ã‹ã', emoji:'ğŸŸ ', trivia:'ã‹ã â†’ ããµã‘ã‚“ï¼ãµã‚†ã®ãã ã‚‚ã®ğŸŸ ' },
    { name:'ã²ã ãã‚…ã†', emoji:'ğŸ¥©', trivia:'ã²ã ãã‚…ã† â†’ ããµã‘ã‚“ï¼ã“ã†ãã‚…ã†ãªãŠã«ãğŸ¥©' },
    { name:'ã†ã‹ã„', emoji:'ğŸ¦', trivia:'ã†ã‹ã„ â†’ ããµã‘ã‚“ï¼ãªãŒã‚‰ãŒã‚ã®ã§ã‚“ã¨ã†ğŸ¦' },
  ]},
  { id:'shizuoka', name:'ã—ãšãŠã‹', emoji:'ğŸ—»', bg:'linear-gradient(135deg,#1B5E20,#43A047)', items:[
    { name:'ãŠã¡ã‚ƒ', emoji:'ğŸµ', trivia:'ãŠã¡ã‚ƒ â†’ ã—ãšãŠã‹ã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã¡ã‚ƒã©ã“ã‚ğŸµ' },
    { name:'ã†ãªã', emoji:'ğŸŸ', trivia:'ã†ãªã â†’ ã—ãšãŠã‹ã‘ã‚“ï¼ã¯ã¾ã¾ã¤ãŒã‚†ã†ã‚ã„ğŸŸ' },
    { name:'ã¿ã‹ã‚“', emoji:'ğŸŠ', trivia:'ã¿ã‹ã‚“ â†’ ã—ãšãŠã‹ã‘ã‚“ï¼ã²ã–ã—ãŸã£ã·ã‚ŠğŸŠ' },
  ]},
  { id:'aichi', name:'ã‚ã„ã¡', emoji:'ğŸ­', bg:'linear-gradient(135deg,#E65100,#F9A825)', items:[
    { name:'ã˜ã©ã†ã—ã‚ƒ', emoji:'ğŸš—', trivia:'ã˜ã©ã†ã—ã‚ƒ â†’ ã‚ã„ã¡ã‘ã‚“ï¼ãƒˆãƒ¨ã‚¿ã®ãŠã²ã–ã‚‚ã¨ğŸš—' },
    { name:'ã¿ãã‹ã¤', emoji:'ğŸ–', trivia:'ã¿ãã‹ã¤ â†’ ã‚ã„ã¡ã‘ã‚“ï¼ã¯ã£ã¡ã‚‡ã†ã¿ãã§ãŸã¹ã‚‹ğŸ–' },
    { name:'ãˆã³ã›ã‚“ã¹ã„', emoji:'ğŸ˜', trivia:'ãˆã³ã›ã‚“ã¹ã„ â†’ ã‚ã„ã¡ã‘ã‚“ï¼ã‚†ã†ã‚ã„ãªãŠã‹ã—ğŸ˜' },
  ]},
  { id:'mie', name:'ã¿ãˆ', emoji:'ğŸ¦', bg:'linear-gradient(135deg,#00695C,#00897B)', items:[
    { name:'ã„ã›ãˆã³', emoji:'ğŸ¦', trivia:'ã„ã›ãˆã³ â†’ ã¿ãˆã‘ã‚“ï¼ã„ã›ã—ã¾ã®ã”ã¡ãã†ğŸ¦' },
    { name:'ã¾ã¤ã•ã‹ã†ã—', emoji:'ğŸ„', trivia:'ã¾ã¤ã•ã‹ã†ã— â†’ ã¿ãˆã‘ã‚“ï¼ã•ã„ã“ã†ãã‚…ã†ã®ãŠã«ãğŸ„' },
    { name:'ã—ã‚“ã˜ã‚…', emoji:'ğŸ’', trivia:'ã—ã‚“ã˜ã‚… â†’ ã¿ãˆã‘ã‚“ï¼ã—ã‚“ã˜ã‚…ã‚ˆã†ã—ã‚‡ãã¯ã£ã—ã‚‡ã†ã®ã¡ğŸ’' },
  ]},
  { id:'shiga', name:'ã—ãŒ', emoji:'ğŸŒŠ', bg:'linear-gradient(135deg,#0277BD,#0288D1)', items:[
    { name:'ãµãªãšã—', emoji:'ğŸŸ', trivia:'ãµãªãšã— â†’ ã—ãŒã‘ã‚“ï¼ã³ã‚ã“ã®ã§ã‚“ã¨ã†ã‚Šã‚‡ã†ã‚ŠğŸŸ' },
    { name:'ã—ãŒã‚‰ãã‚„ã', emoji:'ğŸµ', trivia:'ã—ãŒã‚‰ãã‚„ã â†’ ã—ãŒã‘ã‚“ï¼ãŸã¬ãã®ãŠãã‚‚ã®ãŒã‚†ã†ã‚ã„ğŸµ' },
    { name:'ã«ã‚“ã˜ã‚“', emoji:'ğŸ¥•', trivia:'ã«ã‚“ã˜ã‚“ â†’ ã—ãŒã‘ã‚“ï¼ãã‚“ã“ã†ã«ã‚“ã˜ã‚“ãŒã‚†ã†ã‚ã„ğŸ¥•' },
  ]},
  { id:'kyoto', name:'ãã‚‡ã†ã¨', emoji:'â›©ï¸', bg:'linear-gradient(135deg,#880E4F,#AD1457)', items:[
    { name:'ã‚„ã¤ã¯ã—', emoji:'ğŸ¡', trivia:'ã‚„ã¤ã¯ã— â†’ ãã‚‡ã†ã¨ï¼ã«ã‚“ãã®ãŠã¿ã‚„ã’ğŸ¡' },
    { name:'ã¾ã£ã¡ã‚ƒ', emoji:'ğŸµ', trivia:'ã¾ã£ã¡ã‚ƒ â†’ ãã‚‡ã†ã¨ï¼ã†ã˜ã¡ã‚ƒãŒã‚†ã†ã‚ã„ğŸµ' },
    { name:'ãã‚‡ã†ã‚„ã•ã„', emoji:'ğŸ¥¬', trivia:'ãã‚‡ã†ã‚„ã•ã„ â†’ ãã‚‡ã†ã¨ï¼ã§ã‚“ã¨ã†ã‚„ã•ã„ãŒãŸãã•ã‚“ğŸ¥¬' },
  ]},
  { id:'osaka', name:'ãŠãŠã•ã‹', emoji:'ğŸ¯', bg:'linear-gradient(135deg,#E65100,#FF6F00)', items:[
    { name:'ãŸã“ã‚„ã', emoji:'ğŸ™', trivia:'ãŸã“ã‚„ã â†’ ãŠãŠã•ã‹ï¼ãã„ã ãŠã‚Œã®ã¾ã¡ğŸ™' },
    { name:'ãŠã“ã®ã¿ã‚„ã', emoji:'ğŸ¥', trivia:'ãŠã“ã®ã¿ã‚„ã â†’ ãŠãŠã•ã‹ï¼ã“ãªã‚‚ã‚“ã¶ã‚“ã‹ğŸ¥' },
    { name:'ã¶ãŸã¾ã‚“', emoji:'ğŸ¥Ÿ', trivia:'ã¶ãŸã¾ã‚“ â†’ ãŠãŠã•ã‹ï¼551ã®ã¶ãŸã¾ã‚“ğŸ¥Ÿ' },
  ]},
  { id:'hyogo', name:'ã²ã‚‡ã†ã”', emoji:'ğŸ„', bg:'linear-gradient(135deg,#1A237E,#283593)', items:[
    { name:'ã“ã†ã¹ãã‚…ã†', emoji:'ğŸ¥©', trivia:'ã“ã†ã¹ãã‚…ã† â†’ ã²ã‚‡ã†ã”ã‘ã‚“ï¼ã›ã‹ã„ã¦ãã«ã‚†ã†ã‚ã„ğŸ¥©' },
    { name:'ãŸã¾ã­ã', emoji:'ğŸ§…', trivia:'ãŸã¾ã­ã â†’ ã²ã‚‡ã†ã”ã‘ã‚“ï¼ã‚ã‚ã˜ã—ã¾ãŒã‚†ã†ã‚ã„ğŸ§…' },
    { name:'ãã†ã‚ã‚“', emoji:'ğŸœ', trivia:'ã„ã¼ã®ã„ã¨ â†’ ã²ã‚‡ã†ã”ã‘ã‚“ï¼ã‚†ã†ã‚ã„ãªãã†ã‚ã‚“ğŸœ' },
  ]},
  { id:'nara', name:'ãªã‚‰', emoji:'ğŸ¦Œ', bg:'linear-gradient(135deg,#4E342E,#6D4C41)', items:[
    { name:'ã‹ãã®ã¯ãšã—', emoji:'ğŸ£', trivia:'ã‹ãã®ã¯ãšã— â†’ ãªã‚‰ã‘ã‚“ï¼ã¯ã£ã±ã«ã¤ã¤ã‚“ã ãŠã™ã—ğŸ£' },
    { name:'ããšã‚‚ã¡', emoji:'ğŸ¡', trivia:'ããšã‚‚ã¡ â†’ ãªã‚‰ã‘ã‚“ï¼ã‚ˆã—ã®ããšãŒã‚†ã†ã‚ã„ğŸ¡' },
    { name:'ã™ã¿', emoji:'ğŸ–Šï¸', trivia:'ã™ã¿ â†’ ãªã‚‰ã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã™ã¿ã®ã•ã‚“ã¡ğŸ–Šï¸' },
  ]},
  { id:'wakayama', name:'ã‚ã‹ã‚„ã¾', emoji:'ğŸŠ', bg:'linear-gradient(135deg,#E65100,#FF8F00)', items:[
    { name:'ã¿ã‹ã‚“', emoji:'ğŸŠ', trivia:'ã¿ã‹ã‚“ â†’ ã‚ã‹ã‚„ã¾ã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã•ã‚“ã¡ğŸŠ' },
    { name:'ã†ã‚ã¼ã—', emoji:'ğŸ”´', trivia:'ã†ã‚ã¼ã— â†’ ã‚ã‹ã‚„ã¾ã‘ã‚“ï¼ãªã‚“ã“ã†ã†ã‚ãŒã‚†ã†ã‚ã„' },
    { name:'ã—ã‚‡ã†ã‚†', emoji:'ğŸ«™', trivia:'ã—ã‚‡ã†ã‚† â†’ ã‚ã‹ã‚„ã¾ã‘ã‚“ï¼ã‚†ã‚ã•ãŒã¯ã£ã—ã‚‡ã†ã®ã¡ğŸ«™' },
  ]},
  { id:'tottori', name:'ã¨ã£ã¨ã‚Š', emoji:'ğŸ–ï¸', bg:'linear-gradient(135deg,#F9A825,#FBC02D)', items:[
    { name:'ã«ã˜ã£ã›ã„ããªã—', emoji:'ğŸ', trivia:'ã«ã˜ã£ã›ã„ããªã— â†’ ã¨ã£ã¨ã‚Šã‘ã‚“ï¼ã‚ã¾ã„ãªã—ğŸ' },
    { name:'ã™ãªã®ã•ãã‚…ã†', emoji:'ğŸ–ï¸', trivia:'ã™ãªã®ã•ãã‚…ã† â†’ ã¨ã£ã¨ã‚Šã‘ã‚“ï¼ã«ã»ã‚“ã•ã„ã ã„ğŸ–ï¸' },
    { name:'ã‚ºãƒ¯ã‚¤ã‚¬ãƒ‹', emoji:'ğŸ¦€', trivia:'ã‚ºãƒ¯ã‚¤ã‚¬ãƒ‹ â†’ ã¨ã£ã¨ã‚Šã‘ã‚“ï¼ãµã‚†ã®ã‚ã˜ã‹ãğŸ¦€' },
  ]},
  { id:'shimane', name:'ã—ã¾ã­', emoji:'â›©ï¸', bg:'linear-gradient(135deg,#37474F,#546E7A)', items:[
    { name:'ã—ã˜ã¿', emoji:'ğŸš', trivia:'ã—ã˜ã¿ â†’ ã—ã¾ã­ã‘ã‚“ï¼ã—ã‚“ã˜ã“ã§ã¨ã‚Œã‚‹ğŸš' },
    { name:'ã„ãšã‚‚ãã°', emoji:'ğŸœ', trivia:'ã„ãšã‚‚ãã° â†’ ã—ã¾ã­ã‘ã‚“ï¼ã“ã„ã„ã‚ã®ãã°ğŸœ' },
    { name:'ã‚ã®ã†', emoji:'ğŸ’', trivia:'ã‚ã®ã† â†’ ã—ã¾ã­ã‘ã‚“ï¼ã†ã¤ãã—ã„ã„ã—ğŸ’' },
  ]},
  { id:'okayama', name:'ãŠã‹ã‚„ã¾', emoji:'ğŸ‘', bg:'linear-gradient(135deg,#FF6F00,#FF8F00)', items:[
    { name:'ã‚‚ã‚‚', emoji:'ğŸ‘', trivia:'ã‚‚ã‚‚ â†’ ãŠã‹ã‚„ã¾ã‘ã‚“ï¼ã¯ãã¨ã†ãŒã‚†ã†ã‚ã„ğŸ‘' },
    { name:'ãƒã‚¹ã‚«ãƒƒãƒˆ', emoji:'ğŸ‡', trivia:'ãƒã‚¹ã‚«ãƒƒãƒˆ â†’ ãŠã‹ã‚„ã¾ã‘ã‚“ï¼ãã ã‚‚ã®ã®ãŠã†ã“ãğŸ‡' },
    { name:'ãã³ã ã‚“ã”', emoji:'ğŸ¡', trivia:'ãã³ã ã‚“ã” â†’ ãŠã‹ã‚„ã¾ã‘ã‚“ï¼ã‚‚ã‚‚ãŸã‚ã†ã®ãŠã¯ãªã—ğŸ¡' },
  ]},
  { id:'hiroshima', name:'ã²ã‚ã—ã¾', emoji:'â›©ï¸', bg:'linear-gradient(135deg,#B71C1C,#C62828)', items:[
    { name:'ã‹ã(ã‹ã„)', emoji:'ğŸ¦ª', trivia:'ã‹ã â†’ ã²ã‚ã—ã¾ã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã‚ˆã†ã—ã‚‡ãğŸ¦ª' },
    { name:'ãŠã“ã®ã¿ã‚„ã', emoji:'ğŸ¥', trivia:'ãŠã“ã®ã¿ã‚„ã â†’ ã²ã‚ã—ã¾ã‘ã‚“ï¼ãã°ã„ã‚ŠãŒã¨ãã¡ã‚‡ã†ğŸ¥' },
    { name:'ãƒ¬ãƒ¢ãƒ³', emoji:'ğŸ‹', trivia:'ãƒ¬ãƒ¢ãƒ³ â†’ ã²ã‚ã—ã¾ã‘ã‚“ï¼ã›ã„ã•ã‚“ã‚Šã‚‡ã†æ—¥æœ¬ä¸€ğŸ‹' },
  ]},
  { id:'yamaguchi', name:'ã‚„ã¾ãã¡', emoji:'ğŸ¡', bg:'linear-gradient(135deg,#004D40,#00695C)', items:[
    { name:'ãµã', emoji:'ğŸ¡', trivia:'ãµã â†’ ã‚„ã¾ãã¡ã‘ã‚“ï¼ã—ã‚‚ã®ã›ããŒã‚†ã†ã‚ã„ğŸ¡' },
    { name:'ã†ã„ã‚ã†', emoji:'ğŸ¡', trivia:'ã†ã„ã‚ã† â†’ ã‚„ã¾ãã¡ã‘ã‚“ï¼ã‚„ã‚ã‚‰ã‹ã„ãŠã‹ã—ğŸ¡' },
    { name:'ã‹ã¾ã¼ã“', emoji:'ğŸ¥', trivia:'ã‹ã¾ã¼ã“ â†’ ã‚„ã¾ãã¡ã‘ã‚“ï¼ã‚„ãã¬ãã‹ã¾ã¼ã“ğŸ¥' },
  ]},
  { id:'tokushima', name:'ã¨ãã—ã¾', emoji:'ğŸ’ƒ', bg:'linear-gradient(135deg,#00838F,#0097A7)', items:[
    { name:'ã™ã ã¡', emoji:'ğŸŸ¢', trivia:'ã™ã ã¡ â†’ ã¨ãã—ã¾ã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã•ã‚“ã¡ğŸŸ¢' },
    { name:'ãªã‚‹ã¨ãã‚“ã¨ã', emoji:'ğŸ ', trivia:'ãªã‚‹ã¨ãã‚“ã¨ã â†’ ã¨ãã—ã¾ã‘ã‚“ï¼ã‚ã¾ã„ã•ã¤ã¾ã„ã‚‚ğŸ ' },
    { name:'ã‚ã„ãã‚', emoji:'ğŸ‘˜', trivia:'ã‚ã„ãã‚ â†’ ã¨ãã—ã¾ã‘ã‚“ï¼ã§ã‚“ã¨ã†ã®ãã‚ã‚‚ã®ğŸ‘˜' },
  ]},
  { id:'kagawa', name:'ã‹ãŒã‚', emoji:'ğŸœ', bg:'linear-gradient(135deg,#BF360C,#E64A19)', items:[
    { name:'ã†ã©ã‚“', emoji:'ğŸœ', trivia:'ã†ã©ã‚“ â†’ ã‹ãŒã‚ã‘ã‚“ï¼ã€Œã†ã©ã‚“ã‘ã‚“ã€ã®ã‚ã„ã—ã‚‡ã†ğŸœ' },
    { name:'ã‚ªãƒªãƒ¼ãƒ–', emoji:'ğŸ«’', trivia:'ã‚ªãƒªãƒ¼ãƒ– â†’ ã‹ãŒã‚ã‘ã‚“ï¼ã—ã‚‡ã†ã©ã—ã¾ãŒã‚†ã†ã‚ã„ğŸ«’' },
    { name:'ã»ã­ã¤ãã©ã‚Š', emoji:'ğŸ—', trivia:'ã»ã­ã¤ãã©ã‚Š â†’ ã‹ãŒã‚ã‘ã‚“ï¼ã‚¯ãƒªã‚¹ãƒã‚¹ã®ã¦ã„ã°ã‚“ğŸ—' },
  ]},
  { id:'ehime', name:'ãˆã²ã‚', emoji:'ğŸŠ', bg:'linear-gradient(135deg,#E65100,#FF8F00)', items:[
    { name:'ã¿ã‹ã‚“', emoji:'ğŸŠ', trivia:'ã¿ã‹ã‚“ â†’ ãˆã²ã‚ã‘ã‚“ï¼ã€Œã¿ã‹ã‚“ãŠã†ã“ãã€ğŸŠ' },
    { name:'ã„ã‚ˆã‹ã‚“', emoji:'ğŸŠ', trivia:'ã„ã‚ˆã‹ã‚“ â†’ ãˆã²ã‚ã‘ã‚“ï¼ãªã¾ãˆã®ã€Œã„ã‚ˆã€ã¯æ„›åª›ã®ã“ã¨' },
    { name:'ã‚¿ã‚ªãƒ«', emoji:'ğŸ§£', trivia:'ã‚¿ã‚ªãƒ« â†’ ãˆã²ã‚ã‘ã‚“ï¼ã„ã¾ã°ã‚Šã‚¿ã‚ªãƒ«ãŒã‚†ã†ã‚ã„ğŸ§£' },
  ]},
  { id:'kochi', name:'ã“ã†ã¡', emoji:'ğŸŒŠ', bg:'linear-gradient(135deg,#006064,#0097A7)', items:[
    { name:'ã‚«ãƒ„ã‚ª', emoji:'ğŸŸ', trivia:'ã‚«ãƒ„ã‚ª â†’ ã“ã†ã¡ã‘ã‚“ï¼ã‚«ãƒ„ã‚ªã®ãŸãŸããŒã‚†ã†ã‚ã„' },
    { name:'ã‚†ãš', emoji:'ğŸ‹', trivia:'ã‚†ãš â†’ ã“ã†ã¡ã‘ã‚“ï¼ã›ã„ã•ã‚“ã‚Šã‚‡ã†æ—¥æœ¬ä¸€ğŸ‹' },
    { name:'ã—ã‚‡ã†ãŒ', emoji:'ğŸ«š', trivia:'ã—ã‚‡ã†ãŒ â†’ ã“ã†ã¡ã‘ã‚“ï¼æ—¥æœ¬ä¸€ã®ã—ã‚…ã†ã‹ãã‚Šã‚‡ã†' },
  ]},
  { id:'fukuoka', name:'ãµããŠã‹', emoji:'ğŸœ', bg:'linear-gradient(135deg,#D32F2F,#E53935)', items:[
    { name:'ã¨ã‚“ã“ã¤ãƒ©ãƒ¼ãƒ¡ãƒ³', emoji:'ğŸœ', trivia:'ã¨ã‚“ã“ã¤ãƒ©ãƒ¼ãƒ¡ãƒ³ â†’ ãµããŠã‹ã‘ã‚“ï¼ã¯ã‹ãŸãƒ©ãƒ¼ãƒ¡ãƒ³ğŸœ' },
    { name:'ã‚ã‚“ãŸã„ã“', emoji:'ğŸŸ', trivia:'ã‚ã‚“ãŸã„ã“ â†’ ãµããŠã‹ã‘ã‚“ï¼ã”ã¯ã‚“ã®ãŠã¨ã‚‚ğŸŸ' },
    { name:'ã‚ã¾ãŠã†', emoji:'ğŸ“', trivia:'ã‚ã¾ãŠã† â†’ ãµããŠã‹ã‘ã‚“ï¼ãŠãŠããã¦ã‚ã¾ã„ã„ã¡ã”ğŸ“' },
  ]},
  { id:'saga', name:'ã•ãŒ', emoji:'ğŸ¶', bg:'linear-gradient(135deg,#1B5E20,#388E3C)', items:[
    { name:'ã„ã¾ã‚Šã‚„ã', emoji:'ğŸ¶', trivia:'ã„ã¾ã‚Šã‚„ã â†’ ã•ãŒã‘ã‚“ï¼ã†ã¤ãã—ã„ã‚„ãã‚‚ã®ğŸ¶' },
    { name:'ã•ãŒãã‚…ã†', emoji:'ğŸ¥©', trivia:'ã•ãŒãã‚…ã† â†’ ã•ãŒã‘ã‚“ï¼ã‚„ã‚ã‚‰ã‹ã„ãŠã«ãğŸ¥©' },
    { name:'ã®ã‚Š', emoji:'ğŸŒ¿', trivia:'ã®ã‚Š â†’ ã•ãŒã‘ã‚“ï¼ã‚ã‚Šã‚ã‘ã‹ã„ã®ã®ã‚ŠğŸŒ¿' },
  ]},
  { id:'nagasaki', name:'ãªãŒã•ã', emoji:'â›ª', bg:'linear-gradient(135deg,#0D47A1,#1976D2)', items:[
    { name:'ã‚«ã‚¹ãƒ†ãƒ©', emoji:'ğŸ°', trivia:'ã‚«ã‚¹ãƒ†ãƒ© â†’ ãªãŒã•ãã‘ã‚“ï¼ãƒãƒ«ãƒˆã‚¬ãƒ«ã‹ã‚‰ã¤ãŸã‚ã£ãŸğŸ°' },
    { name:'ã¡ã‚ƒã‚“ã½ã‚“', emoji:'ğŸœ', trivia:'ã¡ã‚ƒã‚“ã½ã‚“ â†’ ãªãŒã•ãã‘ã‚“ï¼ãã–ã„ãŸã£ã·ã‚Šã‚ã‚“ğŸœ' },
    { name:'ã³ã‚', emoji:'ğŸŸ ', trivia:'ã³ã‚ â†’ ãªãŒã•ãã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã•ã‚“ã¡ğŸŸ ' },
  ]},
  { id:'kumamoto', name:'ãã¾ã‚‚ã¨', emoji:'ğŸ»', bg:'linear-gradient(135deg,#212121,#424242)', items:[
    { name:'ã‹ã‚‰ã—ã‚Œã‚“ã“ã‚“', emoji:'ğŸ¥¬', trivia:'ã‹ã‚‰ã—ã‚Œã‚“ã“ã‚“ â†’ ãã¾ã‚‚ã¨ã‘ã‚“ï¼ãƒ”ãƒªãƒƒã¨ã‹ã‚‰ã„ğŸ¥¬' },
    { name:'ã™ã„ã‹', emoji:'ğŸ‰', trivia:'ã™ã„ã‹ â†’ ãã¾ã‚‚ã¨ã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã•ã‚“ã¡ğŸ‰' },
    { name:'ã°ã•ã—', emoji:'ğŸ´', trivia:'ã°ã•ã— â†’ ãã¾ã‚‚ã¨ã‘ã‚“ï¼ã†ã¾ã®ãŠã•ã—ã¿ğŸ´' },
  ]},
  { id:'oita', name:'ãŠãŠã„ãŸ', emoji:'â™¨ï¸', bg:'linear-gradient(135deg,#E65100,#BF360C)', items:[
    { name:'ãŠã‚“ã›ã‚“', emoji:'â™¨ï¸', trivia:'ãŠã‚“ã›ã‚“ â†’ ãŠãŠã„ãŸã‘ã‚“ï¼ã¹ã£ã·ãŠã‚“ã›ã‚“ãŒã‚†ã†ã‚ã„â™¨ï¸' },
    { name:'ã‹ã¼ã™', emoji:'ğŸŸ¢', trivia:'ã‹ã¼ã™ â†’ ãŠãŠã„ãŸã‘ã‚“ï¼ã«ã»ã‚“ã„ã¡ã®ã•ã‚“ã¡ğŸŸ¢' },
    { name:'ã¨ã‚Šã¦ã‚“', emoji:'ğŸ—', trivia:'ã¨ã‚Šã¦ã‚“ â†’ ãŠãŠã„ãŸã‘ã‚“ï¼ã¨ã‚Šã«ãã®ã¦ã‚“ã·ã‚‰ğŸ—' },
  ]},
  { id:'miyazaki', name:'ã¿ã‚„ã–ã', emoji:'ğŸŒ´', bg:'linear-gradient(135deg,#00838F,#00ACC1)', items:[
    { name:'ãƒãƒ³ã‚´ãƒ¼', emoji:'ğŸ¥­', trivia:'ãƒãƒ³ã‚´ãƒ¼ â†’ ã¿ã‚„ã–ãã‘ã‚“ï¼ãŸã„ã‚ˆã†ã®ã‚¿ãƒã‚´ğŸ¥­' },
    { name:'ãƒã‚­ãƒ³ãªã‚“ã°ã‚“', emoji:'ğŸ—', trivia:'ãƒã‚­ãƒ³ãªã‚“ã°ã‚“ â†’ ã¿ã‚„ã–ãã‘ã‚“ï¼ã‚¿ãƒ«ã‚¿ãƒ«ã‚½ãƒ¼ã‚¹ğŸ—' },
    { name:'ãã‚…ã†ã‚Š', emoji:'ğŸ¥’', trivia:'ãã‚…ã†ã‚Š â†’ ã¿ã‚„ã–ãã‘ã‚“ï¼ãµã‚†ã‚‚ã‚ãŸãŸã‹ã„ğŸ¥’' },
  ]},
  { id:'kagoshima', name:'ã‹ã”ã—ã¾', emoji:'ğŸŒ‹', bg:'linear-gradient(135deg,#37474F,#546E7A)', items:[
    { name:'ãã‚ã¶ãŸ', emoji:'ğŸ·', trivia:'ãã‚ã¶ãŸ â†’ ã‹ã”ã—ã¾ã‘ã‚“ï¼ãŠã„ã—ã„ã¶ãŸã«ãğŸ·' },
    { name:'ã•ã¤ã¾ã„ã‚‚', emoji:'ğŸ ', trivia:'ã•ã¤ã¾ã„ã‚‚ â†’ ã‹ã”ã—ã¾ã‘ã‚“ï¼ãªã¾ãˆã®ã‚†ã‚‰ã„ğŸ ' },
    { name:'ã•ã¤ã¾ã‚ã’', emoji:'ğŸ¢', trivia:'ã•ã¤ã¾ã‚ã’ â†’ ã‹ã”ã—ã¾ã‘ã‚“ï¼ãŠã•ã‹ãªã®ã™ã‚Šã¿ğŸ¢' },
  ]},
  { id:'okinawa', name:'ãŠããªã‚', emoji:'ğŸŒº', bg:'linear-gradient(135deg,#B71C1C,#E53935)', items:[
    { name:'ã•ã¨ã†ãã³', emoji:'ğŸŒ¿', trivia:'ã•ã¨ã†ãã³ â†’ ãŠããªã‚ã‘ã‚“ï¼ã‚ãŸãŸã‹ã„ãã“ã†ã§ã™ãã™ã' },
    { name:'ãƒ‘ã‚¤ãƒŠãƒƒãƒ—ãƒ«', emoji:'ğŸ', trivia:'ãƒ‘ã‚¤ãƒŠãƒƒãƒ—ãƒ« â†’ ãŠããªã‚ã‘ã‚“ï¼ã«ã»ã‚“ã‚†ã„ã„ã¤ã®ã•ã‚“ã¡ğŸ' },
    { name:'ã‚´ãƒ¼ãƒ¤', emoji:'ğŸ¥’', trivia:'ã‚´ãƒ¼ãƒ¤ â†’ ãŠããªã‚ã‘ã‚“ï¼ã‚´ãƒ¼ãƒ¤ãƒãƒ£ãƒ³ãƒ—ãƒ«ãƒ¼ğŸ¥’' },
  ]},
];

// Level configs: regionCount + game params only
const LEVEL_CONFIGS = [
  { name: 'ãƒ¬ãƒ™ãƒ«1', regionCount: 2, speed: 0.6, interval: 2800, total: 10 },
  { name: 'ãƒ¬ãƒ™ãƒ«2', regionCount: 3, speed: 0.8, interval: 2400, total: 14 },
  { name: 'ãƒ¬ãƒ™ãƒ«3', regionCount: 4, speed: 1.0, interval: 2000, total: 16 },
  { name: 'ãƒ¬ãƒ™ãƒ«4', regionCount: 5, speed: 1.2, interval: 1800, total: 18 },
];

// Dynamically build a level by picking random prefectures
function buildLevel(configIdx) {
  const config = LEVEL_CONFIGS[configIdx];
  const picked = shuffle(PREFECTURES).slice(0, config.regionCount);
  const regions = picked.map(p => ({ name: p.name, emoji: p.emoji, bg: p.bg }));
  const items = [];
  picked.forEach((p, rIdx) => {
    p.items.forEach(it => {
      items.push({ name: it.name, emoji: it.emoji, region: rIdx, trivia: it.trivia });
    });
  });
  return { name: config.name, regions, items, speed: config.speed, interval: config.interval, total: config.total };
}


const CARD_COLOR='linear-gradient(135deg,#4A4A5A,#5C5C6E)';

// ===== ALT SYSTEM =====
let altTotal=0, altSession=0, clearedLevels={};
function updateAltBadge(){document.getElementById('alt-display').textContent=altTotal;updateLineBtn()}
function getStarRating(c,t){if(t===0)return 0;const r=c/t;if(r>=1)return 3;if(r>=0.8)return 2;return 1}
function getStarBonus(s,alive){if(!alive)return 0;if(s===3)return 10;if(s===2)return 6;return 3}

// ===== RANKING SYSTEM =====
const RANK_KEY_WEEKLY='tokusan_rank_weekly';
const RANK_KEY_ALLTIME='tokusan_rank_alltime';
const RANK_KEY_WEEK='tokusan_rank_weekstart';
const NAME_KEY='tokusan_player_name';
let currentRankTab='weekly';
let lastRegisteredScore=null; // prevent double register
let cameFromResult=false; // track navigation

function getMonday4am(){
  const now=new Date();
  const d=new Date(now);
  const day=d.getDay();
  const diff=day===0?6:day-1;
  d.setDate(d.getDate()-diff);
  d.setHours(4,0,0,0);
  if(now<d)d.setDate(d.getDate()-7);
  return d.getTime();
}

function getWeekEnd(start){const e=new Date(start);e.setDate(e.getDate()+7);return e}

function loadRanking(key){try{return JSON.parse(localStorage.getItem(key))||[]}catch(e){return[]}}
function saveRanking(key,data){localStorage.setItem(key,JSON.stringify(data))}

function checkWeeklyReset(){
  const mondayTs=getMonday4am();
  const saved=parseInt(localStorage.getItem(RANK_KEY_WEEK)||'0');
  if(saved<mondayTs){
    localStorage.setItem(RANK_KEY_WEEK,mondayTs.toString());
    saveRanking(RANK_KEY_WEEKLY,[]);
  }
}

function addToRanking(name,scr){
  checkWeeklyReset();
  let isNewBest=false;
  // Weekly: keep best per name
  let weekly=loadRanking(RANK_KEY_WEEKLY);
  const wi=weekly.findIndex(e=>e.name===name);
  if(wi>=0){
    if(scr>weekly[wi].score){weekly[wi].score=scr;isNewBest=true}
  }else{weekly.push({name,score:scr});isNewBest=true}
  weekly.sort((a,b)=>b.score-a.score);
  saveRanking(RANK_KEY_WEEKLY,weekly);
  const weeklyRank=weekly.findIndex(e=>e.name===name)+1;

  // Alltime: top 20
  let alltime=loadRanking(RANK_KEY_ALLTIME);
  const ai=alltime.findIndex(e=>e.name===name);
  if(ai>=0){
    if(scr>alltime[ai].score)alltime[ai].score=scr;
  }else{alltime.push({name,score:scr})}
  alltime.sort((a,b)=>b.score-a.score);
  alltime=alltime.slice(0,20);
  saveRanking(RANK_KEY_ALLTIME,alltime);
  const atRank=alltime.findIndex(e=>e.name===name)+1;

  return{weeklyRank,weeklyTotal:weekly.length,alltimeRank:atRank||'-',isNewBest};
}

function getSavedName(){return localStorage.getItem(NAME_KEY)||''}
function saveName(n){localStorage.setItem(NAME_KEY,n)}

// Ranking UI
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.getElementById('alt-badge').style.display=(id==='title-screen'||id==='ranking-screen')?'block':'none';
}

function showNameModal(){
  const input=document.getElementById('rank-name-input');
  input.value=getSavedName();
  document.getElementById('name-modal').classList.add('show');
  setTimeout(()=>input.focus(),100);
}
function hideModal(id){document.getElementById(id).classList.remove('show')}

function doRegister(){
  const name=document.getElementById('rank-name-input').value.trim();
  if(!name)return;
  saveName(name);
  hideModal('name-modal');
  // Also update LINE name field
  document.getElementById('line-name').value=name;
  const result=addToRanking(name,score);
  lastRegisteredScore=score;

  // Show result in rank area
  const area=document.getElementById('result-rank-area');
  let html='<div class="rank-result">';
  if(result.isNewBest)html+='<div class="new-best">ğŸ†• ã˜ã“ãƒ™ã‚¹ãƒˆ ã“ã†ã—ã‚“ï¼</div>';
  html+=`ğŸ“Š ã—ã‚…ã†ã‹ã‚“ <strong>${result.weeklyRank}ä½</strong> / ${result.weeklyTotal}äºº<br>`;
  html+=`ğŸ‘‘ ã‚Œãã ã„ <strong>${result.alltimeRank>0?result.alltimeRank+'ä½':'--'}</strong>`;
  html+='</div>';
  html+='<span class="rank-link" onclick="cameFromResult=true;showScreen(\'ranking-screen\');renderRanking()">â–¶ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ã¿ã‚‹</span>';
  area.innerHTML=html;
}

function goBackFromRanking(){
  if(cameFromResult){cameFromResult=false;showScreen('result-screen');document.getElementById('alt-badge').style.display='none'}
  else{goTitle()}
}

function switchRankTab(tab){
  currentRankTab=tab;
  document.getElementById('tab-weekly').classList.toggle('active',tab==='weekly');
  document.getElementById('tab-alltime').classList.toggle('active',tab==='alltime');
  renderRanking();
}

function renderRanking(){
  checkWeeklyReset();
  const isWeekly=currentRankTab==='weekly';
  const data=loadRanking(isWeekly?RANK_KEY_WEEKLY:RANK_KEY_ALLTIME);
  const myName=getSavedName();
  const periodEl=document.getElementById('rank-period');
  if(isWeekly){
    const ms=getMonday4am();
    const s=new Date(ms);const e=getWeekEnd(ms);
    periodEl.textContent=`${s.getMonth()+1}/${s.getDate()}(æœˆ) ã€œ ${e.getMonth()+1}/${e.getDate()}(æ—¥)`;
  }else{periodEl.textContent='ğŸ† ã§ã‚“ã©ã†ã„ã‚Š TOP20'}
  const list=document.getElementById('rank-list');
  if(data.length===0){list.innerHTML='<div class="rank-empty">ã¾ã ã¨ã†ã‚ããŒã‚ã‚Šã¾ã›ã‚“</div>';return}
  const top10=data.slice(0,10);
  const medals=['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  let html='';
  top10.forEach((e,i)=>{
    const isMe=e.name===myName;
    const isTop3=i<3;
    html+=`<div class="rank-row${isMe?' me':''}${isTop3?' top3':''}">`;
    html+=`<div class="rank-pos">${i<3?medals[i]:(i+1)}</div>`;
    html+=`<div class="rank-name">${e.name}</div>`;
    html+=`<div class="rank-score">${e.score.toLocaleString()}</div></div>`;
  });
  // Show my position if not in top 10
  const myIdx=data.findIndex(e=>e.name===myName);
  if(myName&&myIdx>=10){
    html+='<hr class="rank-divider">';
    html+=`<div class="rank-row me"><div class="rank-pos">${myIdx+1}</div>`;
    html+=`<div class="rank-name">ğŸ“ ${data[myIdx].name}</div>`;
    html+=`<div class="rank-score">${data[myIdx].score.toLocaleString()}</div></div>`;
  }
  list.innerHTML=html;
}

// LINE Report
function updateLineBtn(){
  const name=document.getElementById('line-name').value.trim();
  document.getElementById('line-btn').disabled=(altTotal<=0||name.length===0);
}
function showLineConfirm(){
  document.getElementById('line-confirm-msg').innerHTML='<strong>'+altTotal+'</strong> ALTã‚’ã»ã†ã“ãã—ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™';
  document.getElementById('line-confirm-modal').classList.add('show');
}
function doLineReport(){
  hideModal('line-confirm-modal');
  const name=document.getElementById('line-name').value.trim();
  const cleared=Object.keys(clearedLevels).length;
  const text=`ã€ã¨ãã•ã‚“ã¶ã¤ãƒãƒƒãƒãƒ³ã‚° ALTã»ã†ã“ãã€‘\nãªã¾ãˆ: ${name}\nğŸ’° ${altTotal}ALT\nã‚¯ãƒªã‚¢ãšã¿: ãƒ¬ãƒ™ãƒ«${cleared}/4`;
  const url=`https://line.me/R/oaMessage/@trail_official/?${encodeURIComponent(text)}`;
  altTotal=0;altSession=0;updateAltBadge();
  window.open(url,'_blank');
}

// ===== STATE =====
let currentLevel=0,score=0,combo=0,maxCombo=0,lives=3;
let correctCount=0,missCount=0,totalSpawned=0;
let gameActive=false,spawnTimer=null,animFrame=null;
let cards=[],shuffledItems=[],itemIndex=0,results=[];
let isFever=false,feverEl=null,dragCard=null;
let dragOffsetX=0,dragOffsetY=0;
let currentLevelData=null;
let freezeUntil=0;
let feverCounterEl=null;

// ===== SOUNDS =====
const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
function playSound(type){
  const now=audioCtx.currentTime;const osc=audioCtx.createOscillator();const gain=audioCtx.createGain();
  osc.connect(gain);gain.connect(audioCtx.destination);
  if(type==='correct'){osc.type='sine';osc.frequency.setValueAtTime(523,now);osc.frequency.setValueAtTime(659,now+0.08);osc.frequency.setValueAtTime(784,now+0.16);gain.gain.setValueAtTime(0.15,now);gain.gain.setValueAtTime(0.01,now+0.3);osc.start(now);osc.stop(now+0.3)}
  else if(type==='combo'){osc.type='sine';osc.frequency.setValueAtTime(784,now);osc.frequency.setValueAtTime(988,now+0.1);osc.frequency.setValueAtTime(1175,now+0.2);gain.gain.setValueAtTime(0.18,now);gain.gain.setValueAtTime(0.01,now+0.35);osc.start(now);osc.stop(now+0.35)}
  else if(type==='miss'){osc.type='square';osc.frequency.setValueAtTime(180,now);osc.frequency.setValueAtTime(120,now+0.1);gain.gain.setValueAtTime(0.1,now);gain.gain.setValueAtTime(0.01,now+0.2);osc.start(now);osc.stop(now+0.2)}
  else if(type==='fever'){for(let i=0;i<5;i++){const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.type='sine';o.frequency.setValueAtTime([523,659,784,988,1175][i],now+i*0.08);g.gain.setValueAtTime(0.12,now+i*0.08);g.gain.setValueAtTime(0.01,now+i*0.08+0.15);o.start(now+i*0.08);o.stop(now+i*0.08+0.15)}}
}

// ===== INIT =====
function initStars(){const c=document.getElementById('stars');for(let i=0;i<50;i++){const s=document.createElement('div');s.className='star';s.style.left=Math.random()*100+'%';s.style.top=Math.random()*100+'%';s.style.animationDelay=Math.random()*3+'s';s.style.width=s.style.height=(1+Math.random()*2)+'px';c.appendChild(s)}}
initStars();
function shuffle(arr){const a=[...arr];for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

// ===== GAME =====
function startGame(lvIdx){
  if(audioCtx.state==='suspended')audioCtx.resume();
  currentLevel=lvIdx;
  currentLevelData=buildLevel(lvIdx);
  const lv=currentLevelData;
  score=0;combo=0;maxCombo=0;lives=3;
  correctCount=0;missCount=0;totalSpawned=0;
  gameActive=true;cards=[];results=[];
  isFever=false;itemIndex=0;altSession=0;freezeUntil=0;
  lastRegisteredScore=null;
  shuffledItems=shuffle(lv.items);
  while(shuffledItems.length<lv.total)shuffledItems=shuffledItems.concat(shuffle(lv.items));
  showScreen('game-screen');
  document.getElementById('level-label').textContent=lv.name;
  updateHUD();buildRegionZones(lv);
  document.getElementById('play-area').innerHTML='';
  if(feverEl){feverEl.remove();feverEl=null}
  scheduleSpawn();gameLoop();
}

function buildRegionZones(lv){const c=document.getElementById('region-zones');c.innerHTML='';lv.regions.forEach((r,i)=>{const z=document.createElement('div');z.className='region-zone';z.style.background=r.bg;z.dataset.index=i;z.innerHTML=`<span class="zone-emoji">${r.emoji}</span>${r.name}`;c.appendChild(z)})}
function updateHUD(){
  document.getElementById('score').textContent=score;
  const ce=document.getElementById('combo');
  ce.textContent=combo>1?`ğŸ”¥ ${combo}ã‚³ãƒ³ãƒœ`:'';
  if(combo>1){ce.classList.add('pop');setTimeout(()=>ce.classList.remove('pop'),150)}
  document.getElementById('lives').textContent='â¤ï¸'.repeat(Math.max(0,lives));
}

// Spawn
function getSpawnCount(){const p=totalSpawned/currentLevelData.total;if(p<0.3)return 1;if(p<0.55)return 2;if(p<0.8)return Math.random()<0.5?2:3;return 3}
function getSpawnInterval(){const lv=currentLevelData;const p=totalSpawned/lv.total;return lv.interval*(p<0.5?1.0:(1.0-(p-0.5)*0.3))}
function scheduleSpawn(){
  if(!gameActive)return;const lv=currentLevelData;if(totalSpawned>=lv.total)return;
  const count=Math.min(getSpawnCount(),lv.total-totalSpawned);
  for(let i=0;i<count;i++)setTimeout(()=>spawnOne(),i*300);
  spawnTimer=setTimeout(scheduleSpawn,getSpawnInterval());
}
function spawnOne(){
  if(!gameActive)return;const lv=currentLevelData;if(totalSpawned>=lv.total)return;
  const item=shuffledItems[itemIndex%shuffledItems.length];itemIndex++;totalSpawned++;
  const pa=document.getElementById('play-area');const aW=pa.offsetWidth;
  const isTablet=aW>=600;const cardW=isTablet?(aW>=900?160:140):105;
  const card=document.createElement('div');card.className='falling-card';card.style.background=CARD_COLOR;
  const laneCount=Math.min(isTablet?4:3,lv.regions.length);
  const laneW=(aW-50)/laneCount;const lane=totalSpawned%laneCount;
  const x=12+lane*laneW+Math.random()*Math.max(0,laneW-cardW-10);
  card.style.left=x+'px';card.style.top='-'+(cardW+30)+'px';
  card.innerHTML=`<span class="card-emoji">${item.emoji}</span><span class="card-name">${item.name}</span>`;
  card.addEventListener('pointerdown',e=>onDragStart(e,card));pa.appendChild(card);
  const speedMult=pa.offsetHeight>800?1.3:(pa.offsetHeight>600?1.15:1);
  const obj={el:card,x,y:-(cardW+30),item,speed:lv.speed*speedMult*(isFever?1.5:1),alive:true,dragging:false};
  card._cardObj=obj;cards.push(obj);
}

// Drag
function onDragStart(e,el){if(!gameActive)return;e.preventDefault();const c=el._cardObj;if(!c||!c.alive)return;c.dragging=true;dragCard=c;const r=el.getBoundingClientRect();dragOffsetX=e.clientX-r.left;dragOffsetY=e.clientY-r.top;el.style.zIndex=30;el.style.cursor='grabbing';el.setPointerCapture(e.pointerId);el.addEventListener('pointermove',onDragMove);el.addEventListener('pointerup',onDragEnd);showCardName(el,c)}
function onDragMove(e){if(!dragCard)return;e.preventDefault();const pa=document.getElementById('play-area');const pr=pa.getBoundingClientRect();dragCard.x=e.clientX-pr.left-dragOffsetX;dragCard.y=e.clientY-pr.top-dragOffsetY;dragCard.el.style.left=dragCard.x+'px';dragCard.el.style.top=dragCard.y+'px';highlightZone(e.clientX,e.clientY)}
function onDragEnd(e){if(!dragCard)return;e.preventDefault();hideCardName(dragCard.el);dragCard.dragging=false;dragCard.el.style.cursor='grab';dragCard.el.removeEventListener('pointermove',onDragMove);dragCard.el.removeEventListener('pointerup',onDragEnd);document.querySelectorAll('.region-zone').forEach(z=>z.classList.remove('highlight'));let matched=false;document.querySelectorAll('.region-zone').forEach(z=>{const r=z.getBoundingClientRect();if(e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom){handleAnswer(dragCard,parseInt(z.dataset.index),z);matched=true}});dragCard=null}
function showCardName(el,cardObj){el.classList.add('touched');const popup=document.createElement('div');popup.className='card-name-popup';popup.textContent=cardObj.item.name;el.appendChild(popup);el._namePopup=popup}
function hideCardName(el){el.classList.remove('touched');if(el._namePopup){el._namePopup.remove();el._namePopup=null}}
function highlightZone(cx,cy){document.querySelectorAll('.region-zone').forEach(z=>{const r=z.getBoundingClientRect();z.classList.toggle('highlight',cx>=r.left&&cx<=r.right&&cy>=r.top&&cy<=r.bottom)})}

function handleAnswer(cardObj,zoneIdx,zoneEl){
  if(!cardObj.alive)return;cardObj.alive=false;
  const correct=cardObj.item.region===zoneIdx;
  if(correct){
    combo++;correctCount++;if(combo>maxCombo)maxCombo=combo;
    score+=isFever?200:100;
    zoneEl.classList.add('correct-flash');setTimeout(()=>zoneEl.classList.remove('correct-flash'),500);
    showFeedback('PERFECT!','var(--perfect)');
    const pCount=combo>=10?14:8;spawnParticles(cardObj.el,'#4ADE80',pCount);
    results.push({...cardObj.item,correct:true});
    if(combo===5){showComboBurst('ğŸ”¥ 5ã‚³ãƒ³ãƒœï¼');playSound('combo');freezeUntil=performance.now()+700}
    else if(combo===10){showComboBurst('âš¡ ãƒ•ã‚£ãƒ¼ãƒãƒ¼ï¼');playSound('fever');startFever();freezeUntil=performance.now()+700;showFeverCounter()}
    else if(combo>10){playSound('combo');updateFeverCounter();showEdgeFlash()}
    else if(combo>=5){playSound('combo')}
    else{playSound('correct')}
  }else{
    combo=0;lives--;missCount++;hideFeverCounter();
    zoneEl.classList.add('wrong-flash');setTimeout(()=>zoneEl.classList.remove('wrong-flash'),500);
    showFeedback('MISS','var(--miss-red)');showTrivia(cardObj.item.trivia);
    results.push({...cardObj.item,correct:false});playSound('miss');endFever();
    if(lives<=0)endGame();
  }
  updateHUD();cardObj.el.style.opacity='0';
  setTimeout(()=>{if(cardObj.el.parentNode)cardObj.el.parentNode.removeChild(cardObj.el)},200);
  checkComplete();
}

function checkComplete(){
  const lv=currentLevelData;
  if(correctCount+missCount>=lv.total||totalSpawned>=lv.total&&cards.filter(c=>c.alive).length===0){setTimeout(()=>{if(gameActive)endGame()},800)}
}

function showFeedback(t,c){const f=document.createElement('div');f.className='feedback';f.textContent=t;f.style.color=c;document.body.appendChild(f);setTimeout(()=>f.remove(),800)}
function showTrivia(t){document.querySelectorAll('.trivia-popup').forEach(e=>e.remove());const d=document.createElement('div');d.className='trivia-popup';d.textContent=t;document.body.appendChild(d);setTimeout(()=>d.remove(),2200)}
function showComboBurst(t){const b=document.createElement('div');b.className='combo-burst';b.textContent=t;document.body.appendChild(b);setTimeout(()=>b.remove(),1000)}
function startFever(){isFever=true;if(!feverEl){feverEl=document.createElement('div');feverEl.className='fever-overlay';document.body.appendChild(feverEl)}}
function endFever(){isFever=false;if(feverEl){feverEl.remove();feverEl=null}}
function spawnParticles(el,color,count){
  count=count||8;const r=el.getBoundingClientRect();const cx=r.left+r.width/2,cy=r.top+r.height/2;
  for(let i=0;i<count;i++){const p=document.createElement('div');p.className='particle';p.style.background=color;p.style.left=cx+'px';p.style.top=cy+'px';const a=(Math.PI*2*i)/count,d=35+Math.random()*35;p.style.setProperty('--px',Math.cos(a)*d+'px');p.style.setProperty('--py',Math.sin(a)*d+'px');document.body.appendChild(p);setTimeout(()=>p.remove(),700)}
}
function getComboColor(c){if(c>=20)return'#FF1744';if(c>=15)return'#FF6D00';if(c>=12)return'#FFAB00';return'#FFD740'}
function showFeverCounter(){
  if(!feverCounterEl){feverCounterEl=document.createElement('div');feverCounterEl.className='fever-counter';feverCounterEl.innerHTML='<div class="fc-num"></div><div class="fc-label">COMBO</div>';document.body.appendChild(feverCounterEl)}
  const n=feverCounterEl.querySelector('.fc-num');n.textContent='ğŸ”¥'+combo;n.style.color=getComboColor(combo);
  const s=Math.min(1+((combo-10)*0.03),1.5);n.style.fontSize=(48*s)+'px';n.style.animation='none';void n.offsetWidth;n.style.animation='fcBounce .25s ease';
}
function updateFeverCounter(){if(feverCounterEl){const n=feverCounterEl.querySelector('.fc-num');n.textContent='ğŸ”¥'+combo;n.style.color=getComboColor(combo);const s=Math.min(1+((combo-10)*0.03),1.5);n.style.fontSize=(48*s)+'px';n.style.animation='none';void n.offsetWidth;n.style.animation='fcBounce .25s ease'}else{showFeverCounter()}}
function hideFeverCounter(){if(feverCounterEl){feverCounterEl.remove();feverCounterEl=null}}
function showEdgeFlash(){const ef=document.createElement('div');ef.className='edge-flash';document.body.appendChild(ef);setTimeout(()=>ef.remove(),300)}

function gameLoop(){
  if(!gameActive)return;const now=performance.now();const frozen=now<freezeUntil;
  const pa=document.getElementById('play-area');const aH=pa.offsetHeight;
  cards.forEach(c=>{
    if(!c.alive||c.dragging||frozen)return;
    c.y+=c.speed;c.el.style.top=c.y+'px';
    if(c.y>aH+20){c.alive=false;combo=0;lives--;missCount++;hideFeverCounter();
      showFeedback('MISS','var(--miss-red)');showTrivia(c.item.trivia);
      results.push({...c.item,correct:false});playSound('miss');endFever();updateHUD();
      if(c.el.parentNode)c.el.parentNode.removeChild(c.el);
      if(lives<=0)endGame();else checkComplete();}
  });
  cards=cards.filter(c=>c.alive||c.el.parentNode);
  animFrame=requestAnimationFrame(gameLoop);
}

function endGame(){
  gameActive=false;clearTimeout(spawnTimer);cancelAnimationFrame(animFrame);endFever();hideFeverCounter();
  cards.forEach(c=>{if(c.el.parentNode)c.el.parentNode.removeChild(c.el)});cards=[];
  setTimeout(showResults,500);
}

function showResults(){
  showScreen('result-screen');
  const totalAnswered=correctCount+missCount;
  const stars=lives>0?getStarRating(correctCount,totalAnswered):0;
  const altReward=getStarBonus(stars,lives>0);
  const isFirstClear=lives>0&&!clearedLevels[currentLevel];
  const firstBonus=isFirstClear?5:0;
  if(isFirstClear)clearedLevels[currentLevel]=true;

  // TRAILé€£æº: ã‚¯ãƒªã‚¢æˆåŠŸæ™‚ã®ã¿ã‚¹ã‚³ã‚¢é€ä¿¡
  if(lives>0)sendResult(score);

  let starStr='';for(let i=0;i<3;i++)starStr+=(i<stars)?'â˜…':'â˜†';
  document.getElementById('result-stars').textContent=starStr;
  const title=document.getElementById('result-title');
  if(stars===3)title.textContent='ğŸ† ãƒ‘ãƒ¼ãƒ•ã‚§ã‚¯ãƒˆï¼';
  else if(lives>0)title.textContent='ğŸ‰ ã‚¯ãƒªã‚¢ï¼';
  else title.textContent='ğŸ’ª ãŠã—ã‹ã£ãŸï¼';

  document.getElementById('result-score-val').textContent=score;
  document.getElementById('result-correct').textContent=correctCount+'/'+totalAnswered;
  document.getElementById('result-combo').textContent=maxCombo;

  // ALT box
  const altNumEl=document.getElementById('result-alt-num');
  const altBox=document.getElementById('result-alt-box');
  const firstEl=document.getElementById('result-alt-first');
  firstEl.textContent='';firstEl.className='result-alt-first';
  altBox.style.animation='none';void altBox.offsetWidth;altBox.style.animation='altBoxIn .6s ease .5s forwards';

  if(altReward===0){
    altNumEl.textContent='ğŸª™ 0 ALT';
    document.getElementById('result-alt-total').textContent='ã”ã†ã‘ã„: '+altTotal+' ALT';
  }else{
    let current=0;const totalAlt=altReward+firstBonus;altNumEl.textContent='ğŸª™ 0 ALT';
    setTimeout(()=>{
      const step=Math.max(1,Math.floor(altReward/10));
      const iv=setInterval(()=>{
        current+=step;if(current>=altReward){current=altReward;clearInterval(iv);
          if(firstBonus>0){firstEl.textContent='ğŸ†• ã¯ã˜ã‚ã¦ã‚¯ãƒªã‚¢ +'+firstBonus+' ALT';firstEl.className='result-alt-first show'}
          altTotal+=totalAlt;altSession=totalAlt;updateAltBadge();
          document.getElementById('result-alt-total').textContent='ã”ã†ã‘ã„: '+altTotal+' ALT';
        }
        altNumEl.textContent='ğŸª™ +'+current+' ALT';
      },60);
    },1000);
  }

  // Ranking register button (reset)
  const area=document.getElementById('result-rank-area');
  area.innerHTML='<button class="btn-register" id="btn-register" onclick="showNameModal()">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ã¨ã†ã‚ãã™ã‚‹</button>';

  const ic=document.getElementById('result-items');ic.innerHTML='';
  results.forEach(r=>{const d=document.createElement('div');d.className='result-item '+(r.correct?'correct':'wrong');d.textContent=r.emoji+' '+r.name;ic.appendChild(d)});
}

function goTitle(){
  gameActive=false;clearTimeout(spawnTimer);cancelAnimationFrame(animFrame);endFever();hideFeverCounter();
  cards.forEach(c=>{if(c.el.parentNode)c.el.parentNode.removeChild(c.el)});
  cards=[];dragCard=null;
  document.querySelectorAll('.feedback,.trivia-popup,.combo-burst,.edge-flash,.fever-counter').forEach(e=>e.remove());
  feverCounterEl=null;
  showScreen('title-screen');
  // Sync name from ranking to LINE
  const saved=getSavedName();
  if(saved)document.getElementById('line-name').value=saved;
  updateAltBadge();
}

// Init
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('alt-badge').style.display='block';
  updateAltBadge();checkWeeklyReset();
  const saved=getSavedName();
  if(saved)document.getElementById('line-name').value=saved;
});
</script>
</body>
</html>
