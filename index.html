<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>„Å®„Åè„Åï„Çì„Å∂„Å§„Éû„ÉÉ„ÉÅ„É≥„Ç∞</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&family=Zen+Maru+Gothic:wght@700;900&display=swap');
:root{--bg-dark:#0a0a1a;--bg-mid:#151528;--accent-gold:#FFD700;--accent-pink:#FF6B9D;--accent-blue:#4FC3F7;--alt-green:#4ADE80;--miss-red:#FF5252;--perfect:#69F0AE}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'M PLUS Rounded 1c','Zen Maru Gothic',sans-serif;background:var(--bg-dark);overflow-x:hidden;min-height:100vh;min-height:100dvh;width:100vw;user-select:none;-webkit-user-select:none;color:#fff}

/* SCREENS */
.screen{position:fixed;inset:0;display:none;flex-direction:column;align-items:center;z-index:100;overflow-y:auto}
.screen.active{display:flex}

/* TITLE */
#title-screen{justify-content:flex-start;background:linear-gradient(135deg,#0a0a1a 0%,#151528 40%,#0d1025 100%);padding:20px 16px 40px}
#title-screen::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse at 30% 20%,rgba(74,222,128,0.08) 0%,transparent 50%),radial-gradient(ellipse at 70% 80%,rgba(79,195,247,0.06) 0%,transparent 50%);pointer-events:none;z-index:0}
.alt-badge{position:fixed;top:16px;right:16px;background:rgba(74,222,128,0.12);border:1.5px solid rgba(74,222,128,0.3);border-radius:50px;padding:8px 18px;color:var(--alt-green);font-size:17px;font-weight:900;z-index:200;backdrop-filter:blur(8px)}
.title-emoji{font-size:64px;animation:titleBounce 2s ease-in-out infinite;position:relative;z-index:1;margin-top:50px}
@keyframes titleBounce{0%,100%{transform:translateY(0) rotate(-5deg)}50%{transform:translateY(-12px) rotate(5deg)}}
.title-text{font-family:'Zen Maru Gothic',sans-serif;font-size:clamp(26px,6.5vw,44px);font-weight:900;background:linear-gradient(135deg,var(--alt-green),var(--accent-blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;text-align:center;position:relative;z-index:1;letter-spacing:2px;margin-top:16px}
.title-sub{color:rgba(255,255,255,0.5);font-size:clamp(13px,3.2vw,16px);text-align:center;position:relative;z-index:1;margin-top:8px}
.level-select{display:flex;flex-direction:column;gap:10px;margin-top:20px;position:relative;z-index:1;width:min(320px,90vw)}
.level-btn{padding:14px 20px;border:2px solid rgba(255,255,255,0.1);border-radius:14px;background:rgba(255,255,255,0.04);color:#fff;font-family:inherit;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s;display:flex;align-items:center;gap:12px;backdrop-filter:blur(8px)}
.level-btn:hover,.level-btn:active{background:rgba(255,255,255,0.1);border-color:var(--alt-green);transform:scale(1.02)}
.level-btn .emoji{font-size:26px}.level-btn .info{text-align:left}
.level-btn .info small{display:block;color:rgba(255,255,255,0.4);font-weight:400;font-size:12px;margin-top:2px}

/* TITLE BUTTONS (ranking, line) */
.title-actions{display:flex;flex-direction:column;gap:10px;width:min(320px,90vw);position:relative;z-index:1;margin-top:20px}
.title-action-btn{padding:14px 20px;border:2px solid rgba(255,255,255,0.1);border-radius:14px;background:rgba(255,255,255,0.04);color:#fff;font-family:inherit;font-size:16px;font-weight:700;cursor:pointer;transition:all .3s;text-align:center;backdrop-filter:blur(8px)}
.title-action-btn:hover,.title-action-btn:active{background:rgba(255,255,255,0.1);border-color:var(--accent-gold);transform:scale(1.02)}

/* LINE SECTION */
.line-section{position:relative;z-index:1;width:min(320px,90vw);margin-top:20px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:16px;padding:20px}
.line-section h3{font-size:15px;color:var(--alt-green);margin-bottom:12px;font-weight:900}
.line-input{width:100%;padding:10px 14px;border:1.5px solid rgba(255,255,255,0.15);border-radius:10px;background:rgba(255,255,255,0.05);color:#fff;font-family:inherit;font-size:15px;font-weight:700;outline:none;transition:border-color .2s;margin-bottom:10px}
.line-input:focus{border-color:var(--alt-green)}
.line-input::placeholder{color:rgba(255,255,255,0.25)}
.line-btn{width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(135deg,#06C755,#04A847);color:#fff;font-family:inherit;font-size:16px;font-weight:900;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:8px}
.line-btn:hover{transform:scale(1.02)}.line-btn:disabled{opacity:0.3;cursor:not-allowed;transform:none}

/* CONFIRM MODAL */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:300;display:none;align-items:center;justify-content:center;backdrop-filter:blur(4px)}
.modal-overlay.show{display:flex}
.modal-box{background:#1a1a2e;border:1.5px solid rgba(255,255,255,0.12);border-radius:20px;padding:28px 24px;max-width:320px;width:90%;text-align:center}
.modal-box .warn{font-size:15px;color:rgba(255,255,255,0.8);margin:12px 0 20px;line-height:1.6}
.modal-box .warn strong{color:var(--alt-green);font-size:20px}
.modal-btns{display:flex;gap:10px}
.modal-btns button{flex:1;padding:12px;border:none;border-radius:10px;font-family:inherit;font-size:15px;font-weight:900;cursor:pointer}
.btn-cancel{background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.6)}
.btn-ok{background:linear-gradient(135deg,#06C755,#04A847);color:#fff}
.btn-gold{background:linear-gradient(135deg,#FFD700,#FFA000);color:#1a1a2e}

/* NAME INPUT MODAL */
.modal-input{width:100%;padding:12px 14px;border:2px solid rgba(255,255,255,0.15);border-radius:12px;background:rgba(255,255,255,0.06);color:#fff;font-family:inherit;font-size:18px;font-weight:900;outline:none;text-align:center;margin:12px 0;transition:border-color .2s}
.modal-input:focus{border-color:var(--accent-gold)}
.modal-input::placeholder{color:rgba(255,255,255,0.2);font-weight:400}

/* GAME */
#game-screen{background:linear-gradient(180deg,#0a0a1a 0%,#060612 100%);height:100vh;height:100dvh;z-index:90;align-items:stretch;overflow:hidden}
.hud{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:rgba(0,0,0,0.4);z-index:10}
.hud-back{width:34px;height:34px;border:2px solid rgba(255,255,255,0.25);border-radius:50%;background:rgba(255,255,255,0.06);color:rgba(255,255,255,0.6);font-size:16px;font-family:inherit;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}
.hud-back:hover,.hud-back:active{background:rgba(255,255,255,0.12);color:#fff}
.hud-score{color:var(--accent-gold);font-size:20px;font-weight:900}
.hud-level{color:rgba(255,255,255,0.5);font-size:13px}
.hud-combo{color:var(--accent-pink);font-size:15px;font-weight:700;min-width:70px;text-align:center;transition:transform .15s}
.hud-combo.pop{transform:scale(1.3)}
.hud-lives{font-size:20px;text-align:right}
.play-area{flex:1;position:relative;overflow:hidden;touch-action:none}
.falling-card{position:absolute;width:105px;height:125px;border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px;cursor:grab;z-index:20;transition:opacity .2s;touch-action:none;box-shadow:0 4px 18px rgba(0,0,0,0.4)}
.falling-card .card-emoji{font-size:44px;filter:drop-shadow(0 2px 3px rgba(0,0,0,0.3))}
.falling-card .card-name{font-size:14px;font-weight:900;color:#fff;text-shadow:0 1px 2px rgba(0,0,0,0.4);text-align:center;line-height:1.2}
.region-zones{display:flex;gap:6px;padding:6px 10px 14px;z-index:10}
.region-zone{flex:1;padding:16px 6px;border-radius:18px;text-align:center;font-weight:900;font-size:clamp(14px,3.8vw,20px);color:#fff;position:relative;transition:all .3s;border:3px solid transparent;min-height:80px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:3px}
.region-zone .zone-emoji{font-size:24px}
.region-zone.highlight{transform:scale(1.05);border-color:#fff;box-shadow:0 0 25px rgba(255,255,255,0.25)}
.region-zone.correct-flash{animation:correctPulse .5s ease}
.region-zone.wrong-flash{animation:wrongShake .5s ease}
@keyframes correctPulse{0%{box-shadow:0 0 0 0 rgba(74,222,128,0.6)}50%{box-shadow:0 0 35px 8px rgba(74,222,128,0.3);transform:scale(1.06)}100%{box-shadow:none}}
@keyframes wrongShake{0%,100%{transform:translateX(0)}20%{transform:translateX(-7px)}40%{transform:translateX(7px)}60%{transform:translateX(-4px)}80%{transform:translateX(4px)}}

/* FEEDBACK */
.feedback{position:fixed;top:35%;left:50%;transform:translate(-50%,-50%);font-size:34px;font-weight:900;pointer-events:none;z-index:50;animation:feedbackPop .8s ease forwards;text-shadow:0 2px 8px rgba(0,0,0,0.5)}
@keyframes feedbackPop{0%{opacity:0;transform:translate(-50%,-50%) scale(0.3)}30%{opacity:1;transform:translate(-50%,-50%) scale(1.3)}60%{transform:translate(-50%,-50%) scale(1)}100%{opacity:0;transform:translate(-50%,-80%) scale(0.8)}}
.trivia-popup{position:fixed;bottom:130px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.85);backdrop-filter:blur(12px);color:#fff;padding:10px 18px;border-radius:12px;font-size:14px;font-weight:700;z-index:40;animation:triviaSlide 2s ease forwards;white-space:nowrap;border:1px solid rgba(255,255,255,0.12);max-width:92vw;text-align:center}
@keyframes triviaSlide{0%{opacity:0;transform:translateX(-50%) translateY(20px)}15%{opacity:1;transform:translateX(-50%) translateY(0)}75%{opacity:1}100%{opacity:0;transform:translateX(-50%) translateY(-10px)}}
.combo-burst{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);font-size:48px;font-weight:900;color:var(--accent-gold);pointer-events:none;z-index:55;animation:comboBurst 1s ease forwards;text-shadow:0 0 25px rgba(255,215,0,0.5)}
@keyframes comboBurst{0%{opacity:0;transform:translate(-50%,-50%) scale(0.2) rotate(-10deg)}40%{opacity:1;transform:translate(-50%,-50%) scale(1.3) rotate(3deg)}70%{transform:translate(-50%,-50%) scale(1) rotate(0)}100%{opacity:0;transform:translate(-50%,-70%) scale(0.7)}}
.fever-overlay{position:fixed;inset:0;pointer-events:none;z-index:5;background:radial-gradient(ellipse at center,rgba(255,215,0,0.06) 0%,transparent 70%);animation:feverPulse .8s ease-in-out infinite alternate}
@keyframes feverPulse{0%{opacity:0.5}100%{opacity:1}}
.particle{position:fixed;width:7px;height:7px;border-radius:50%;pointer-events:none;z-index:45;animation:particleFly .7s ease-out forwards}
@keyframes particleFly{0%{opacity:1;transform:translate(0,0) scale(1)}100%{opacity:0;transform:translate(var(--px),var(--py)) scale(0)}}

/* FEVER COMBO COUNTER */
.fever-counter{position:fixed;top:12%;left:50%;transform:translateX(-50%);pointer-events:none;z-index:48;text-align:center;opacity:0.85}
.fever-counter .fc-num{font-size:48px;font-weight:900;text-shadow:0 2px 16px rgba(0,0,0,0.5);transition:color .2s;animation:fcBounce .25s ease}
.fever-counter .fc-label{font-size:13px;font-weight:700;color:rgba(255,255,255,0.5);letter-spacing:2px;margin-top:-4px}
@keyframes fcBounce{0%{transform:scale(1.5)}50%{transform:scale(0.9)}100%{transform:scale(1)}}
.edge-flash{position:fixed;inset:0;pointer-events:none;z-index:6;border:3px solid transparent;animation:edgeFlash .3s ease forwards}
@keyframes edgeFlash{0%{border-color:rgba(255,215,0,0.6)}100%{border-color:transparent}}

/* RESULT */
#result-screen{justify-content:center;background:linear-gradient(135deg,#0a0a1a,#151528);gap:14px;padding:24px}
.result-title{font-size:32px;font-weight:900;color:var(--accent-gold)}
.result-stars{font-size:40px;letter-spacing:8px}
.result-stats{display:flex;gap:20px;color:rgba(255,255,255,0.6);font-size:14px}
.result-stats span{text-align:center}
.result-stats .num{display:block;font-size:24px;font-weight:900;color:#fff}
.result-alt-box{background:rgba(74,222,128,0.08);border:2px solid rgba(74,222,128,0.25);border-radius:20px;padding:20px 36px;text-align:center;margin:4px 0;opacity:0;transform:scale(0.5);animation:altBoxIn .6s ease .5s forwards}
@keyframes altBoxIn{0%{opacity:0;transform:scale(0.5)}60%{opacity:1;transform:scale(1.1)}100%{opacity:1;transform:scale(1)}}
.result-alt-num{font-size:36px;font-weight:900;color:var(--alt-green)}
.result-alt-first{font-size:15px;font-weight:700;color:var(--accent-gold);margin-top:6px;opacity:0}
.result-alt-first.show{animation:firstIn .5s ease .9s forwards}
@keyframes firstIn{0%{opacity:0;transform:translateY(8px)}100%{opacity:1;transform:translateY(0)}}
.result-alt-total{font-size:14px;color:rgba(74,222,128,0.45);font-weight:700}
.result-items{display:flex;flex-wrap:wrap;gap:6px;justify-content:center;max-width:340px}
.result-item{padding:5px 10px;border-radius:8px;font-size:13px;font-weight:700;color:#fff}
.result-item.correct{background:rgba(74,222,128,0.15);border:1px solid rgba(74,222,128,0.3)}
.result-item.wrong{background:rgba(255,82,82,0.15);border:1px solid rgba(255,82,82,0.3)}

/* RESULT RANKING AREA */
.result-rank-area{margin-top:4px;text-align:center;min-height:60px}
.btn-register{padding:12px 28px;border:2px solid var(--accent-gold);border-radius:50px;background:rgba(255,215,0,0.08);color:var(--accent-gold);font-family:inherit;font-size:16px;font-weight:900;cursor:pointer;transition:all .2s}
.btn-register:hover{background:rgba(255,215,0,0.15);transform:scale(1.03)}
.btn-register:disabled{opacity:0.3;cursor:not-allowed;transform:none}
.rank-result{font-size:14px;color:rgba(255,255,255,0.6);line-height:2}
.rank-result strong{color:var(--accent-gold);font-size:18px}
.rank-result .new-best{color:var(--alt-green);font-weight:900}
.rank-link{color:var(--accent-blue);font-size:13px;cursor:pointer;text-decoration:underline;margin-top:4px;display:inline-block}

.btn-restart{padding:14px 44px;border:none;border-radius:50px;background:linear-gradient(135deg,var(--accent-pink),#FF8A65);color:#fff;font-family:inherit;font-size:18px;font-weight:900;cursor:pointer;transition:transform .2s}
.btn-restart:hover{transform:scale(1.05)}

/* RANKING SCREEN */
#ranking-screen{justify-content:flex-start;background:linear-gradient(135deg,#0a0a1a,#151528);padding:24px 16px 40px}
.rank-header{display:flex;align-items:center;width:min(360px,90vw);margin-bottom:16px;position:relative}
.rank-back{width:36px;height:36px;border:2px solid rgba(255,255,255,0.2);border-radius:50%;background:rgba(255,255,255,0.05);color:rgba(255,255,255,0.6);font-size:16px;font-family:inherit;cursor:pointer;display:flex;align-items:center;justify-content:center}
.rank-title{flex:1;text-align:center;font-size:22px;font-weight:900;color:var(--accent-gold)}
.rank-tabs{display:flex;gap:8px;margin-bottom:16px}
.rank-tab{flex:1;padding:10px;border:2px solid rgba(255,255,255,0.1);border-radius:12px;background:rgba(255,255,255,0.03);color:rgba(255,255,255,0.5);font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;text-align:center;transition:all .2s}
.rank-tab.active{border-color:var(--accent-gold);color:var(--accent-gold);background:rgba(255,215,0,0.08)}
.rank-period{font-size:12px;color:rgba(255,255,255,0.3);text-align:center;margin-bottom:12px}
.rank-list{width:min(360px,90vw);display:flex;flex-direction:column;gap:6px}
.rank-row{display:flex;align-items:center;padding:12px 16px;border-radius:12px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);gap:12px;transition:background .2s}
.rank-row.me{background:rgba(74,222,128,0.08);border-color:rgba(74,222,128,0.2)}
.rank-row.top3{background:rgba(255,215,0,0.06);border-color:rgba(255,215,0,0.15)}
.rank-pos{font-size:18px;font-weight:900;width:36px;text-align:center;color:rgba(255,255,255,0.5)}
.rank-row.top3 .rank-pos{color:var(--accent-gold)}
.rank-name{flex:1;font-size:15px;font-weight:700;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.rank-score{font-size:16px;font-weight:900;color:var(--accent-gold)}
.rank-divider{width:100%;border:none;border-top:1px dashed rgba(255,255,255,0.1);margin:6px 0}
.rank-empty{text-align:center;color:rgba(255,255,255,0.3);font-size:14px;padding:24px 0}

/* STARS */
.stars{position:fixed;inset:0;pointer-events:none;z-index:0}
.star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;animation:twinkle 3s ease-in-out infinite}
@keyframes twinkle{0%,100%{opacity:0.15}50%{opacity:0.6}}

/* TABLET 600 */
@media(min-width:600px){
  .title-emoji{font-size:90px;margin-top:60px}.title-text{font-size:52px;margin-top:20px}.title-sub{font-size:18px}
  .level-select,.title-actions{width:420px;gap:14px}.level-btn,.title-action-btn{padding:18px 28px;font-size:19px;border-radius:18px}
  .level-btn .emoji{font-size:34px}.alt-badge{font-size:20px;padding:10px 24px}
  .line-section{width:420px;padding:28px}.line-input{padding:14px 18px;font-size:17px}.line-btn{padding:16px;font-size:18px}
  .modal-box{max-width:400px;padding:36px 32px}.modal-input{font-size:20px;padding:14px 18px}
  .hud{padding:14px 20px}.hud-back{width:42px;height:42px;font-size:20px}.hud-score{font-size:26px}.hud-level{font-size:15px}
  .hud-combo{font-size:19px;min-width:100px}.hud-lives{font-size:26px}
  .falling-card{width:140px;height:165px;border-radius:20px;gap:8px}.falling-card .card-emoji{font-size:60px}.falling-card .card-name{font-size:18px}
  .region-zones{gap:10px;padding:10px 16px 20px}.region-zone{padding:22px 10px;border-radius:22px;font-size:22px;min-height:100px;gap:6px;border-width:4px}.region-zone .zone-emoji{font-size:32px}
  .feedback{font-size:46px}.trivia-popup{font-size:18px;padding:14px 24px;bottom:160px}.combo-burst{font-size:60px}
  .result-title{font-size:42px}.result-stars{font-size:52px;letter-spacing:12px}
  .result-alt-box{padding:24px 48px}.result-alt-num{font-size:44px}
  .result-stats{gap:32px;font-size:16px}.result-stats .num{font-size:32px}
  .result-items{max-width:500px;gap:8px}.result-item{padding:8px 14px;font-size:15px}
  .btn-restart{padding:18px 56px;font-size:22px}.btn-register{padding:14px 36px;font-size:18px}
  .rank-header{width:420px}.rank-title{font-size:26px}.rank-list{width:420px}
  .rank-row{padding:14px 20px}.rank-pos{font-size:20px}.rank-name{font-size:17px}.rank-score{font-size:18px}
  .fever-counter{top:10%}.fever-counter .fc-num{font-size:64px}
}
/* TABLET 900 */
@media(min-width:900px){
  .title-emoji{font-size:100px;margin-top:50px}.title-text{font-size:60px}
  .level-select,.title-actions{width:480px}.level-btn{padding:22px 32px;font-size:21px}.level-btn .emoji{font-size:38px}
  .line-section{width:480px}
  .falling-card{width:160px;height:185px;border-radius:24px}.falling-card .card-emoji{font-size:68px}.falling-card .card-name{font-size:20px}
  .region-zones{gap:14px;padding:12px 24px 24px}.region-zone{padding:28px 14px;border-radius:26px;font-size:24px;min-height:115px}.region-zone .zone-emoji{font-size:38px}
  .hud{padding:16px 28px}.hud-score{font-size:30px}.hud-combo{font-size:22px}.hud-lives{font-size:30px}
  .feedback{font-size:56px}.combo-burst{font-size:72px}
  .result-title{font-size:48px}.result-stars{font-size:60px}.result-alt-box{padding:28px 56px}.result-alt-num{font-size:52px}
  .result-items{max-width:600px}.btn-restart{padding:20px 64px;font-size:24px}
  .rank-header,.rank-list{width:480px}
}
/* LANDSCAPE */
@media(min-width:600px)and(max-height:500px){
  .title-emoji{font-size:50px;margin-top:10px}.title-text{font-size:32px;margin-top:8px}.title-sub{margin-top:4px}
  .level-select{margin-top:10px;gap:6px}.level-btn{padding:10px 20px}
  .hud{padding:6px 16px}.falling-card{width:120px;height:140px}.falling-card .card-emoji{font-size:48px}.falling-card .card-name{font-size:16px}
  .region-zones{padding:4px 12px 8px}.region-zone{padding:10px 6px;min-height:64px;font-size:16px}.region-zone .zone-emoji{font-size:22px}
  .feedback{font-size:36px;top:40%}.result-title{font-size:28px}.result-stars{font-size:36px}
  .result-alt-box{padding:14px 28px}.result-alt-num{font-size:28px}
  .result-stats{gap:16px;font-size:13px}.result-stats .num{font-size:22px}
  .fever-counter{top:8%}.fever-counter .fc-num{font-size:40px}
}
</style>
</head>
<body>
<div class="stars" id="stars"></div>
<div class="alt-badge" id="alt-badge" style="display:none">ü™ô <span id="alt-display">0</span> ALT</div>

<!-- TITLE -->
<div id="title-screen" class="screen active">
  <div style="height:20px"></div>
  <div class="title-emoji">üçéüêüüçä</div>
  <div class="title-text">„Å®„Åè„Åï„Çì„Å∂„Å§<br>„Éû„ÉÉ„ÉÅ„É≥„Ç∞</div>
  <div class="title-sub">„Åü„Å†„Åó„ÅÑ„Å°„ÅÑ„Åç„Å´„Çπ„ÉØ„Ç§„Éó„Åó„Çà„ÅÜÔºÅ</div>
  <div class="level-select">
    <button class="level-btn" onclick="startGame(0)"><span class="emoji">üå±</span><span class="info">„É¨„Éô„É´1<small>2„Å°„ÅÑ„Åç „Éª „ÇÜ„Å£„Åè„Çä</small></span></button>
    <button class="level-btn" onclick="startGame(1)"><span class="emoji">üåø</span><span class="info">„É¨„Éô„É´2<small>3„Å°„ÅÑ„Åç „Éª „Åµ„Å§„ÅÜ</small></span></button>
    <button class="level-btn" onclick="startGame(2)"><span class="emoji">üî•</span><span class="info">„É¨„Éô„É´3<small>4„Å°„ÅÑ„Åç „Éª „ÅØ„ÇÑ„ÅÑ</small></span></button>
    <button class="level-btn" onclick="startGame(3)"><span class="emoji">‚ö°</span><span class="info">„É¨„Éô„É´4<small>5„Å°„ÅÑ„Åç „Éª „Çπ„Éî„Éº„Éâ</small></span></button>
  </div>
  <div class="title-actions">
    <button class="title-action-btn" onclick="showScreen('ranking-screen');renderRanking()">üèÜ „É©„É≥„Ç≠„É≥„Ç∞</button>
  </div>
  <div class="line-section">
    <h3>üí∞ ALT„ÇíTRAIL„Å´„Åª„ÅÜ„Åì„Åè„Åô„Çã</h3>
    <input class="line-input" id="line-name" type="text" placeholder="„Å™„Åæ„Åà„Çí„Å´„ÇÖ„ÅÜ„Çä„Çá„Åè" maxlength="20" oninput="updateLineBtn()">
    <button class="line-btn" id="line-btn" disabled onclick="showLineConfirm()">üí¨ LINE„Åß„Åª„ÅÜ„Åì„Åè„Åô„Çã</button>
  </div>
</div>

<!-- GAME -->
<div id="game-screen" class="screen">
  <div class="hud">
    <button class="hud-back" onclick="goTitle()">‚úï</button>
    <div><div class="hud-score" id="score">0</div><div class="hud-level" id="level-label"></div></div>
    <div class="hud-combo" id="combo"></div>
    <div class="hud-lives" id="lives"></div>
  </div>
  <div class="play-area" id="play-area"></div>
  <div class="region-zones" id="region-zones"></div>
</div>

<!-- RESULT -->
<div id="result-screen" class="screen">
  <div class="result-title" id="result-title"></div>
  <div class="result-stars" id="result-stars"></div>
  <div class="result-stats">
    <span><span class="num" id="result-score-val">0</span>„Çπ„Ç≥„Ç¢</span>
    <span><span class="num" id="result-correct">0</span>„Åõ„ÅÑ„Åã„ÅÑ</span>
    <span><span class="num" id="result-combo">0</span>„Åï„ÅÑ„Å†„ÅÑ„Ç≥„É≥„Éú</span>
  </div>
  <div class="result-alt-box" id="result-alt-box">
    <div class="result-alt-num" id="result-alt-num">ü™ô 0 ALT</div>
    <div class="result-alt-first" id="result-alt-first"></div>
  </div>
  <div class="result-alt-total" id="result-alt-total"></div>
  <div class="result-rank-area" id="result-rank-area">
    <button class="btn-register" id="btn-register" onclick="showNameModal()">üèÜ „É©„É≥„Ç≠„É≥„Ç∞„Å´„Å®„ÅÜ„Çç„Åè„Åô„Çã</button>
  </div>
  <div class="result-items" id="result-items"></div>
  <button class="btn-restart" onclick="goTitle()">„ÇÇ„Å©„Çã</button>
</div>

<!-- RANKING SCREEN -->
<div id="ranking-screen" class="screen">
  <div class="rank-header">
    <button class="rank-back" onclick="goBackFromRanking()">‚Üê</button>
    <div class="rank-title">üèÜ „É©„É≥„Ç≠„É≥„Ç∞</div>
    <div style="width:36px"></div>
  </div>
  <div class="rank-tabs">
    <button class="rank-tab active" id="tab-weekly" onclick="switchRankTab('weekly')">„Åó„ÇÖ„ÅÜ„Åã„Çì</button>
    <button class="rank-tab" id="tab-alltime" onclick="switchRankTab('alltime')">„Çå„Åç„Å†„ÅÑ</button>
  </div>
  <div class="rank-period" id="rank-period"></div>
  <div class="rank-list" id="rank-list"></div>
</div>

<!-- NAME MODAL -->
<div class="modal-overlay" id="name-modal">
  <div class="modal-box">
    <div style="font-size:28px">üèÜ</div>
    <div class="warn">„Å™„Åæ„Åà„Çí„ÅÑ„Çå„Å¶„Å®„ÅÜ„Çç„ÅèÔºÅ</div>
    <input class="modal-input" id="rank-name-input" type="text" placeholder="„Å™„Åæ„Åà" maxlength="10">
    <div class="modal-btns">
      <button class="btn-cancel" onclick="hideModal('name-modal')">„ÇÑ„ÇÅ„Çã</button>
      <button class="btn-gold" id="btn-do-register" onclick="doRegister()">„Å®„ÅÜ„Çç„ÅèÔºÅ</button>
    </div>
  </div>
</div>

<!-- LINE CONFIRM MODAL -->
<div class="modal-overlay" id="line-confirm-modal">
  <div class="modal-box">
    <div style="font-size:28px">‚ö†Ô∏è</div>
    <div class="warn" id="line-confirm-msg"></div>
    <div class="modal-btns">
      <button class="btn-cancel" onclick="hideModal('line-confirm-modal')">„ÇÑ„ÇÅ„Çã</button>
      <button class="btn-ok" onclick="doLineReport()">OKÔºÅ„Åä„Åè„Çã</button>
    </div>
  </div>
</div>

<script>
const PREFECTURES = [
  { id:'hokkaido', name:'„Åª„Å£„Åã„ÅÑ„Å©„ÅÜ', emoji:'‚ùÑÔ∏è', bg:'linear-gradient(135deg,#0D47A1,#1976D2)', items:[
    { name:'„Åò„ÇÉ„Åå„ÅÑ„ÇÇ', emoji:'ü•î', trivia:'„Åò„ÇÉ„Åå„ÅÑ„ÇÇ ‚Üí „Åª„Å£„Åã„ÅÑ„Å©„ÅÜÔºÅ„Å´„Åª„Çì„ÅÆ„ÇÑ„Åè8„Çè„Çä' },
    { name:'„É°„É≠„É≥', emoji:'üçà', trivia:'„É°„É≠„É≥ ‚Üí „Åª„Å£„Åã„ÅÑ„Å©„ÅÜÔºÅ„ÇÜ„ÅÜ„Å∞„Çä„É°„É≠„É≥„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüçà' },
    { name:'„Ç´„Éã', emoji:'ü¶Ä', trivia:'„Ç´„Éã ‚Üí „Åª„Å£„Åã„ÅÑ„Å©„ÅÜÔºÅ„Åü„Çâ„Å∞„Åå„Å´„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑü¶Ä' },
    { name:'„Å®„ÅÜ„ÇÇ„Çç„Åì„Åó', emoji:'üåΩ', trivia:'„Å®„ÅÜ„ÇÇ„Çç„Åì„Åó ‚Üí „Åª„Å£„Åã„ÅÑ„Å©„ÅÜÔºÅ„Å≤„Çç„ÅÑ„Å†„ÅÑ„Å°„Åß„Åù„Å†„Å§üåΩ' },
    { name:'„É©„Éô„É≥„ÉÄ„Éº', emoji:'üíú', trivia:'„É©„Éô„É≥„ÉÄ„Éº ‚Üí „Åª„Å£„Åã„ÅÑ„Å©„ÅÜÔºÅ„Åµ„Çâ„ÅÆ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüíú' },
  ]},
  { id:'aomori', name:'„ÅÇ„Åä„ÇÇ„Çä', emoji:'üèîÔ∏è', bg:'linear-gradient(135deg,#1B5E20,#388E3C)', items:[
    { name:'„Çä„Çì„Åî', emoji:'üçé', trivia:'„Çä„Çì„Åî ‚Üí „ÅÇ„Åä„ÇÇ„Çä„Åë„ÇìÔºÅ„Åó„ÇÖ„ÅÜ„Åã„Åè„Çä„Çá„ÅÜÊó•Êú¨‰∏Äüçé' },
    { name:'„Å´„Çì„Å´„Åè', emoji:'üßÑ', trivia:'„Å´„Çì„Å´„Åè ‚Üí „ÅÇ„Åä„ÇÇ„Çä„Åë„ÇìÔºÅÊó•Êú¨‰∏Ä„ÅÆ„Åï„Çì„Å°üßÑ' },
    { name:'„Å™„Åå„ÅÑ„ÇÇ', emoji:'ü•î', trivia:'„Å™„Åå„ÅÑ„ÇÇ ‚Üí „ÅÇ„Åä„ÇÇ„Çä„Åë„ÇìÔºÅ„Åô„Å™„ÅÆ„Å§„Å°„Åß„Çà„Åè„Åù„Å†„Å§' },
    { name:'„Åî„Åº„ÅÜ', emoji:'üåø', trivia:'„Åî„Åº„ÅÜ ‚Üí „ÅÇ„Åä„ÇÇ„Çä„Åë„ÇìÔºÅ„Åõ„ÅÑ„Åï„Çì„Çä„Çá„ÅÜÊó•Êú¨‰∏Ä' },
  ]},
  { id:'iwate', name:'„ÅÑ„Çè„Å¶', emoji:'‚õ∞Ô∏è', bg:'linear-gradient(135deg,#2E7D32,#4CAF50)', items:[
    { name:'„Çè„Çì„Åì„Åù„Å∞', emoji:'üçú', trivia:'„Çè„Çì„Åì„Åù„Å∞ ‚Üí „ÅÑ„Çè„Å¶„Åë„ÇìÔºÅ„Å™„Çì„Å∞„ÅÑ„Åü„Åπ„Çâ„Çå„Çã„Åã„Å™üçú' },
    { name:'„Å¶„Å§„Å≥„Çì', emoji:'ü´ñ', trivia:'„Å¶„Å§„Å≥„Çì ‚Üí „ÅÑ„Çè„Å¶„Åë„ÇìÔºÅ„Å™„Çì„Å∂„Å¶„Å§„Åç„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑü´ñ' },
    { name:'„Çä„Çì„Å©„ÅÜ', emoji:'üíê', trivia:'„Çä„Çì„Å©„ÅÜ ‚Üí „ÅÑ„Çè„Å¶„Åë„ÇìÔºÅ„Åë„Çì„ÅÆ„ÅØ„Å™üíê' },
  ]},
  { id:'miyagi', name:'„Åø„ÇÑ„Åé', emoji:'üåä', bg:'linear-gradient(135deg,#00695C,#00897B)', items:[
    { name:'„Åé„ÇÖ„ÅÜ„Åü„Çì', emoji:'ü•©', trivia:'„Åé„ÇÖ„ÅÜ„Åü„Çì ‚Üí „Åø„ÇÑ„Åé„Åë„ÇìÔºÅ„Åõ„Çì„Å†„ÅÑ„ÇÅ„ÅÑ„Å∂„Å§ü•©' },
    { name:'„Åï„Åï„Åã„Åæ„Åº„Åì', emoji:'üç•', trivia:'„Åï„Åï„Åã„Åæ„Åº„Åì ‚Üí „Åø„ÇÑ„Åé„Åë„ÇìÔºÅ„Åä„Åï„Åã„Å™„ÅÆ„Å≠„Çä„ÇÇ„ÅÆüç•' },
    { name:'„Åö„Çì„Å†„ÇÇ„Å°', emoji:'üü¢', trivia:'„Åö„Çì„Å†„ÇÇ„Å° ‚Üí „Åø„ÇÑ„Åé„Åë„ÇìÔºÅ„Åà„Å†„Åæ„ÇÅ„ÅÆ„Åä„ÇÇ„Å°üü¢' },
  ]},
  { id:'akita', name:'„ÅÇ„Åç„Åü', emoji:'üåæ', bg:'linear-gradient(135deg,#33691E,#558B2F)', items:[
    { name:'„ÅÇ„Åç„Åü„Åì„Åæ„Å°', emoji:'üçö', trivia:'„ÅÇ„Åç„Åü„Åì„Åæ„Å° ‚Üí „ÅÇ„Åç„Åü„Åë„ÇìÔºÅ„Åä„ÅÑ„Åó„ÅÑ„Åä„Ç≥„É°üçö' },
    { name:'„Åç„Çä„Åü„Çì„ÅΩ', emoji:'üç°', trivia:'„Åç„Çä„Åü„Çì„ÅΩ ‚Üí „ÅÇ„Åç„Åü„Åë„ÇìÔºÅ„Åä„Ç≥„É°„ÅÆ„Åº„ÅÜüç°' },
    { name:'„Å™„Åæ„ÅØ„Åí', emoji:'üëπ', trivia:'„Å™„Åæ„ÅØ„Åí ‚Üí „ÅÇ„Åç„Åü„Åë„ÇìÔºÅ„Åß„Çì„Å®„ÅÜ„Å¶„Åç„Å™„Åä„Åæ„Å§„Çäüëπ' },
  ]},
  { id:'yamagata', name:'„ÇÑ„Åæ„Åå„Åü', emoji:'üçí', bg:'linear-gradient(135deg,#880E4F,#AD1457)', items:[
    { name:'„Åï„Åè„Çâ„Çì„Åº', emoji:'üçí', trivia:'„Åï„Åè„Çâ„Çì„Åº ‚Üí „ÇÑ„Åæ„Åå„Åü„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Åï„Çì„Å°üçí' },
    { name:'„É©„Éª„Éï„É©„É≥„Çπ', emoji:'üçê', trivia:'„É©„Éª„Éï„É©„É≥„Çπ ‚Üí „ÇÑ„Åæ„Åå„Åü„Åë„ÇìÔºÅ„ÅÇ„Åæ„ÅÑ„Çà„ÅÜ„Å™„Åóüçê' },
    { name:'„ÅÑ„ÇÇ„Å´', emoji:'üç≤', trivia:'„ÅÑ„ÇÇ„Å´ ‚Üí „ÇÑ„Åæ„Åå„Åü„Åë„ÇìÔºÅ„ÅÇ„Åç„ÅÆ„ÅÑ„ÇÇ„Å´„Åã„ÅÑ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüç≤' },
  ]},
  { id:'fukushima', name:'„Åµ„Åè„Åó„Åæ', emoji:'üçë', bg:'linear-gradient(135deg,#E65100,#F57C00)', items:[
    { name:'„ÇÇ„ÇÇ', emoji:'üçë', trivia:'„ÇÇ„ÇÇ ‚Üí „Åµ„Åè„Åó„Åæ„Åë„ÇìÔºÅ„ÅÇ„Åæ„Åè„Å¶„Ç∏„É•„Éº„Ç∑„Éºüçë' },
    { name:'„ÅÇ„Åã„Åπ„Åì', emoji:'üêÑ', trivia:'„ÅÇ„Åã„Åπ„Åì ‚Üí „Åµ„Åè„Åó„Åæ„Åë„ÇìÔºÅ„ÅÇ„Åã„ÅÑ„ÅÜ„Åó„ÅÆ„Åä„Åç„ÅÇ„Åå„Çä„Åì„Åº„ÅóüêÑ' },
    { name:'„Åç„ÇÖ„ÅÜ„Çä', emoji:'ü•í', trivia:'„Åç„ÇÖ„ÅÜ„Çä ‚Üí „Åµ„Åè„Åó„Åæ„Åë„ÇìÔºÅ„Åó„ÇÖ„ÅÜ„Åã„Åè„Çä„Çá„ÅÜÊó•Êú¨‰∏Äü•í' },
  ]},
  { id:'ibaraki', name:'„ÅÑ„Å∞„Çâ„Åç', emoji:'üå∏', bg:'linear-gradient(135deg,#4A148C,#6A1B9A)', items:[
    { name:'„Å™„Å£„Å®„ÅÜ', emoji:'ü´ò', trivia:'„Å™„Å£„Å®„ÅÜ ‚Üí „ÅÑ„Å∞„Çâ„Åç„Åë„ÇìÔºÅ„Åø„Å®„Å™„Å£„Å®„ÅÜ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑü´ò' },
    { name:'„É°„É≠„É≥', emoji:'üçà', trivia:'„É°„É≠„É≥ ‚Üí „ÅÑ„Å∞„Çâ„Åç„Åë„ÇìÔºÅ„Åõ„ÅÑ„Åï„Çì„Çä„Çá„ÅÜÊó•Êú¨‰∏Äüçà' },
    { name:'„Åª„Åó„ÅÑ„ÇÇ', emoji:'üç†', trivia:'„Åª„Åó„ÅÑ„ÇÇ ‚Üí „ÅÑ„Å∞„Çâ„Åç„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÆ„Åª„Å®„Çì„Å©„Åå„Åì„Åìüç†' },
  ]},
  { id:'tochigi', name:'„Å®„Å°„Åé', emoji:'üçì', bg:'linear-gradient(135deg,#B71C1C,#D32F2F)', items:[
    { name:'„ÅÑ„Å°„Åî', emoji:'üçì', trivia:'„ÅÑ„Å°„Åî ‚Üí „Å®„Å°„Åé„Åë„ÇìÔºÅ„Å®„Å°„Åä„Å®„ÇÅ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüçì' },
    { name:'„Åé„Çá„ÅÜ„Åñ', emoji:'ü•ü', trivia:'„Åé„Çá„ÅÜ„Åñ ‚Üí „Å®„Å°„Åé„Åë„ÇìÔºÅ„ÅÜ„Å§„ÅÆ„Åø„ÇÑ„Åé„Çá„ÅÜ„Åñü•ü' },
    { name:'„Åã„Çì„Å¥„Çá„ÅÜ', emoji:'ü•í', trivia:'„Åã„Çì„Å¥„Çá„ÅÜ ‚Üí „Å®„Å°„Åé„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÆ„Åª„Åº„Åú„Çì„Å∂„Åå„Åì„Åì' },
  ]},
  { id:'gunma', name:'„Åê„Çì„Åæ', emoji:'‚ô®Ô∏è', bg:'linear-gradient(135deg,#4E342E,#6D4C41)', items:[
    { name:'„Åì„Çì„Å´„ÇÉ„Åè', emoji:'üü´', trivia:'„Åì„Çì„Å´„ÇÉ„Åè ‚Üí „Åê„Çì„Åæ„Åë„ÇìÔºÅÊó•Êú¨‰∏Ä„ÅÆ„Åõ„ÅÑ„Åï„Çì„Çä„Çá„ÅÜ' },
    { name:'„ÇÑ„Åç„Åæ„Çì„Åò„ÇÖ„ÅÜ', emoji:'üç°', trivia:'„ÇÑ„Åç„Åæ„Çì„Åò„ÇÖ„ÅÜ ‚Üí „Åê„Çì„Åæ„Åë„ÇìÔºÅ„Åø„Åù„Å†„Çå„Åå„Åä„ÅÑ„Åó„ÅÑüç°' },
    { name:'„Ç≠„É£„Éô„ÉÑ', emoji:'ü•¨', trivia:'„Ç≠„É£„Éô„ÉÑ ‚Üí „Åê„Çì„Åæ„Åë„ÇìÔºÅ„Å§„Åæ„Åî„ÅÑ„ÇÄ„Çâ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑü•¨' },
  ]},
  { id:'saitama', name:'„Åï„ÅÑ„Åü„Åæ', emoji:'üèôÔ∏è', bg:'linear-gradient(135deg,#1565C0,#1E88E5)', items:[
    { name:'„Åù„ÅÜ„Åã„Åõ„Çì„Åπ„ÅÑ', emoji:'üçò', trivia:'„Åù„ÅÜ„Åã„Åõ„Çì„Åπ„ÅÑ ‚Üí „Åï„ÅÑ„Åü„Åæ„Åë„ÇìÔºÅ„Åä„Åó„Çá„ÅÜ„ÇÜ„ÅÇ„Åòüçò' },
    { name:'„Åï„Å®„ÅÑ„ÇÇ', emoji:'ü•î', trivia:'„Åï„Å®„ÅÑ„ÇÇ ‚Üí „Åï„ÅÑ„Åü„Åæ„Åë„ÇìÔºÅ„Åõ„ÅÑ„Åï„Çì„Çä„Çá„ÅÜ„ÅåÂ§ö„ÅÑü•î' },
    { name:'„Å≤„Å™„Å´„Çì„Åé„Çá„ÅÜ', emoji:'üéé', trivia:'„Å≤„Å™„Å´„Çì„Åé„Çá„ÅÜ ‚Üí „Åï„ÅÑ„Åü„Åæ„Åë„ÇìÔºÅ„ÅÑ„Çè„Å§„Åç„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüéé' },
  ]},
  { id:'chiba', name:'„Å°„Å∞', emoji:'ü•ú', bg:'linear-gradient(135deg,#F57F17,#FBC02D)', items:[
    { name:'„Çâ„Å£„Åã„Åõ„ÅÑ', emoji:'ü•ú', trivia:'„Çâ„Å£„Åã„Åõ„ÅÑ ‚Üí „Å°„Å∞„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Åï„Çì„Å°ü•ú' },
    { name:'„Åó„Çá„ÅÜ„ÇÜ', emoji:'ü´ô', trivia:'„Åó„Çá„ÅÜ„ÇÜ ‚Üí „Å°„Å∞„Åë„ÇìÔºÅ„ÅÆ„Å†„Å®„Å°„Çá„ÅÜ„Åó„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑü´ô' },
    { name:'„Å™„Åó', emoji:'üçê', trivia:'„Å™„Åó ‚Üí „Å°„Å∞„Åë„ÇìÔºÅ„Åµ„Å™„Å∞„Åó„ÅÆ„Å™„Åó„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüçê' },
  ]},
  { id:'tokyo', name:'„Å®„ÅÜ„Åç„Çá„ÅÜ', emoji:'üóº', bg:'linear-gradient(135deg,#263238,#455A64)', items:[
    { name:'„ÇÇ„Çì„Åò„ÇÉ„ÇÑ„Åç', emoji:'ü•û', trivia:'„ÇÇ„Çì„Åò„ÇÉ„ÇÑ„Åç ‚Üí „Å®„ÅÜ„Åç„Çá„ÅÜÔºÅ„Å§„Åç„Åó„Åæ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑ' },
    { name:'„Åπ„Å£„Åì„ÅÜ„Åö„Åó', emoji:'üç£', trivia:'„Åπ„Å£„Åì„ÅÜ„Åö„Åó ‚Üí „Å®„ÅÜ„Åç„Çá„ÅÜÔºÅ„Åä„Åå„Åï„Çè„Çâ„ÅÆ„ÇÅ„ÅÑ„Å∂„Å§üç£' },
    { name:'„ÅÇ„Åó„Åü„Å∞', emoji:'üåø', trivia:'„ÅÇ„Åó„Åü„Å∞ ‚Üí „Å®„ÅÜ„Åç„Çá„ÅÜÔºÅ„ÅØ„Å°„Åò„Çá„ÅÜ„Åò„Åæ„Åß„Åù„Å†„Å§üåø' },
  ]},
  { id:'kanagawa', name:'„Åã„Å™„Åå„Çè', emoji:'üö¢', bg:'linear-gradient(135deg,#0D47A1,#1565C0)', items:[
    { name:'„Ç∑„É•„Ç¶„Éû„Ç§', emoji:'ü•ü', trivia:'„Ç∑„É•„Ç¶„Éû„Ç§ ‚Üí „Åã„Å™„Åå„Çè„Åë„ÇìÔºÅ„Çà„Åì„ÅØ„Åæ„ÇÅ„ÅÑ„Å∂„Å§ü•ü' },
    { name:'„Åã„Åæ„Åº„Åì', emoji:'üç•', trivia:'„Åã„Åæ„Åº„Åì ‚Üí „Åã„Å™„Åå„Çè„Åë„ÇìÔºÅ„Åä„Å†„Çè„Çâ„Åã„Åæ„Åº„Åìüç•' },
    { name:'„Åø„Åã„Çì', emoji:'üçä', trivia:'„Åø„Åã„Çì ‚Üí „Åã„Å™„Åå„Çè„Åë„ÇìÔºÅ„ÇÜ„Åå„Çè„Çâ„Åø„Åã„Çìüçä' },
  ]},
  { id:'niigata', name:'„Å´„ÅÑ„Åå„Åü', emoji:'üåæ', bg:'linear-gradient(135deg,#1B5E20,#558B2F)', items:[
    { name:'„Ç≥„Ç∑„Éí„Ç´„É™', emoji:'üçö', trivia:'„Ç≥„Ç∑„Éí„Ç´„É™ ‚Üí „Å´„ÅÑ„Åå„Åü„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Åä„Ç≥„É°üçö' },
    { name:'„Åà„Å†„Åæ„ÇÅ', emoji:'ü´õ', trivia:'„Åà„Å†„Åæ„ÇÅ ‚Üí „Å´„ÅÑ„Åå„Åü„Åë„ÇìÔºÅ„Åó„ÇÖ„ÅÜ„Åã„Åè„Çä„Çá„ÅÜÊó•Êú¨‰∏Äü´õ' },
    { name:'„ÉÅ„É•„Éº„É™„ÉÉ„Éó', emoji:'üå∑', trivia:'„ÉÅ„É•„Éº„É™„ÉÉ„Éó ‚Üí „Å´„ÅÑ„Åå„Åü„Åë„ÇìÔºÅ„Åç„Çå„ÅÑ„Å™„ÅØ„Åü„Åëüå∑' },
  ]},
  { id:'toyama', name:'„Å®„ÇÑ„Åæ', emoji:'üèîÔ∏è', bg:'linear-gradient(135deg,#01579B,#0277BD)', items:[
    { name:'„Åæ„Åô„Åö„Åó', emoji:'üç£', trivia:'„Åæ„Åô„Åö„Åó ‚Üí „Å®„ÇÑ„Åæ„Åë„ÇìÔºÅ„Åà„Åç„Åπ„Çì„Åß„ÇÜ„ÅÜ„ÇÅ„ÅÑüç£' },
    { name:'„Éõ„Çø„É´„Ç§„Ç´', emoji:'ü¶ë', trivia:'„Éõ„Çø„É´„Ç§„Ç´ ‚Üí „Å®„ÇÑ„Åæ„Åë„ÇìÔºÅ„Å≤„Åã„Çã„Ç§„Ç´ü¶ë' },
    { name:'„Åè„Åô„Çä', emoji:'üíä', trivia:'„Åè„Åô„Çä ‚Üí „Å®„ÇÑ„Åæ„Åë„ÇìÔºÅ„ÇÄ„Åã„Åó„Åã„Çâ„Åè„Åô„Çä„ÅÆ„Åæ„Å°üíä' },
  ]},
  { id:'ishikawa', name:'„ÅÑ„Åó„Åã„Çè', emoji:'üèØ', bg:'linear-gradient(135deg,#827717,#9E9D24)', items:[
    { name:'„Åç„Çì„Å±„Åè', emoji:'‚ú®', trivia:'„Åç„Çì„Å±„Åè ‚Üí „ÅÑ„Åó„Åã„Çè„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÆ„Åª„Å®„Çì„Å©„Åå„Åì„Åì‚ú®' },
    { name:'„Åã„Åå„ÇÑ„Åï„ÅÑ', emoji:'ü•ï', trivia:'„Åã„Åå„ÇÑ„Åï„ÅÑ ‚Üí „ÅÑ„Åó„Åã„Çè„Åë„ÇìÔºÅ„Åß„Çì„Å®„ÅÜ„ÇÑ„Åï„ÅÑü•ï' },
    { name:'„Çè„Åò„Åæ„Å¨„Çä', emoji:'üç≤', trivia:'„Çè„Åò„Åæ„Å¨„Çä ‚Üí „ÅÑ„Åó„Åã„Çè„Åë„ÇìÔºÅ„ÅÜ„Å§„Åè„Åó„ÅÑ„ÅÜ„Çã„Åó„Å¨„Çä' },
  ]},
  { id:'fukui', name:'„Åµ„Åè„ÅÑ', emoji:'üëì', bg:'linear-gradient(135deg,#311B92,#5E35B1)', items:[
    { name:'„ÇÅ„Åå„Å≠', emoji:'üëì', trivia:'„ÇÅ„Åå„Å≠ ‚Üí „Åµ„Åè„ÅÑ„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÆ9„Çè„Çä„Çí„Åõ„ÅÑ„Åï„Çìüëì' },
    { name:'„Åà„Å°„Åú„Çì„Åå„Å´', emoji:'ü¶Ä', trivia:'„Åà„Å°„Åú„Çì„Åå„Å´ ‚Üí „Åµ„Åè„ÅÑ„Åë„ÇìÔºÅ„Åµ„ÇÜ„ÅÆ„Åî„Å°„Åù„ÅÜü¶Ä' },
    { name:'„Å∏„Åó„Åì', emoji:'üêü', trivia:'„Å∏„Åó„Åì ‚Üí „Åµ„Åè„ÅÑ„Åë„ÇìÔºÅ„Åï„Å∞„ÅÆ„Å§„Åë„ÇÇ„ÅÆüêü' },
  ]},
  { id:'yamanashi', name:'„ÇÑ„Åæ„Å™„Åó', emoji:'üçá', bg:'linear-gradient(135deg,#4A148C,#7B1FA2)', items:[
    { name:'„Å∂„Å©„ÅÜ', emoji:'üçá', trivia:'„Å∂„Å©„ÅÜ ‚Üí „ÇÑ„Åæ„Å™„Åó„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Åï„Çì„Å°üçá' },
    { name:'„ÇÇ„ÇÇ', emoji:'üçë', trivia:'„ÇÇ„ÇÇ ‚Üí „ÇÑ„Åæ„Å™„Åó„Åë„ÇìÔºÅ„Åõ„ÅÑ„Åï„Çì„Çä„Çá„ÅÜÊó•Êú¨‰∏Äüçë' },
    { name:'„Åª„ÅÜ„Å®„ÅÜ', emoji:'üç≤', trivia:'„Åª„ÅÜ„Å®„ÅÜ ‚Üí „ÇÑ„Åæ„Å™„Åó„Åë„ÇìÔºÅ„Åµ„Å®„ÇÅ„Çì„ÅÆ„Å™„Åπüç≤' },
  ]},
  { id:'nagano', name:'„Å™„Åå„ÅÆ', emoji:'üçé', bg:'linear-gradient(135deg,#1B5E20,#2E7D32)', items:[
    { name:'„Çä„Çì„Åî', emoji:'üçé', trivia:'„Çä„Çì„Åî ‚Üí „Å™„Åå„ÅÆ„Åë„ÇìÔºÅÊó•Êú¨2„ÅÑ„ÅÆ„Åï„Çì„Å°üçé' },
    { name:'„Åù„Å∞', emoji:'üçú', trivia:'„Åù„Å∞ ‚Üí „Å™„Åå„ÅÆ„Åë„ÇìÔºÅ„Åó„Çì„Åó„ÇÖ„ÅÜ„Åù„Å∞„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüçú' },
    { name:'„Çè„Åï„Å≥', emoji:'üü¢', trivia:'„Çè„Åï„Å≥ ‚Üí „Å™„Åå„ÅÆ„Åë„ÇìÔºÅ„ÅÇ„Åö„Åø„ÅÆ„Åå„Åï„Çì„Å°üü¢' },
  ]},
  { id:'gifu', name:'„Åé„Åµ', emoji:'üèÆ', bg:'linear-gradient(135deg,#BF360C,#E64A19)', items:[
    { name:'„Åã„Åç', emoji:'üü†', trivia:'„Åã„Åç ‚Üí „Åé„Åµ„Åë„ÇìÔºÅ„Åµ„ÇÜ„ÅÆ„Åè„Å†„ÇÇ„ÅÆüü†' },
    { name:'„Å≤„Å†„Åé„ÇÖ„ÅÜ', emoji:'ü•©', trivia:'„Å≤„Å†„Åé„ÇÖ„ÅÜ ‚Üí „Åé„Åµ„Åë„ÇìÔºÅ„Åì„ÅÜ„Åç„ÇÖ„ÅÜ„Å™„Åä„Å´„Åèü•©' },
    { name:'„ÅÜ„Åã„ÅÑ', emoji:'üê¶', trivia:'„ÅÜ„Åã„ÅÑ ‚Üí „Åé„Åµ„Åë„ÇìÔºÅ„Å™„Åå„Çâ„Åå„Çè„ÅÆ„Åß„Çì„Å®„ÅÜüê¶' },
  ]},
  { id:'shizuoka', name:'„Åó„Åö„Åä„Åã', emoji:'üóª', bg:'linear-gradient(135deg,#1B5E20,#43A047)', items:[
    { name:'„Åä„Å°„ÇÉ', emoji:'üçµ', trivia:'„Åä„Å°„ÇÉ ‚Üí „Åó„Åö„Åä„Åã„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Å°„ÇÉ„Å©„Åì„Ççüçµ' },
    { name:'„ÅÜ„Å™„Åé', emoji:'üêü', trivia:'„ÅÜ„Å™„Åé ‚Üí „Åó„Åö„Åä„Åã„Åë„ÇìÔºÅ„ÅØ„Åæ„Åæ„Å§„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüêü' },
    { name:'„Åø„Åã„Çì', emoji:'üçä', trivia:'„Åø„Åã„Çì ‚Üí „Åó„Åö„Åä„Åã„Åë„ÇìÔºÅ„Å≤„Åñ„Åó„Åü„Å£„Å∑„Çäüçä' },
  ]},
  { id:'aichi', name:'„ÅÇ„ÅÑ„Å°', emoji:'üè≠', bg:'linear-gradient(135deg,#E65100,#F9A825)', items:[
    { name:'„Åò„Å©„ÅÜ„Åó„ÇÉ', emoji:'üöó', trivia:'„Åò„Å©„ÅÜ„Åó„ÇÉ ‚Üí „ÅÇ„ÅÑ„Å°„Åë„ÇìÔºÅ„Éà„É®„Çø„ÅÆ„Åä„Å≤„Åñ„ÇÇ„Å®üöó' },
    { name:'„Åø„Åù„Åã„Å§', emoji:'üçñ', trivia:'„Åø„Åù„Åã„Å§ ‚Üí „ÅÇ„ÅÑ„Å°„Åë„ÇìÔºÅ„ÅØ„Å£„Å°„Çá„ÅÜ„Åø„Åù„Åß„Åü„Åπ„Çãüçñ' },
    { name:'„Åà„Å≥„Åõ„Çì„Åπ„ÅÑ', emoji:'üçò', trivia:'„Åà„Å≥„Åõ„Çì„Åπ„ÅÑ ‚Üí „ÅÇ„ÅÑ„Å°„Åë„ÇìÔºÅ„ÇÜ„ÅÜ„ÇÅ„ÅÑ„Å™„Åä„Åã„Åóüçò' },
  ]},
  { id:'mie', name:'„Åø„Åà', emoji:'ü¶ê', bg:'linear-gradient(135deg,#00695C,#00897B)', items:[
    { name:'„ÅÑ„Åõ„Åà„Å≥', emoji:'ü¶û', trivia:'„ÅÑ„Åõ„Åà„Å≥ ‚Üí „Åø„Åà„Åë„ÇìÔºÅ„ÅÑ„Åõ„Åó„Åæ„ÅÆ„Åî„Å°„Åù„ÅÜü¶û' },
    { name:'„Åæ„Å§„Åï„Åã„ÅÜ„Åó', emoji:'üêÑ', trivia:'„Åæ„Å§„Åï„Åã„ÅÜ„Åó ‚Üí „Åø„Åà„Åë„ÇìÔºÅ„Åï„ÅÑ„Åì„ÅÜ„Åç„ÇÖ„ÅÜ„ÅÆ„Åä„Å´„ÅèüêÑ' },
    { name:'„Åó„Çì„Åò„ÇÖ', emoji:'üíé', trivia:'„Åó„Çì„Åò„ÇÖ ‚Üí „Åø„Åà„Åë„ÇìÔºÅ„Åó„Çì„Åò„ÇÖ„Çà„ÅÜ„Åó„Çá„Åè„ÅØ„Å£„Åó„Çá„ÅÜ„ÅÆ„Å°üíé' },
  ]},
  { id:'shiga', name:'„Åó„Åå', emoji:'üåä', bg:'linear-gradient(135deg,#0277BD,#0288D1)', items:[
    { name:'„Åµ„Å™„Åö„Åó', emoji:'üêü', trivia:'„Åµ„Å™„Åö„Åó ‚Üí „Åó„Åå„Åë„ÇìÔºÅ„Å≥„Çè„Åì„ÅÆ„Åß„Çì„Å®„ÅÜ„Çä„Çá„ÅÜ„Çäüêü' },
    { name:'„Åó„Åå„Çâ„Åç„ÇÑ„Åç', emoji:'üçµ', trivia:'„Åó„Åå„Çâ„Åç„ÇÑ„Åç ‚Üí „Åó„Åå„Åë„ÇìÔºÅ„Åü„Å¨„Åç„ÅÆ„Åä„Åç„ÇÇ„ÅÆ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüçµ' },
    { name:'„Å´„Çì„Åò„Çì', emoji:'ü•ï', trivia:'„Å´„Çì„Åò„Çì ‚Üí „Åó„Åå„Åë„ÇìÔºÅ„Åç„Çì„Åì„ÅÜ„Å´„Çì„Åò„Çì„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑü•ï' },
  ]},
  { id:'kyoto', name:'„Åç„Çá„ÅÜ„Å®', emoji:'‚õ©Ô∏è', bg:'linear-gradient(135deg,#880E4F,#AD1457)', items:[
    { name:'„ÇÑ„Å§„ÅØ„Åó', emoji:'üç°', trivia:'„ÇÑ„Å§„ÅØ„Åó ‚Üí „Åç„Çá„ÅÜ„Å®ÔºÅ„Å´„Çì„Åç„ÅÆ„Åä„Åø„ÇÑ„Åíüç°' },
    { name:'„Åæ„Å£„Å°„ÇÉ', emoji:'üçµ', trivia:'„Åæ„Å£„Å°„ÇÉ ‚Üí „Åç„Çá„ÅÜ„Å®ÔºÅ„ÅÜ„Åò„Å°„ÇÉ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüçµ' },
    { name:'„Åç„Çá„ÅÜ„ÇÑ„Åï„ÅÑ', emoji:'ü•¨', trivia:'„Åç„Çá„ÅÜ„ÇÑ„Åï„ÅÑ ‚Üí „Åç„Çá„ÅÜ„Å®ÔºÅ„Åß„Çì„Å®„ÅÜ„ÇÑ„Åï„ÅÑ„Åå„Åü„Åè„Åï„Çìü•¨' },
  ]},
  { id:'osaka', name:'„Åä„Åä„Åï„Åã', emoji:'üèØ', bg:'linear-gradient(135deg,#E65100,#FF6F00)', items:[
    { name:'„Åü„Åì„ÇÑ„Åç', emoji:'üêô', trivia:'„Åü„Åì„ÇÑ„Åç ‚Üí „Åä„Åä„Åï„ÅãÔºÅ„Åè„ÅÑ„Å†„Åä„Çå„ÅÆ„Åæ„Å°üêô' },
    { name:'„Åä„Åì„ÅÆ„Åø„ÇÑ„Åç', emoji:'ü•û', trivia:'„Åä„Åì„ÅÆ„Åø„ÇÑ„Åç ‚Üí „Åä„Åä„Åï„ÅãÔºÅ„Åì„Å™„ÇÇ„Çì„Å∂„Çì„Åãü•û' },
    { name:'„Å∂„Åü„Åæ„Çì', emoji:'ü•ü', trivia:'„Å∂„Åü„Åæ„Çì ‚Üí „Åä„Åä„Åï„ÅãÔºÅ551„ÅÆ„Å∂„Åü„Åæ„Çìü•ü' },
  ]},
  { id:'hyogo', name:'„Å≤„Çá„ÅÜ„Åî', emoji:'üêÑ', bg:'linear-gradient(135deg,#1A237E,#283593)', items:[
    { name:'„Åì„ÅÜ„Åπ„Åé„ÇÖ„ÅÜ', emoji:'ü•©', trivia:'„Åì„ÅÜ„Åπ„Åé„ÇÖ„ÅÜ ‚Üí „Å≤„Çá„ÅÜ„Åî„Åë„ÇìÔºÅ„Åõ„Åã„ÅÑ„Å¶„Åç„Å´„ÇÜ„ÅÜ„ÇÅ„ÅÑü•©' },
    { name:'„Åü„Åæ„Å≠„Åé', emoji:'üßÖ', trivia:'„Åü„Åæ„Å≠„Åé ‚Üí „Å≤„Çá„ÅÜ„Åî„Åë„ÇìÔºÅ„ÅÇ„Çè„Åò„Åó„Åæ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüßÖ' },
    { name:'„Åù„ÅÜ„ÇÅ„Çì', emoji:'üçú', trivia:'„ÅÑ„Åº„ÅÆ„ÅÑ„Å® ‚Üí „Å≤„Çá„ÅÜ„Åî„Åë„ÇìÔºÅ„ÇÜ„ÅÜ„ÇÅ„ÅÑ„Å™„Åù„ÅÜ„ÇÅ„Çìüçú' },
  ]},
  { id:'nara', name:'„Å™„Çâ', emoji:'ü¶å', bg:'linear-gradient(135deg,#4E342E,#6D4C41)', items:[
    { name:'„Åã„Åç„ÅÆ„ÅØ„Åö„Åó', emoji:'üç£', trivia:'„Åã„Åç„ÅÆ„ÅØ„Åö„Åó ‚Üí „Å™„Çâ„Åë„ÇìÔºÅ„ÅØ„Å£„Å±„Å´„Å§„Å§„Çì„Å†„Åä„Åô„Åóüç£' },
    { name:'„Åè„Åö„ÇÇ„Å°', emoji:'üç°', trivia:'„Åè„Åö„ÇÇ„Å° ‚Üí „Å™„Çâ„Åë„ÇìÔºÅ„Çà„Åó„ÅÆ„Åè„Åö„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüç°' },
    { name:'„Åô„Åø', emoji:'üñäÔ∏è', trivia:'„Åô„Åø ‚Üí „Å™„Çâ„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Åô„Åø„ÅÆ„Åï„Çì„Å°üñäÔ∏è' },
  ]},
  { id:'wakayama', name:'„Çè„Åã„ÇÑ„Åæ', emoji:'üçä', bg:'linear-gradient(135deg,#E65100,#FF8F00)', items:[
    { name:'„Åø„Åã„Çì', emoji:'üçä', trivia:'„Åø„Åã„Çì ‚Üí „Çè„Åã„ÇÑ„Åæ„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Åï„Çì„Å°üçä' },
    { name:'„ÅÜ„ÇÅ„Åº„Åó', emoji:'üî¥', trivia:'„ÅÜ„ÇÅ„Åº„Åó ‚Üí „Çè„Åã„ÇÑ„Åæ„Åë„ÇìÔºÅ„Å™„Çì„Åì„ÅÜ„ÅÜ„ÇÅ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑ' },
    { name:'„Åó„Çá„ÅÜ„ÇÜ', emoji:'ü´ô', trivia:'„Åó„Çá„ÅÜ„ÇÜ ‚Üí „Çè„Åã„ÇÑ„Åæ„Åë„ÇìÔºÅ„ÇÜ„ÅÇ„Åï„Åå„ÅØ„Å£„Åó„Çá„ÅÜ„ÅÆ„Å°ü´ô' },
  ]},
  { id:'tottori', name:'„Å®„Å£„Å®„Çä', emoji:'üèñÔ∏è', bg:'linear-gradient(135deg,#F9A825,#FBC02D)', items:[
    { name:'„Å´„Åò„Å£„Åõ„ÅÑ„Åç„Å™„Åó', emoji:'üçê', trivia:'„Å´„Åò„Å£„Åõ„ÅÑ„Åç„Å™„Åó ‚Üí „Å®„Å£„Å®„Çä„Åë„ÇìÔºÅ„ÅÇ„Åæ„ÅÑ„Å™„Åóüçê' },
    { name:'„Åô„Å™„ÅÆ„Åï„Åç„ÇÖ„ÅÜ', emoji:'üèñÔ∏è', trivia:'„Åô„Å™„ÅÆ„Åï„Åç„ÇÖ„ÅÜ ‚Üí „Å®„Å£„Å®„Çä„Åë„ÇìÔºÅ„Å´„Åª„Çì„Åï„ÅÑ„Å†„ÅÑüèñÔ∏è' },
    { name:'„Ç∫„ÉØ„Ç§„Ç¨„Éã', emoji:'ü¶Ä', trivia:'„Ç∫„ÉØ„Ç§„Ç¨„Éã ‚Üí „Å®„Å£„Å®„Çä„Åë„ÇìÔºÅ„Åµ„ÇÜ„ÅÆ„ÅÇ„Åò„Åã„Åèü¶Ä' },
  ]},
  { id:'shimane', name:'„Åó„Åæ„Å≠', emoji:'‚õ©Ô∏è', bg:'linear-gradient(135deg,#37474F,#546E7A)', items:[
    { name:'„Åó„Åò„Åø', emoji:'üêö', trivia:'„Åó„Åò„Åø ‚Üí „Åó„Åæ„Å≠„Åë„ÇìÔºÅ„Åó„Çì„Åò„Åì„Åß„Å®„Çå„Çãüêö' },
    { name:'„ÅÑ„Åö„ÇÇ„Åù„Å∞', emoji:'üçú', trivia:'„ÅÑ„Åö„ÇÇ„Åù„Å∞ ‚Üí „Åó„Åæ„Å≠„Åë„ÇìÔºÅ„Åì„ÅÑ„ÅÑ„Çç„ÅÆ„Åù„Å∞üçú' },
    { name:'„ÇÅ„ÅÆ„ÅÜ', emoji:'üíé', trivia:'„ÇÅ„ÅÆ„ÅÜ ‚Üí „Åó„Åæ„Å≠„Åë„ÇìÔºÅ„ÅÜ„Å§„Åè„Åó„ÅÑ„ÅÑ„Åóüíé' },
  ]},
  { id:'okayama', name:'„Åä„Åã„ÇÑ„Åæ', emoji:'üçë', bg:'linear-gradient(135deg,#FF6F00,#FF8F00)', items:[
    { name:'„ÇÇ„ÇÇ', emoji:'üçë', trivia:'„ÇÇ„ÇÇ ‚Üí „Åä„Åã„ÇÑ„Åæ„Åë„ÇìÔºÅ„ÅØ„Åè„Å®„ÅÜ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüçë' },
    { name:'„Éû„Çπ„Ç´„ÉÉ„Éà', emoji:'üçá', trivia:'„Éû„Çπ„Ç´„ÉÉ„Éà ‚Üí „Åä„Åã„ÇÑ„Åæ„Åë„ÇìÔºÅ„Åè„Å†„ÇÇ„ÅÆ„ÅÆ„Åä„ÅÜ„Åì„Åèüçá' },
    { name:'„Åç„Å≥„Å†„Çì„Åî', emoji:'üç°', trivia:'„Åç„Å≥„Å†„Çì„Åî ‚Üí „Åä„Åã„ÇÑ„Åæ„Åë„ÇìÔºÅ„ÇÇ„ÇÇ„Åü„Çç„ÅÜ„ÅÆ„Åä„ÅØ„Å™„Åóüç°' },
  ]},
  { id:'hiroshima', name:'„Å≤„Çç„Åó„Åæ', emoji:'‚õ©Ô∏è', bg:'linear-gradient(135deg,#B71C1C,#C62828)', items:[
    { name:'„Åã„Åç(„Åã„ÅÑ)', emoji:'ü¶™', trivia:'„Åã„Åç ‚Üí „Å≤„Çç„Åó„Åæ„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Çà„ÅÜ„Åó„Çá„Åèü¶™' },
    { name:'„Åä„Åì„ÅÆ„Åø„ÇÑ„Åç', emoji:'ü•û', trivia:'„Åä„Åì„ÅÆ„Åø„ÇÑ„Åç ‚Üí „Å≤„Çç„Åó„Åæ„Åë„ÇìÔºÅ„Åù„Å∞„ÅÑ„Çä„Åå„Å®„Åè„Å°„Çá„ÅÜü•û' },
    { name:'„É¨„É¢„É≥', emoji:'üçã', trivia:'„É¨„É¢„É≥ ‚Üí „Å≤„Çç„Åó„Åæ„Åë„ÇìÔºÅ„Åõ„ÅÑ„Åï„Çì„Çä„Çá„ÅÜÊó•Êú¨‰∏Äüçã' },
  ]},
  { id:'yamaguchi', name:'„ÇÑ„Åæ„Åê„Å°', emoji:'üê°', bg:'linear-gradient(135deg,#004D40,#00695C)', items:[
    { name:'„Åµ„Åê', emoji:'üê°', trivia:'„Åµ„Åê ‚Üí „ÇÑ„Åæ„Åê„Å°„Åë„ÇìÔºÅ„Åó„ÇÇ„ÅÆ„Åõ„Åç„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüê°' },
    { name:'„ÅÜ„ÅÑ„Çç„ÅÜ', emoji:'üç°', trivia:'„ÅÜ„ÅÑ„Çç„ÅÜ ‚Üí „ÇÑ„Åæ„Åê„Å°„Åë„ÇìÔºÅ„ÇÑ„Çè„Çâ„Åã„ÅÑ„Åä„Åã„Åóüç°' },
    { name:'„Åã„Åæ„Åº„Åì', emoji:'üç•', trivia:'„Åã„Åæ„Åº„Åì ‚Üí „ÇÑ„Åæ„Åê„Å°„Åë„ÇìÔºÅ„ÇÑ„Åç„Å¨„Åç„Åã„Åæ„Åº„Åìüç•' },
  ]},
  { id:'tokushima', name:'„Å®„Åè„Åó„Åæ', emoji:'üíÉ', bg:'linear-gradient(135deg,#00838F,#0097A7)', items:[
    { name:'„Åô„Å†„Å°', emoji:'üü¢', trivia:'„Åô„Å†„Å° ‚Üí „Å®„Åè„Åó„Åæ„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Åï„Çì„Å°üü¢' },
    { name:'„Å™„Çã„Å®„Åç„Çì„Å®„Åç', emoji:'üç†', trivia:'„Å™„Çã„Å®„Åç„Çì„Å®„Åç ‚Üí „Å®„Åè„Åó„Åæ„Åë„ÇìÔºÅ„ÅÇ„Åæ„ÅÑ„Åï„Å§„Åæ„ÅÑ„ÇÇüç†' },
    { name:'„ÅÇ„ÅÑ„Åû„ÇÅ', emoji:'üëò', trivia:'„ÅÇ„ÅÑ„Åû„ÇÅ ‚Üí „Å®„Åè„Åó„Åæ„Åë„ÇìÔºÅ„Åß„Çì„Å®„ÅÜ„ÅÆ„Åù„ÇÅ„ÇÇ„ÅÆüëò' },
  ]},
  { id:'kagawa', name:'„Åã„Åå„Çè', emoji:'üçú', bg:'linear-gradient(135deg,#BF360C,#E64A19)', items:[
    { name:'„ÅÜ„Å©„Çì', emoji:'üçú', trivia:'„ÅÜ„Å©„Çì ‚Üí „Åã„Åå„Çè„Åë„ÇìÔºÅ„Äå„ÅÜ„Å©„Çì„Åë„Çì„Äç„ÅÆ„ÅÇ„ÅÑ„Åó„Çá„ÅÜüçú' },
    { name:'„Ç™„É™„Éº„Éñ', emoji:'ü´í', trivia:'„Ç™„É™„Éº„Éñ ‚Üí „Åã„Åå„Çè„Åë„ÇìÔºÅ„Åó„Çá„ÅÜ„Å©„Åó„Åæ„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑü´í' },
    { name:'„Åª„Å≠„Å§„Åç„Å©„Çä', emoji:'üçó', trivia:'„Åª„Å≠„Å§„Åç„Å©„Çä ‚Üí „Åã„Åå„Çè„Åë„ÇìÔºÅ„ÇØ„É™„Çπ„Éû„Çπ„ÅÆ„Å¶„ÅÑ„Å∞„Çìüçó' },
  ]},
  { id:'ehime', name:'„Åà„Å≤„ÇÅ', emoji:'üçä', bg:'linear-gradient(135deg,#E65100,#FF8F00)', items:[
    { name:'„Åø„Åã„Çì', emoji:'üçä', trivia:'„Åø„Åã„Çì ‚Üí „Åà„Å≤„ÇÅ„Åë„ÇìÔºÅ„Äå„Åø„Åã„Çì„Åä„ÅÜ„Åì„Åè„Äçüçä' },
    { name:'„ÅÑ„Çà„Åã„Çì', emoji:'üçä', trivia:'„ÅÑ„Çà„Åã„Çì ‚Üí „Åà„Å≤„ÇÅ„Åë„ÇìÔºÅ„Å™„Åæ„Åà„ÅÆ„Äå„ÅÑ„Çà„Äç„ÅØÊÑõÂ™õ„ÅÆ„Åì„Å®' },
    { name:'„Çø„Ç™„É´', emoji:'üß£', trivia:'„Çø„Ç™„É´ ‚Üí „Åà„Å≤„ÇÅ„Åë„ÇìÔºÅ„ÅÑ„Åæ„Å∞„Çä„Çø„Ç™„É´„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑüß£' },
  ]},
  { id:'kochi', name:'„Åì„ÅÜ„Å°', emoji:'üåä', bg:'linear-gradient(135deg,#006064,#0097A7)', items:[
    { name:'„Ç´„ÉÑ„Ç™', emoji:'üêü', trivia:'„Ç´„ÉÑ„Ç™ ‚Üí „Åì„ÅÜ„Å°„Åë„ÇìÔºÅ„Ç´„ÉÑ„Ç™„ÅÆ„Åü„Åü„Åç„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑ' },
    { name:'„ÇÜ„Åö', emoji:'üçã', trivia:'„ÇÜ„Åö ‚Üí „Åì„ÅÜ„Å°„Åë„ÇìÔºÅ„Åõ„ÅÑ„Åï„Çì„Çä„Çá„ÅÜÊó•Êú¨‰∏Äüçã' },
    { name:'„Åó„Çá„ÅÜ„Åå', emoji:'ü´ö', trivia:'„Åó„Çá„ÅÜ„Åå ‚Üí „Åì„ÅÜ„Å°„Åë„ÇìÔºÅÊó•Êú¨‰∏Ä„ÅÆ„Åó„ÇÖ„ÅÜ„Åã„Åè„Çä„Çá„ÅÜ' },
  ]},
  { id:'fukuoka', name:'„Åµ„Åè„Åä„Åã', emoji:'üçú', bg:'linear-gradient(135deg,#D32F2F,#E53935)', items:[
    { name:'„Å®„Çì„Åì„Å§„É©„Éº„É°„É≥', emoji:'üçú', trivia:'„Å®„Çì„Åì„Å§„É©„Éº„É°„É≥ ‚Üí „Åµ„Åè„Åä„Åã„Åë„ÇìÔºÅ„ÅØ„Åã„Åü„É©„Éº„É°„É≥üçú' },
    { name:'„ÇÅ„Çì„Åü„ÅÑ„Åì', emoji:'üêü', trivia:'„ÇÅ„Çì„Åü„ÅÑ„Åì ‚Üí „Åµ„Åè„Åä„Åã„Åë„ÇìÔºÅ„Åî„ÅØ„Çì„ÅÆ„Åä„Å®„ÇÇüêü' },
    { name:'„ÅÇ„Åæ„Åä„ÅÜ', emoji:'üçì', trivia:'„ÅÇ„Åæ„Åä„ÅÜ ‚Üí „Åµ„Åè„Åä„Åã„Åë„ÇìÔºÅ„Åä„Åä„Åç„Åè„Å¶„ÅÇ„Åæ„ÅÑ„ÅÑ„Å°„Åîüçì' },
  ]},
  { id:'saga', name:'„Åï„Åå', emoji:'üç∂', bg:'linear-gradient(135deg,#1B5E20,#388E3C)', items:[
    { name:'„ÅÑ„Åæ„Çä„ÇÑ„Åç', emoji:'üç∂', trivia:'„ÅÑ„Åæ„Çä„ÇÑ„Åç ‚Üí „Åï„Åå„Åë„ÇìÔºÅ„ÅÜ„Å§„Åè„Åó„ÅÑ„ÇÑ„Åç„ÇÇ„ÅÆüç∂' },
    { name:'„Åï„Åå„Åé„ÇÖ„ÅÜ', emoji:'ü•©', trivia:'„Åï„Åå„Åé„ÇÖ„ÅÜ ‚Üí „Åï„Åå„Åë„ÇìÔºÅ„ÇÑ„Çè„Çâ„Åã„ÅÑ„Åä„Å´„Åèü•©' },
    { name:'„ÅÆ„Çä', emoji:'üåø', trivia:'„ÅÆ„Çä ‚Üí „Åï„Åå„Åë„ÇìÔºÅ„ÅÇ„Çä„ÅÇ„Åë„Åã„ÅÑ„ÅÆ„ÅÆ„Çäüåø' },
  ]},
  { id:'nagasaki', name:'„Å™„Åå„Åï„Åç', emoji:'‚õ™', bg:'linear-gradient(135deg,#0D47A1,#1976D2)', items:[
    { name:'„Ç´„Çπ„ÉÜ„É©', emoji:'üç∞', trivia:'„Ç´„Çπ„ÉÜ„É© ‚Üí „Å™„Åå„Åï„Åç„Åë„ÇìÔºÅ„Éù„É´„Éà„Ç¨„É´„Åã„Çâ„Å§„Åü„Çè„Å£„Åüüç∞' },
    { name:'„Å°„ÇÉ„Çì„ÅΩ„Çì', emoji:'üçú', trivia:'„Å°„ÇÉ„Çì„ÅΩ„Çì ‚Üí „Å™„Åå„Åï„Åç„Åë„ÇìÔºÅ„Åê„Åñ„ÅÑ„Åü„Å£„Å∑„Çä„ÇÅ„Çìüçú' },
    { name:'„Å≥„Çè', emoji:'üü†', trivia:'„Å≥„Çè ‚Üí „Å™„Åå„Åï„Åç„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Åï„Çì„Å°üü†' },
  ]},
  { id:'kumamoto', name:'„Åè„Åæ„ÇÇ„Å®', emoji:'üêª', bg:'linear-gradient(135deg,#212121,#424242)', items:[
    { name:'„Åã„Çâ„Åó„Çå„Çì„Åì„Çì', emoji:'ü•¨', trivia:'„Åã„Çâ„Åó„Çå„Çì„Åì„Çì ‚Üí „Åè„Åæ„ÇÇ„Å®„Åë„ÇìÔºÅ„Éî„É™„ÉÉ„Å®„Åã„Çâ„ÅÑü•¨' },
    { name:'„Åô„ÅÑ„Åã', emoji:'üçâ', trivia:'„Åô„ÅÑ„Åã ‚Üí „Åè„Åæ„ÇÇ„Å®„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Åï„Çì„Å°üçâ' },
    { name:'„Å∞„Åï„Åó', emoji:'üê¥', trivia:'„Å∞„Åï„Åó ‚Üí „Åè„Åæ„ÇÇ„Å®„Åë„ÇìÔºÅ„ÅÜ„Åæ„ÅÆ„Åä„Åï„Åó„Åøüê¥' },
  ]},
  { id:'oita', name:'„Åä„Åä„ÅÑ„Åü', emoji:'‚ô®Ô∏è', bg:'linear-gradient(135deg,#E65100,#BF360C)', items:[
    { name:'„Åä„Çì„Åõ„Çì', emoji:'‚ô®Ô∏è', trivia:'„Åä„Çì„Åõ„Çì ‚Üí „Åä„Åä„ÅÑ„Åü„Åë„ÇìÔºÅ„Åπ„Å£„Å∑„Åä„Çì„Åõ„Çì„Åå„ÇÜ„ÅÜ„ÇÅ„ÅÑ‚ô®Ô∏è' },
    { name:'„Åã„Åº„Åô', emoji:'üü¢', trivia:'„Åã„Åº„Åô ‚Üí „Åä„Åä„ÅÑ„Åü„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÅÑ„Å°„ÅÆ„Åï„Çì„Å°üü¢' },
    { name:'„Å®„Çä„Å¶„Çì', emoji:'üçó', trivia:'„Å®„Çä„Å¶„Çì ‚Üí „Åä„Åä„ÅÑ„Åü„Åë„ÇìÔºÅ„Å®„Çä„Å´„Åè„ÅÆ„Å¶„Çì„Å∑„Çâüçó' },
  ]},
  { id:'miyazaki', name:'„Åø„ÇÑ„Åñ„Åç', emoji:'üå¥', bg:'linear-gradient(135deg,#00838F,#00ACC1)', items:[
    { name:'„Éû„É≥„Ç¥„Éº', emoji:'ü•≠', trivia:'„Éû„É≥„Ç¥„Éº ‚Üí „Åø„ÇÑ„Åñ„Åç„Åë„ÇìÔºÅ„Åü„ÅÑ„Çà„ÅÜ„ÅÆ„Çø„Éû„Ç¥ü•≠' },
    { name:'„ÉÅ„Ç≠„É≥„Å™„Çì„Å∞„Çì', emoji:'üçó', trivia:'„ÉÅ„Ç≠„É≥„Å™„Çì„Å∞„Çì ‚Üí „Åø„ÇÑ„Åñ„Åç„Åë„ÇìÔºÅ„Çø„É´„Çø„É´„ÇΩ„Éº„Çπüçó' },
    { name:'„Åç„ÇÖ„ÅÜ„Çä', emoji:'ü•í', trivia:'„Åç„ÇÖ„ÅÜ„Çä ‚Üí „Åø„ÇÑ„Åñ„Åç„Åë„ÇìÔºÅ„Åµ„ÇÜ„ÇÇ„ÅÇ„Åü„Åü„Åã„ÅÑü•í' },
  ]},
  { id:'kagoshima', name:'„Åã„Åî„Åó„Åæ', emoji:'üåã', bg:'linear-gradient(135deg,#37474F,#546E7A)', items:[
    { name:'„Åè„Çç„Å∂„Åü', emoji:'üê∑', trivia:'„Åè„Çç„Å∂„Åü ‚Üí „Åã„Åî„Åó„Åæ„Åë„ÇìÔºÅ„Åä„ÅÑ„Åó„ÅÑ„Å∂„Åü„Å´„Åèüê∑' },
    { name:'„Åï„Å§„Åæ„ÅÑ„ÇÇ', emoji:'üç†', trivia:'„Åï„Å§„Åæ„ÅÑ„ÇÇ ‚Üí „Åã„Åî„Åó„Åæ„Åë„ÇìÔºÅ„Å™„Åæ„Åà„ÅÆ„ÇÜ„Çâ„ÅÑüç†' },
    { name:'„Åï„Å§„Åæ„ÅÇ„Åí', emoji:'üç¢', trivia:'„Åï„Å§„Åæ„ÅÇ„Åí ‚Üí „Åã„Åî„Åó„Åæ„Åë„ÇìÔºÅ„Åä„Åï„Åã„Å™„ÅÆ„Åô„Çä„Åøüç¢' },
  ]},
  { id:'okinawa', name:'„Åä„Åç„Å™„Çè', emoji:'üå∫', bg:'linear-gradient(135deg,#B71C1C,#E53935)', items:[
    { name:'„Åï„Å®„ÅÜ„Åç„Å≥', emoji:'üåø', trivia:'„Åï„Å®„ÅÜ„Åç„Å≥ ‚Üí „Åä„Åç„Å™„Çè„Åë„ÇìÔºÅ„ÅÇ„Åü„Åü„Åã„ÅÑ„Åç„Åì„ÅÜ„Åß„Åô„Åè„Åô„Åè' },
    { name:'„Éë„Ç§„Éä„ÉÉ„Éó„É´', emoji:'üçç', trivia:'„Éë„Ç§„Éä„ÉÉ„Éó„É´ ‚Üí „Åä„Åç„Å™„Çè„Åë„ÇìÔºÅ„Å´„Åª„Çì„ÇÜ„ÅÑ„ÅÑ„Å§„ÅÆ„Åï„Çì„Å°üçç' },
    { name:'„Ç¥„Éº„É§', emoji:'ü•í', trivia:'„Ç¥„Éº„É§ ‚Üí „Åä„Åç„Å™„Çè„Åë„ÇìÔºÅ„Ç¥„Éº„É§„ÉÅ„É£„É≥„Éó„É´„Éºü•í' },
  ]},
];

// Level configs: regionCount + game params only
const LEVEL_CONFIGS = [
  { name: '„É¨„Éô„É´1', regionCount: 2, speed: 0.6, interval: 2800, total: 10 },
  { name: '„É¨„Éô„É´2', regionCount: 3, speed: 0.8, interval: 2400, total: 14 },
  { name: '„É¨„Éô„É´3', regionCount: 4, speed: 1.0, interval: 2000, total: 16 },
  { name: '„É¨„Éô„É´4', regionCount: 5, speed: 1.2, interval: 1800, total: 18 },
];

// Dynamically build a level by picking random prefectures
function buildLevel(configIdx) {
  const config = LEVEL_CONFIGS[configIdx];
  const picked = shuffle(PREFECTURES).slice(0, config.regionCount);
  const regions = picked.map(p => ({ name: p.name, emoji: p.emoji, bg: p.bg }));
  const items = [];
  picked.forEach((p, rIdx) => {
    p.items.forEach(it => {
      items.push({ name: it.name, emoji: it.emoji, region: rIdx, trivia: it.trivia });
    });
  });
  return { name: config.name, regions, items, speed: config.speed, interval: config.interval, total: config.total };
}


const CARD_COLOR='linear-gradient(135deg,#4A4A5A,#5C5C6E)';

// ===== ALT SYSTEM =====
let altTotal=0, altSession=0, clearedLevels={};
function updateAltBadge(){document.getElementById('alt-display').textContent=altTotal;updateLineBtn()}
function getStarRating(c,t){if(t===0)return 0;const r=c/t;if(r>=1)return 3;if(r>=0.8)return 2;return 1}
function getStarBonus(s,alive){if(!alive)return 0;if(s===3)return 10;if(s===2)return 6;return 3}

// ===== RANKING SYSTEM =====
const RANK_KEY_WEEKLY='tokusan_rank_weekly';
const RANK_KEY_ALLTIME='tokusan_rank_alltime';
const RANK_KEY_WEEK='tokusan_rank_weekstart';
const NAME_KEY='tokusan_player_name';
let currentRankTab='weekly';
let lastRegisteredScore=null; // prevent double register
let cameFromResult=false; // track navigation

function getMonday4am(){
  const now=new Date();
  const d=new Date(now);
  const day=d.getDay();
  const diff=day===0?6:day-1;
  d.setDate(d.getDate()-diff);
  d.setHours(4,0,0,0);
  if(now<d)d.setDate(d.getDate()-7);
  return d.getTime();
}

function getWeekEnd(start){const e=new Date(start);e.setDate(e.getDate()+7);return e}

function loadRanking(key){try{return JSON.parse(localStorage.getItem(key))||[]}catch(e){return[]}}
function saveRanking(key,data){localStorage.setItem(key,JSON.stringify(data))}

function checkWeeklyReset(){
  const mondayTs=getMonday4am();
  const saved=parseInt(localStorage.getItem(RANK_KEY_WEEK)||'0');
  if(saved<mondayTs){
    localStorage.setItem(RANK_KEY_WEEK,mondayTs.toString());
    saveRanking(RANK_KEY_WEEKLY,[]);
  }
}

function addToRanking(name,scr){
  checkWeeklyReset();
  let isNewBest=false;
  // Weekly: keep best per name
  let weekly=loadRanking(RANK_KEY_WEEKLY);
  const wi=weekly.findIndex(e=>e.name===name);
  if(wi>=0){
    if(scr>weekly[wi].score){weekly[wi].score=scr;isNewBest=true}
  }else{weekly.push({name,score:scr});isNewBest=true}
  weekly.sort((a,b)=>b.score-a.score);
  saveRanking(RANK_KEY_WEEKLY,weekly);
  const weeklyRank=weekly.findIndex(e=>e.name===name)+1;

  // Alltime: top 20
  let alltime=loadRanking(RANK_KEY_ALLTIME);
  const ai=alltime.findIndex(e=>e.name===name);
  if(ai>=0){
    if(scr>alltime[ai].score)alltime[ai].score=scr;
  }else{alltime.push({name,score:scr})}
  alltime.sort((a,b)=>b.score-a.score);
  alltime=alltime.slice(0,20);
  saveRanking(RANK_KEY_ALLTIME,alltime);
  const atRank=alltime.findIndex(e=>e.name===name)+1;

  return{weeklyRank,weeklyTotal:weekly.length,alltimeRank:atRank||'-',isNewBest};
}

function getSavedName(){return localStorage.getItem(NAME_KEY)||''}
function saveName(n){localStorage.setItem(NAME_KEY,n)}

// Ranking UI
function showScreen(id){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.getElementById('alt-badge').style.display=(id==='title-screen'||id==='ranking-screen')?'block':'none';
}

function showNameModal(){
  const input=document.getElementById('rank-name-input');
  input.value=getSavedName();
  document.getElementById('name-modal').classList.add('show');
  setTimeout(()=>input.focus(),100);
}
function hideModal(id){document.getElementById(id).classList.remove('show')}

function doRegister(){
  const name=document.getElementById('rank-name-input').value.trim();
  if(!name)return;
  saveName(name);
  hideModal('name-modal');
  // Also update LINE name field
  document.getElementById('line-name').value=name;
  const result=addToRanking(name,score);
  lastRegisteredScore=score;

  // Show result in rank area
  const area=document.getElementById('result-rank-area');
  let html='<div class="rank-result">';
  if(result.isNewBest)html+='<div class="new-best">üÜï „Åò„Åì„Éô„Çπ„Éà „Åì„ÅÜ„Åó„ÇìÔºÅ</div>';
  html+=`üìä „Åó„ÇÖ„ÅÜ„Åã„Çì <strong>${result.weeklyRank}‰Ωç</strong> / ${result.weeklyTotal}‰∫∫<br>`;
  html+=`üëë „Çå„Åç„Å†„ÅÑ <strong>${result.alltimeRank>0?result.alltimeRank+'‰Ωç':'--'}</strong>`;
  html+='</div>';
  html+='<span class="rank-link" onclick="cameFromResult=true;showScreen(\'ranking-screen\');renderRanking()">‚ñ∂ „É©„É≥„Ç≠„É≥„Ç∞„Çí„Åø„Çã</span>';
  area.innerHTML=html;
}

function goBackFromRanking(){
  if(cameFromResult){cameFromResult=false;showScreen('result-screen');document.getElementById('alt-badge').style.display='none'}
  else{goTitle()}
}

function switchRankTab(tab){
  currentRankTab=tab;
  document.getElementById('tab-weekly').classList.toggle('active',tab==='weekly');
  document.getElementById('tab-alltime').classList.toggle('active',tab==='alltime');
  renderRanking();
}

function renderRanking(){
  checkWeeklyReset();
  const isWeekly=currentRankTab==='weekly';
  const data=loadRanking(isWeekly?RANK_KEY_WEEKLY:RANK_KEY_ALLTIME);
  const myName=getSavedName();
  const periodEl=document.getElementById('rank-period');
  if(isWeekly){
    const ms=getMonday4am();
    const s=new Date(ms);const e=getWeekEnd(ms);
    periodEl.textContent=`${s.getMonth()+1}/${s.getDate()}(Êúà) „Äú ${e.getMonth()+1}/${e.getDate()}(Êó•)`;
  }else{periodEl.textContent='üèÜ „Åß„Çì„Å©„ÅÜ„ÅÑ„Çä TOP20'}
  const list=document.getElementById('rank-list');
  if(data.length===0){list.innerHTML='<div class="rank-empty">„Åæ„Å†„Å®„ÅÜ„Çç„Åè„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';return}
  const top10=data.slice(0,10);
  const medals=['ü•á','ü•à','ü•â'];
  let html='';
  top10.forEach((e,i)=>{
    const isMe=e.name===myName;
    const isTop3=i<3;
    html+=`<div class="rank-row${isMe?' me':''}${isTop3?' top3':''}">`;
    html+=`<div class="rank-pos">${i<3?medals[i]:(i+1)}</div>`;
    html+=`<div class="rank-name">${e.name}</div>`;
    html+=`<div class="rank-score">${e.score.toLocaleString()}</div></div>`;
  });
  // Show my position if not in top 10
  const myIdx=data.findIndex(e=>e.name===myName);
  if(myName&&myIdx>=10){
    html+='<hr class="rank-divider">';
    html+=`<div class="rank-row me"><div class="rank-pos">${myIdx+1}</div>`;
    html+=`<div class="rank-name">üìç ${data[myIdx].name}</div>`;
    html+=`<div class="rank-score">${data[myIdx].score.toLocaleString()}</div></div>`;
  }
  list.innerHTML=html;
}

// LINE Report
function updateLineBtn(){
  const name=document.getElementById('line-name').value.trim();
  document.getElementById('line-btn').disabled=(altTotal<=0||name.length===0);
}
function showLineConfirm(){
  document.getElementById('line-confirm-msg').innerHTML='<strong>'+altTotal+'</strong> ALT„Çí„Åª„ÅÜ„Åì„Åè„Åó„Å¶„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô';
  document.getElementById('line-confirm-modal').classList.add('show');
}
function doLineReport(){
  hideModal('line-confirm-modal');
  const name=document.getElementById('line-name').value.trim();
  const cleared=Object.keys(clearedLevels).length;
  const text=`„Äê„Å®„Åè„Åï„Çì„Å∂„Å§„Éû„ÉÉ„ÉÅ„É≥„Ç∞ ALT„Åª„ÅÜ„Åì„Åè„Äë\n„Å™„Åæ„Åà: ${name}\nüí∞ ${altTotal}ALT\n„ÇØ„É™„Ç¢„Åö„Åø: „É¨„Éô„É´${cleared}/4`;
  const url=`https://line.me/R/oaMessage/@trail_official/?${encodeURIComponent(text)}`;
  altTotal=0;altSession=0;updateAltBadge();
  window.open(url,'_blank');
}

// ===== STATE =====
let currentLevel=0,score=0,combo=0,maxCombo=0,lives=3;
let correctCount=0,missCount=0,totalSpawned=0;
let gameActive=false,spawnTimer=null,animFrame=null;
let cards=[],shuffledItems=[],itemIndex=0,results=[];
let isFever=false,feverEl=null,dragCard=null;
let dragOffsetX=0,dragOffsetY=0;
let currentLevelData=null;
let freezeUntil=0;
let feverCounterEl=null;

// ===== SOUNDS =====
const audioCtx=new(window.AudioContext||window.webkitAudioContext)();
function playSound(type){
  const now=audioCtx.currentTime;const osc=audioCtx.createOscillator();const gain=audioCtx.createGain();
  osc.connect(gain);gain.connect(audioCtx.destination);
  if(type==='correct'){osc.type='sine';osc.frequency.setValueAtTime(523,now);osc.frequency.setValueAtTime(659,now+0.08);osc.frequency.setValueAtTime(784,now+0.16);gain.gain.setValueAtTime(0.15,now);gain.gain.setValueAtTime(0.01,now+0.3);osc.start(now);osc.stop(now+0.3)}
  else if(type==='combo'){osc.type='sine';osc.frequency.setValueAtTime(784,now);osc.frequency.setValueAtTime(988,now+0.1);osc.frequency.setValueAtTime(1175,now+0.2);gain.gain.setValueAtTime(0.18,now);gain.gain.setValueAtTime(0.01,now+0.35);osc.start(now);osc.stop(now+0.35)}
  else if(type==='miss'){osc.type='square';osc.frequency.setValueAtTime(180,now);osc.frequency.setValueAtTime(120,now+0.1);gain.gain.setValueAtTime(0.1,now);gain.gain.setValueAtTime(0.01,now+0.2);osc.start(now);osc.stop(now+0.2)}
  else if(type==='fever'){for(let i=0;i<5;i++){const o=audioCtx.createOscillator(),g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);o.type='sine';o.frequency.setValueAtTime([523,659,784,988,1175][i],now+i*0.08);g.gain.setValueAtTime(0.12,now+i*0.08);g.gain.setValueAtTime(0.01,now+i*0.08+0.15);o.start(now+i*0.08);o.stop(now+i*0.08+0.15)}}
}

// ===== INIT =====
function initStars(){const c=document.getElementById('stars');for(let i=0;i<50;i++){const s=document.createElement('div');s.className='star';s.style.left=Math.random()*100+'%';s.style.top=Math.random()*100+'%';s.style.animationDelay=Math.random()*3+'s';s.style.width=s.style.height=(1+Math.random()*2)+'px';c.appendChild(s)}}
initStars();
function shuffle(arr){const a=[...arr];for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

// ===== GAME =====
function startGame(lvIdx){
  if(audioCtx.state==='suspended')audioCtx.resume();
  currentLevel=lvIdx;
  currentLevelData=buildLevel(lvIdx);
  const lv=currentLevelData;
  score=0;combo=0;maxCombo=0;lives=3;
  correctCount=0;missCount=0;totalSpawned=0;
  gameActive=true;cards=[];results=[];
  isFever=false;itemIndex=0;altSession=0;freezeUntil=0;
  lastRegisteredScore=null;
  shuffledItems=shuffle(lv.items);
  while(shuffledItems.length<lv.total)shuffledItems=shuffledItems.concat(shuffle(lv.items));
  showScreen('game-screen');
  document.getElementById('level-label').textContent=lv.name;
  updateHUD();buildRegionZones(lv);
  document.getElementById('play-area').innerHTML='';
  if(feverEl){feverEl.remove();feverEl=null}
  scheduleSpawn();gameLoop();
}

function buildRegionZones(lv){const c=document.getElementById('region-zones');c.innerHTML='';lv.regions.forEach((r,i)=>{const z=document.createElement('div');z.className='region-zone';z.style.background=r.bg;z.dataset.index=i;z.innerHTML=`<span class="zone-emoji">${r.emoji}</span>${r.name}`;c.appendChild(z)})}
function updateHUD(){
  document.getElementById('score').textContent=score;
  const ce=document.getElementById('combo');
  ce.textContent=combo>1?`üî• ${combo}„Ç≥„É≥„Éú`:'';
  if(combo>1){ce.classList.add('pop');setTimeout(()=>ce.classList.remove('pop'),150)}
  document.getElementById('lives').textContent='‚ù§Ô∏è'.repeat(Math.max(0,lives));
}

// Spawn
function getSpawnCount(){const p=totalSpawned/currentLevelData.total;if(p<0.3)return 1;if(p<0.55)return 2;if(p<0.8)return Math.random()<0.5?2:3;return 3}
function getSpawnInterval(){const lv=currentLevelData;const p=totalSpawned/lv.total;return lv.interval*(p<0.5?1.0:(1.0-(p-0.5)*0.3))}
function scheduleSpawn(){
  if(!gameActive)return;const lv=currentLevelData;if(totalSpawned>=lv.total)return;
  const count=Math.min(getSpawnCount(),lv.total-totalSpawned);
  for(let i=0;i<count;i++)setTimeout(()=>spawnOne(),i*300);
  spawnTimer=setTimeout(scheduleSpawn,getSpawnInterval());
}
function spawnOne(){
  if(!gameActive)return;const lv=currentLevelData;if(totalSpawned>=lv.total)return;
  const item=shuffledItems[itemIndex%shuffledItems.length];itemIndex++;totalSpawned++;
  const pa=document.getElementById('play-area');const aW=pa.offsetWidth;
  const isTablet=aW>=600;const cardW=isTablet?(aW>=900?160:140):105;
  const card=document.createElement('div');card.className='falling-card';card.style.background=CARD_COLOR;
  const laneCount=Math.min(isTablet?4:3,lv.regions.length);
  const laneW=(aW-50)/laneCount;const lane=totalSpawned%laneCount;
  const x=12+lane*laneW+Math.random()*Math.max(0,laneW-cardW-10);
  card.style.left=x+'px';card.style.top='-'+(cardW+30)+'px';
  card.innerHTML=`<span class="card-emoji">${item.emoji}</span><span class="card-name">${item.name}</span>`;
  card.addEventListener('pointerdown',e=>onDragStart(e,card));pa.appendChild(card);
  const speedMult=pa.offsetHeight>800?1.3:(pa.offsetHeight>600?1.15:1);
  const obj={el:card,x,y:-(cardW+30),item,speed:lv.speed*speedMult*(isFever?1.5:1),alive:true,dragging:false};
  card._cardObj=obj;cards.push(obj);
}

// Drag
function onDragStart(e,el){if(!gameActive)return;e.preventDefault();const c=el._cardObj;if(!c||!c.alive)return;c.dragging=true;dragCard=c;const r=el.getBoundingClientRect();dragOffsetX=e.clientX-r.left;dragOffsetY=e.clientY-r.top;el.style.zIndex=30;el.style.cursor='grabbing';el.setPointerCapture(e.pointerId);el.addEventListener('pointermove',onDragMove);el.addEventListener('pointerup',onDragEnd)}
function onDragMove(e){if(!dragCard)return;e.preventDefault();const pa=document.getElementById('play-area');const pr=pa.getBoundingClientRect();dragCard.x=e.clientX-pr.left-dragOffsetX;dragCard.y=e.clientY-pr.top-dragOffsetY;dragCard.el.style.left=dragCard.x+'px';dragCard.el.style.top=dragCard.y+'px';highlightZone(e.clientX,e.clientY)}
function onDragEnd(e){if(!dragCard)return;e.preventDefault();dragCard.dragging=false;dragCard.el.style.cursor='grab';dragCard.el.removeEventListener('pointermove',onDragMove);dragCard.el.removeEventListener('pointerup',onDragEnd);document.querySelectorAll('.region-zone').forEach(z=>z.classList.remove('highlight'));let matched=false;document.querySelectorAll('.region-zone').forEach(z=>{const r=z.getBoundingClientRect();if(e.clientX>=r.left&&e.clientX<=r.right&&e.clientY>=r.top&&e.clientY<=r.bottom){handleAnswer(dragCard,parseInt(z.dataset.index),z);matched=true}});dragCard=null}
function highlightZone(cx,cy){document.querySelectorAll('.region-zone').forEach(z=>{const r=z.getBoundingClientRect();z.classList.toggle('highlight',cx>=r.left&&cx<=r.right&&cy>=r.top&&cy<=r.bottom)})}

function handleAnswer(cardObj,zoneIdx,zoneEl){
  if(!cardObj.alive)return;cardObj.alive=false;
  const correct=cardObj.item.region===zoneIdx;
  if(correct){
    combo++;correctCount++;if(combo>maxCombo)maxCombo=combo;
    score+=isFever?200:100;
    zoneEl.classList.add('correct-flash');setTimeout(()=>zoneEl.classList.remove('correct-flash'),500);
    showFeedback('PERFECT!','var(--perfect)');
    const pCount=combo>=10?14:8;spawnParticles(cardObj.el,'#4ADE80',pCount);
    results.push({...cardObj.item,correct:true});
    if(combo===5){showComboBurst('üî• 5„Ç≥„É≥„ÉúÔºÅ');playSound('combo');freezeUntil=performance.now()+700}
    else if(combo===10){showComboBurst('‚ö° „Éï„Ç£„Éº„Éê„ÉºÔºÅ');playSound('fever');startFever();freezeUntil=performance.now()+700;showFeverCounter()}
    else if(combo>10){playSound('combo');updateFeverCounter();showEdgeFlash()}
    else if(combo>=5){playSound('combo')}
    else{playSound('correct')}
  }else{
    combo=0;lives--;missCount++;hideFeverCounter();
    zoneEl.classList.add('wrong-flash');setTimeout(()=>zoneEl.classList.remove('wrong-flash'),500);
    showFeedback('MISS','var(--miss-red)');showTrivia(cardObj.item.trivia);
    results.push({...cardObj.item,correct:false});playSound('miss');endFever();
    if(lives<=0)endGame();
  }
  updateHUD();cardObj.el.style.opacity='0';
  setTimeout(()=>{if(cardObj.el.parentNode)cardObj.el.parentNode.removeChild(cardObj.el)},200);
  checkComplete();
}

function checkComplete(){
  const lv=currentLevelData;
  if(correctCount+missCount>=lv.total||totalSpawned>=lv.total&&cards.filter(c=>c.alive).length===0){setTimeout(()=>{if(gameActive)endGame()},800)}
}

function showFeedback(t,c){const f=document.createElement('div');f.className='feedback';f.textContent=t;f.style.color=c;document.body.appendChild(f);setTimeout(()=>f.remove(),800)}
function showTrivia(t){document.querySelectorAll('.trivia-popup').forEach(e=>e.remove());const d=document.createElement('div');d.className='trivia-popup';d.textContent=t;document.body.appendChild(d);setTimeout(()=>d.remove(),2200)}
function showComboBurst(t){const b=document.createElement('div');b.className='combo-burst';b.textContent=t;document.body.appendChild(b);setTimeout(()=>b.remove(),1000)}
function startFever(){isFever=true;if(!feverEl){feverEl=document.createElement('div');feverEl.className='fever-overlay';document.body.appendChild(feverEl)}}
function endFever(){isFever=false;if(feverEl){feverEl.remove();feverEl=null}}
function spawnParticles(el,color,count){
  count=count||8;const r=el.getBoundingClientRect();const cx=r.left+r.width/2,cy=r.top+r.height/2;
  for(let i=0;i<count;i++){const p=document.createElement('div');p.className='particle';p.style.background=color;p.style.left=cx+'px';p.style.top=cy+'px';const a=(Math.PI*2*i)/count,d=35+Math.random()*35;p.style.setProperty('--px',Math.cos(a)*d+'px');p.style.setProperty('--py',Math.sin(a)*d+'px');document.body.appendChild(p);setTimeout(()=>p.remove(),700)}
}
function getComboColor(c){if(c>=20)return'#FF1744';if(c>=15)return'#FF6D00';if(c>=12)return'#FFAB00';return'#FFD740'}
function showFeverCounter(){
  if(!feverCounterEl){feverCounterEl=document.createElement('div');feverCounterEl.className='fever-counter';feverCounterEl.innerHTML='<div class="fc-num"></div><div class="fc-label">COMBO</div>';document.body.appendChild(feverCounterEl)}
  const n=feverCounterEl.querySelector('.fc-num');n.textContent='üî•'+combo;n.style.color=getComboColor(combo);
  const s=Math.min(1+((combo-10)*0.03),1.5);n.style.fontSize=(48*s)+'px';n.style.animation='none';void n.offsetWidth;n.style.animation='fcBounce .25s ease';
}
function updateFeverCounter(){if(feverCounterEl){const n=feverCounterEl.querySelector('.fc-num');n.textContent='üî•'+combo;n.style.color=getComboColor(combo);const s=Math.min(1+((combo-10)*0.03),1.5);n.style.fontSize=(48*s)+'px';n.style.animation='none';void n.offsetWidth;n.style.animation='fcBounce .25s ease'}else{showFeverCounter()}}
function hideFeverCounter(){if(feverCounterEl){feverCounterEl.remove();feverCounterEl=null}}
function showEdgeFlash(){const ef=document.createElement('div');ef.className='edge-flash';document.body.appendChild(ef);setTimeout(()=>ef.remove(),300)}

function gameLoop(){
  if(!gameActive)return;const now=performance.now();const frozen=now<freezeUntil;
  const pa=document.getElementById('play-area');const aH=pa.offsetHeight;
  cards.forEach(c=>{
    if(!c.alive||c.dragging||frozen)return;
    c.y+=c.speed;c.el.style.top=c.y+'px';
    if(c.y>aH+20){c.alive=false;combo=0;lives--;missCount++;hideFeverCounter();
      showFeedback('MISS','var(--miss-red)');showTrivia(c.item.trivia);
      results.push({...c.item,correct:false});playSound('miss');endFever();updateHUD();
      if(c.el.parentNode)c.el.parentNode.removeChild(c.el);
      if(lives<=0)endGame();else checkComplete();}
  });
  cards=cards.filter(c=>c.alive||c.el.parentNode);
  animFrame=requestAnimationFrame(gameLoop);
}

function endGame(){
  gameActive=false;clearTimeout(spawnTimer);cancelAnimationFrame(animFrame);endFever();hideFeverCounter();
  cards.forEach(c=>{if(c.el.parentNode)c.el.parentNode.removeChild(c.el)});cards=[];
  setTimeout(showResults,500);
}

function showResults(){
  showScreen('result-screen');
  const totalAnswered=correctCount+missCount;
  const stars=lives>0?getStarRating(correctCount,totalAnswered):0;
  const altReward=getStarBonus(stars,lives>0);
  const isFirstClear=lives>0&&!clearedLevels[currentLevel];
  const firstBonus=isFirstClear?5:0;
  if(isFirstClear)clearedLevels[currentLevel]=true;

  let starStr='';for(let i=0;i<3;i++)starStr+=(i<stars)?'‚òÖ':'‚òÜ';
  document.getElementById('result-stars').textContent=starStr;
  const title=document.getElementById('result-title');
  if(stars===3)title.textContent='üèÜ „Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅ';
  else if(lives>0)title.textContent='üéâ „ÇØ„É™„Ç¢ÔºÅ';
  else title.textContent='üí™ „Åä„Åó„Åã„Å£„ÅüÔºÅ';

  document.getElementById('result-score-val').textContent=score;
  document.getElementById('result-correct').textContent=correctCount+'/'+totalAnswered;
  document.getElementById('result-combo').textContent=maxCombo;

  // ALT box
  const altNumEl=document.getElementById('result-alt-num');
  const altBox=document.getElementById('result-alt-box');
  const firstEl=document.getElementById('result-alt-first');
  firstEl.textContent='';firstEl.className='result-alt-first';
  altBox.style.animation='none';void altBox.offsetWidth;altBox.style.animation='altBoxIn .6s ease .5s forwards';

  if(altReward===0){
    altNumEl.textContent='ü™ô 0 ALT';
    document.getElementById('result-alt-total').textContent='„Åî„ÅÜ„Åë„ÅÑ: '+altTotal+' ALT';
  }else{
    let current=0;const totalAlt=altReward+firstBonus;altNumEl.textContent='ü™ô 0 ALT';
    setTimeout(()=>{
      const step=Math.max(1,Math.floor(altReward/10));
      const iv=setInterval(()=>{
        current+=step;if(current>=altReward){current=altReward;clearInterval(iv);
          if(firstBonus>0){firstEl.textContent='üÜï „ÅØ„Åò„ÇÅ„Å¶„ÇØ„É™„Ç¢ +'+firstBonus+' ALT';firstEl.className='result-alt-first show'}
          altTotal+=totalAlt;altSession=totalAlt;updateAltBadge();
          document.getElementById('result-alt-total').textContent='„Åî„ÅÜ„Åë„ÅÑ: '+altTotal+' ALT';
        }
        altNumEl.textContent='ü™ô +'+current+' ALT';
      },60);
    },1000);
  }

  // Ranking register button (reset)
  const area=document.getElementById('result-rank-area');
  area.innerHTML='<button class="btn-register" id="btn-register" onclick="showNameModal()">üèÜ „É©„É≥„Ç≠„É≥„Ç∞„Å´„Å®„ÅÜ„Çç„Åè„Åô„Çã</button>';

  const ic=document.getElementById('result-items');ic.innerHTML='';
  results.forEach(r=>{const d=document.createElement('div');d.className='result-item '+(r.correct?'correct':'wrong');d.textContent=r.emoji+' '+r.name;ic.appendChild(d)});
}

function goTitle(){
  gameActive=false;clearTimeout(spawnTimer);cancelAnimationFrame(animFrame);endFever();hideFeverCounter();
  cards.forEach(c=>{if(c.el.parentNode)c.el.parentNode.removeChild(c.el)});
  cards=[];dragCard=null;
  document.querySelectorAll('.feedback,.trivia-popup,.combo-burst,.edge-flash,.fever-counter').forEach(e=>e.remove());
  feverCounterEl=null;
  showScreen('title-screen');
  // Sync name from ranking to LINE
  const saved=getSavedName();
  if(saved)document.getElementById('line-name').value=saved;
  updateAltBadge();
}

// Init
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('alt-badge').style.display='block';
  updateAltBadge();checkWeeklyReset();
  const saved=getSavedName();
  if(saved)document.getElementById('line-name').value=saved;
});
</script>
</body>
</html>
